!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("JSZip"),require("localforage")):"function"==typeof define&&define.amd?define(["JSZip","localforage"],e):"object"==typeof exports?exports.ePub=e(require("JSZip"),require("localforage")):t.ePub=e(t.JSZip,t.localforage)}(self,(t,e)=>(()=>{var i={34:(t,e,i)=>{"use strict";var s=i(4901);t.exports=function(t){return"object"==typeof t?null!==t:s(t)}},81:(t,e,i)=>{"use strict";var s=i(9565),r=i(9306),n=i(8551),o=i(6823),a=i(851),h=TypeError;t.exports=function(t,e){var i=arguments.length<2?a(t):e;if(r(i))return n(s(i,t));throw new h(o(t)+" is not iterable")}},116:(t,e,i)=>{"use strict";var s=i(6518),r=i(9565),n=i(2652),o=i(9306),a=i(8551),h=i(1767),c=i(9539),l=i(4549)("find",TypeError);s({target:"Iterator",proto:!0,real:!0,forced:l},{find:function(t){a(this);try{o(t)}catch(t){c(this,"throw",t)}if(l)return r(l,this,t);var e=h(this),i=0;return n(e,function(e,s){if(t(e,i++))return s(e)},{IS_RECORD:!0,INTERRUPTED:!0}).result}})},124:(t,e,i)=>{var s=i(9325);t.exports=function(){return s.Date.now()}},148:(t,e,i)=>{"use strict";var s=i(9762),r=Array.prototype.forEach,n=Object.create;t.exports=function(t){var e=n(null);return r.call(arguments,function(t){s(t)&&function(t,e){var i;for(i in t)e[i]=t[i]}(Object(t),e)}),e}},181:(t,e,i)=>{"use strict";var s=i(8175),r={object:!0,function:!0,undefined:!0};t.exports=function(t){return!!s(t)&&hasOwnProperty.call(r,typeof t)}},214:(t,e,i)=>{"use strict";t.exports=i(525)()?String.prototype.contains:i(1521)},230:(t,e,i)=>{"use strict";var s=i(6518),r=i(9306),n=i(6194),o=i(6223),a=TypeError;s({target:"Map",proto:!0,real:!0,forced:!0},{reduce:function(t){var e=n(this),i=arguments.length<2,s=i?void 0:arguments[1];if(r(t),o(e,function(r,n){i?(i=!1,s=r):s=t(s,r,n,e)}),i)throw new a("Reduce of empty map with no initial value");return s}})},283:(t,e,i)=>{"use strict";var s=i(9504),r=i(9039),n=i(4901),o=i(9297),a=i(3724),h=i(350).CONFIGURABLE,c=i(3706),l=i(1181),u=l.enforce,d=l.get,p=String,f=Object.defineProperty,g=s("".slice),m=s("".replace),v=s([].join),y=a&&!r(function(){return 8!==f(function(){},"length",{value:8}).length}),w=String(String).split("String"),b=t.exports=function(t,e,i){"Symbol("===g(p(e),0,7)&&(e="["+m(p(e),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),i&&i.getter&&(e="get "+e),i&&i.setter&&(e="set "+e),(!o(t,"name")||h&&t.name!==e)&&(a?f(t,"name",{value:e,configurable:!0}):t.name=e),y&&i&&o(i,"arity")&&t.length!==i.arity&&f(t,"length",{value:i.arity});try{i&&o(i,"constructor")&&i.constructor?a&&f(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var s=u(t);return o(s,"source")||(s.source=v(w,"string"==typeof e?e:"")),t};Function.prototype.toString=b(function(){return n(this)&&d(this).source||c(this)},"toString")},346:t=>{t.exports=function(t){return null!=t&&"object"==typeof t}},350:(t,e,i)=>{"use strict";var s=i(3724),r=i(9297),n=Function.prototype,o=s&&Object.getOwnPropertyDescriptor,a=r(n,"name"),h=a&&"something"===function(){}.name,c=a&&(!s||s&&o(n,"name").configurable);t.exports={EXISTS:a,PROPER:h,CONFIGURABLE:c}},397:(t,e,i)=>{"use strict";var s=i(7751);t.exports=s("document","documentElement")},421:t=>{"use strict";t.exports={}},507:(t,e,i)=>{"use strict";var s=i(9565);t.exports=function(t,e,i){for(var r,n,o=i?t:t.iterator,a=t.next;!(r=s(a,o)).done;)if(void 0!==(n=e(r.value)))return n}},525:t=>{"use strict";var e="razdwatrzy";t.exports=function(){return"function"==typeof e.contains&&!0===e.contains("dwa")&&!1===e.contains("foo")}},616:(t,e,i)=>{"use strict";var s=i(9039);t.exports=!s(function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})},655:(t,e,i)=>{"use strict";var s=i(6955),r=String;t.exports=function(t){if("Symbol"===s(t))throw new TypeError("Cannot convert a Symbol value to a string");return r(t)}},659:(t,e,i)=>{var s=i(1873),r=Object.prototype,n=r.hasOwnProperty,o=r.toString,a=s?s.toStringTag:void 0;t.exports=function(t){var e=n.call(t,a),i=t[a];try{t[a]=void 0;var s=!0}catch(t){}var r=o.call(t);return s&&(e?t[a]=i:delete t[a]),r}},679:(t,e,i)=>{"use strict";var s=i(1625),r=TypeError;t.exports=function(t,e){if(s(e,t))return t;throw new r("Incorrect invocation")}},684:t=>{"use strict";t.exports=function(t,e){var i="function"==typeof Iterator&&Iterator.prototype[t];if(i)try{i.call({next:null},e).next()}catch(t){return!0}}},741:t=>{"use strict";var e=Math.ceil,i=Math.floor;t.exports=Math.trunc||function(t){var s=+t;return(s>0?i:e)(s)}},757:(t,e,i)=>{"use strict";var s=i(7751),r=i(4901),n=i(1625),o=i(7040),a=Object;t.exports=o?function(t){return"symbol"==typeof t}:function(t){var e=s("Symbol");return r(e)&&n(e.prototype,a(t))}},851:(t,e,i)=>{"use strict";var s=i(6955),r=i(5966),n=i(4117),o=i(6269),a=i(8227)("iterator");t.exports=function(t){if(!n(t))return r(t,a)||r(t,"@@iterator")||o[s(t)]}},1072:(t,e,i)=>{"use strict";var s=i(1828),r=i(8727);t.exports=Object.keys||function(t){return s(t,r)}},1181:(t,e,i)=>{"use strict";var s,r,n,o=i(8622),a=i(4576),h=i(34),c=i(6699),l=i(9297),u=i(7629),d=i(6119),p=i(421),f="Object already initialized",g=a.TypeError,m=a.WeakMap;if(o||u.state){var v=u.state||(u.state=new m);v.get=v.get,v.has=v.has,v.set=v.set,s=function(t,e){if(v.has(t))throw new g(f);return e.facade=t,v.set(t,e),e},r=function(t){return v.get(t)||{}},n=function(t){return v.has(t)}}else{var y=d("state");p[y]=!0,s=function(t,e){if(l(t,y))throw new g(f);return e.facade=t,c(t,y,e),e},r=function(t){return l(t,y)?t[y]:{}},n=function(t){return l(t,y)}}t.exports={set:s,get:r,has:n,enforce:function(t){return n(t)?r(t):s(t,{})},getterFor:function(t){return function(e){var i;if(!h(e)||(i=r(e)).type!==t)throw new g("Incompatible receiver, "+t+" required");return i}}}},1291:(t,e,i)=>{"use strict";var s=i(741);t.exports=function(t){var e=+t;return e!=e||0===e?0:s(e)}},1379:(t,e,i)=>{"use strict";var s=i(6518),r=i(6194),n=i(2248),o=n.get,a=n.has,h=n.set;s({target:"Map",proto:!0,real:!0,forced:!0},{emplace:function(t,e){var i,s,n=r(this);return a(n,t)?(i=o(n,t),"update"in e&&(i=e.update(i,t,n),h(n,t,i)),i):(s=e.insert(t,n),h(n,t,s),s)}})},1385:(t,e,i)=>{"use strict";var s=i(9539);t.exports=function(t,e,i){for(var r=t.length-1;r>=0;r--)if(void 0!==t[r])try{i=s(t[r].iterator,e,i)}catch(t){e="throw",i=t}if("throw"===e)throw i;return i}},1517:(t,e,i)=>{"use strict";var s=i(6518),r=i(6194),n=i(2248).remove;s({target:"Map",proto:!0,real:!0,forced:!0},{deleteAll:function(){for(var t,e=r(this),i=!0,s=0,o=arguments.length;s<o;s++)t=n(e,arguments[s]),i=i&&t;return!!i}})},1521:t=>{"use strict";var e=String.prototype.indexOf;t.exports=function(t){return e.call(this,t,arguments[1])>-1}},1548:(t,e,i)=>{"use strict";var s=i(4576),r=i(9039),n=i(9519),o=i(4215),a=s.structuredClone;t.exports=!!a&&!r(function(){if("DENO"===o&&n>92||"NODE"===o&&n>94||"BROWSER"===o&&n>97)return!1;var t=new ArrayBuffer(8),e=a(t,{transfer:[t]});return 0!==t.byteLength||8!==e.byteLength})},1625:(t,e,i)=>{"use strict";var s=i(9504);t.exports=s({}.isPrototypeOf)},1701:(t,e,i)=>{"use strict";var s=i(6518),r=i(9565),n=i(9306),o=i(8551),a=i(1767),h=i(9462),c=i(6319),l=i(9539),u=i(684),d=i(4549),p=i(6395),f=!p&&!u("map",function(){}),g=!p&&!f&&d("map",TypeError),m=p||f||g,v=h(function(){var t=this.iterator,e=o(r(this.next,t));if(!(this.done=!!e.done))return c(t,this.mapper,[e.value,this.counter++],!0)});s({target:"Iterator",proto:!0,real:!0,forced:m},{map:function(t){o(this);try{n(t)}catch(t){l(this,"throw",t)}return g?r(g,this,t):new v(a(this),{mapper:t})}})},1767:t=>{"use strict";t.exports=function(t){return{iterator:t,next:t.next,done:!1}}},1800:t=>{var e=/\s/;t.exports=function(t){for(var i=t.length;i--&&e.test(t.charAt(i)););return i}},1828:(t,e,i)=>{"use strict";var s=i(9504),r=i(9297),n=i(5397),o=i(9617).indexOf,a=i(421),h=s([].push);t.exports=function(t,e){var i,s=n(t),c=0,l=[];for(i in s)!r(a,i)&&r(s,i)&&h(l,i);for(;e.length>c;)r(s,i=e[c++])&&(~o(l,i)||h(l,i));return l}},1873:(t,e,i)=>{var s=i(9325).Symbol;t.exports=s},2093:(t,e,i)=>{"use strict";t.exports=i(3380)()?Object.keys:i(4232)},2106:(t,e,i)=>{"use strict";var s=i(283),r=i(4913);t.exports=function(t,e,i){return i.get&&s(i.get,e,{getter:!0}),i.set&&s(i.set,e,{setter:!0}),r.f(t,e,i)}},2140:(t,e,i)=>{"use strict";var s={};s[i(8227)("toStringTag")]="z",t.exports="[object z]"===String(s)},2195:(t,e,i)=>{"use strict";var s=i(9504),r=s({}.toString),n=s("".slice);t.exports=function(t){return n(r(t),8,-1)}},2211:(t,e,i)=>{"use strict";var s=i(9039);t.exports=!s(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})},2248:(t,e,i)=>{"use strict";var s=i(9504),r=Map.prototype;t.exports={Map,set:s(r.set),get:s(r.get),has:s(r.has),remove:s(r.delete),proto:r}},2359:(t,e,i)=>{"use strict";var s=i(6518),r=i(6080),n=i(6194),o=i(6223);s({target:"Map",proto:!0,real:!0,forced:!0},{find:function(t){var e=n(this),i=r(t,arguments.length>1?arguments[1]:void 0),s=o(e,function(t,s){if(i(t,s,e))return{value:t}},!0);return s&&s.value}})},2360:(t,e,i)=>{"use strict";var s,r=i(8551),n=i(6801),o=i(8727),a=i(421),h=i(397),c=i(4055),l=i(6119),u="prototype",d="script",p=l("IE_PROTO"),f=function(){},g=function(t){return"<"+d+">"+t+"</"+d+">"},m=function(t){t.write(g("")),t.close();var e=t.parentWindow.Object;return t=null,e},v=function(){try{s=new ActiveXObject("htmlfile")}catch(t){}var t,e,i;v="undefined"!=typeof document?document.domain&&s?m(s):(e=c("iframe"),i="java"+d+":",e.style.display="none",h.appendChild(e),e.src=String(i),(t=e.contentWindow.document).open(),t.write(g("document.F=Object")),t.close(),t.F):m(s);for(var r=o.length;r--;)delete v[u][o[r]];return v()};a[p]=!0,t.exports=Object.create||function(t,e){var i;return null!==t?(f[u]=r(t),i=new f,f[u]=null,i[p]=t):i=v(),void 0===e?i:n.f(i,e)}},2489:(t,e,i)=>{"use strict";var s=i(6518),r=i(9565),n=i(9306),o=i(8551),a=i(1767),h=i(9462),c=i(6319),l=i(6395),u=i(9539),d=i(684),p=i(4549),f=!l&&!d("filter",function(){}),g=!l&&!f&&p("filter",TypeError),m=l||f||g,v=h(function(){for(var t,e,i=this.iterator,s=this.predicate,n=this.next;;){if(t=o(r(n,i)),this.done=!!t.done)return;if(e=t.value,c(i,s,[e,this.counter++],!0))return e}});s({target:"Iterator",proto:!0,real:!0,forced:m},{filter:function(t){o(this);try{n(t)}catch(t){u(this,"throw",t)}return g?r(g,this,t):new v(a(this),{predicate:t})}})},2529:t=>{"use strict";t.exports=function(t,e){return{value:t,done:e}}},2552:(t,e,i)=>{var s=i(1873),r=i(659),n=i(9350),o=s?s.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":o&&o in Object(t)?r(t):n(t)}},2603:(t,e,i)=>{"use strict";var s=i(655);t.exports=function(t,e){return void 0===t?arguments.length<2?"":e:s(t)}},2652:(t,e,i)=>{"use strict";var s=i(6080),r=i(9565),n=i(8551),o=i(6823),a=i(4209),h=i(6198),c=i(1625),l=i(81),u=i(851),d=i(9539),p=TypeError,f=function(t,e){this.stopped=t,this.result=e},g=f.prototype;t.exports=function(t,e,i){var m,v,y,w,b,x,E,T=i&&i.that,k=!(!i||!i.AS_ENTRIES),O=!(!i||!i.IS_RECORD),C=!(!i||!i.IS_ITERATOR),N=!(!i||!i.INTERRUPTED),S=s(e,T),R=function(t){return m&&d(m,"normal"),new f(!0,t)},L=function(t){return k?(n(t),N?S(t[0],t[1],R):S(t[0],t[1])):N?S(t,R):S(t)};if(O)m=t.iterator;else if(C)m=t;else{if(!(v=u(t)))throw new p(o(t)+" is not iterable");if(a(v)){for(y=0,w=h(t);w>y;y++)if((b=L(t[y]))&&c(g,b))return b;return new f(!1)}m=l(t,v)}for(x=O?t.next:m.next;!(E=r(x,m)).done;){try{b=L(E.value)}catch(t){d(m,"throw",t)}if("object"==typeof b&&b&&c(g,b))return b}return new f(!1)}},2777:(t,e,i)=>{"use strict";var s=i(9565),r=i(34),n=i(757),o=i(5966),a=i(4270),h=i(8227),c=TypeError,l=h("toPrimitive");t.exports=function(t,e){if(!r(t)||n(t))return t;var i,h=o(t,l);if(h){if(void 0===e&&(e="default"),i=s(h,t,e),!r(i)||n(i))return i;throw new c("Can't convert object to primitive value")}return void 0===e&&(e="number"),a(t,e)}},2787:(t,e,i)=>{"use strict";var s=i(9297),r=i(4901),n=i(8981),o=i(6119),a=i(2211),h=o("IE_PROTO"),c=Object,l=c.prototype;t.exports=a?c.getPrototypeOf:function(t){var e=n(t);if(s(e,h))return e[h];var i=e.constructor;return r(i)&&e instanceof i?i.prototype:e instanceof c?l:null}},2796:(t,e,i)=>{"use strict";var s=i(9039),r=i(4901),n=/#|\.prototype\./,o=function(t,e){var i=h[a(t)];return i===l||i!==c&&(r(e)?s(e):!!e)},a=o.normalize=function(t){return String(t).replace(n,".").toLowerCase()},h=o.data={},c=o.NATIVE="N",l=o.POLYFILL="P";t.exports=o},2812:t=>{"use strict";var e=TypeError;t.exports=function(t,i){if(t<i)throw new e("Not enough arguments");return t}},2839:(t,e,i)=>{"use strict";var s=i(4576).navigator,r=s&&s.userAgent;t.exports=r?String(r):""},2967:(t,e,i)=>{"use strict";var s=i(6706),r=i(34),n=i(7750),o=i(3506);t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,i={};try{(t=s(Object.prototype,"__proto__","set"))(i,[]),e=i instanceof Array}catch(t){}return function(i,s){return n(i),o(s),r(i)?(e?t(i,s):i.__proto__=s,i):i}}():void 0)},3068:(t,e,i)=>{"use strict";var s,r,n,o,a,h,c,l=i(8263),u=i(5499),d=Function.prototype.apply,p=Function.prototype.call,f=Object.create,g=Object.defineProperty,m=Object.defineProperties,v=Object.prototype.hasOwnProperty,y={configurable:!0,enumerable:!1,writable:!0};r=function(t,e){var i,r;return u(e),r=this,s.call(this,t,i=function(){n.call(r,t,i),d.call(e,this,arguments)}),i.__eeOnceListener__=e,this},a={on:s=function(t,e){var i;return u(e),v.call(this,"__ee__")?i=this.__ee__:(i=y.value=f(null),g(this,"__ee__",y),y.value=null),i[t]?"object"==typeof i[t]?i[t].push(e):i[t]=[i[t],e]:i[t]=e,this},once:r,off:n=function(t,e){var i,s,r,n;if(u(e),!v.call(this,"__ee__"))return this;if(!(i=this.__ee__)[t])return this;if("object"==typeof(s=i[t]))for(n=0;r=s[n];++n)r!==e&&r.__eeOnceListener__!==e||(2===s.length?i[t]=s[n?0:1]:s.splice(n,1));else s!==e&&s.__eeOnceListener__!==e||delete i[t];return this},emit:o=function(t){var e,i,s,r,n;if(v.call(this,"__ee__")&&(r=this.__ee__[t]))if("object"==typeof r){for(i=arguments.length,n=new Array(i-1),e=1;e<i;++e)n[e-1]=arguments[e];for(r=r.slice(),e=0;s=r[e];++e)d.call(s,this,n)}else switch(arguments.length){case 1:p.call(r,this);break;case 2:p.call(r,this,arguments[1]);break;case 3:p.call(r,this,arguments[1],arguments[2]);break;default:for(i=arguments.length,n=new Array(i-1),e=1;e<i;++e)n[e-1]=arguments[e];d.call(r,this,n)}}},h={on:l(s),once:l(r),off:l(n),emit:l(o)},c=m({},h),t.exports=e=function(t){return null==t?f(c):m(Object(t),h)},e.methods=a},3167:(t,e,i)=>{"use strict";var s=i(4901),r=i(34),n=i(2967);t.exports=function(t,e,i){var o,a;return n&&s(o=e.constructor)&&o!==i&&r(a=o.prototype)&&a!==i.prototype&&n(t,a),t}},3238:(t,e,i)=>{"use strict";var s=i(4576),r=i(7811),n=i(7394),o=s.DataView;t.exports=function(t){if(!r||0!==n(t))return!1;try{return new o(t),!1}catch(t){return!0}}},3317:t=>{"use strict";t.exports=function(t,e){return t===e||t!=t&&e!=e}},3380:t=>{"use strict";t.exports=function(){try{return Object.keys("primitive"),!0}catch(t){return!1}}},3392:(t,e,i)=>{"use strict";var s=i(9504),r=0,n=Math.random(),o=s(1.1.toString);t.exports=function(t){return"Symbol("+(void 0===t?"":t)+")_"+o(++r+n,36)}},3506:(t,e,i)=>{"use strict";var s=i(3925),r=String,n=TypeError;t.exports=function(t){if(s(t))return t;throw new n("Can't set "+r(t)+" as a prototype")}},3595:(t,e,i)=>{"use strict";var s=i(2093),r=i(7134),n=Math.max;t.exports=function(t,e){var i,o,a,h=n(arguments.length,2);for(t=Object(r(t)),a=function(s){try{t[s]=e[s]}catch(t){i||(i=t)}},o=1;o<h;++o)s(e=arguments[o]).forEach(a);if(void 0!==i)throw i;return t}},3706:(t,e,i)=>{"use strict";var s=i(9504),r=i(4901),n=i(7629),o=s(Function.toString);r(n.inspectSource)||(n.inspectSource=function(t){return o(t)}),t.exports=n.inspectSource},3717:(t,e)=>{"use strict";e.f=Object.getOwnPropertySymbols},3724:(t,e,i)=>{"use strict";var s=i(9039);t.exports=!s(function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})},3777:(t,e,i)=>{"use strict";var s=i(6518),r=i(6080),n=i(6194),o=i(6223);s({target:"Map",proto:!0,real:!0,forced:!0},{every:function(t){var e=n(this),i=r(t,arguments.length>1?arguments[1]:void 0);return!1!==o(e,function(t,s){if(!i(t,s,e))return!1},!0)}})},3805:t=>{t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},3925:(t,e,i)=>{"use strict";var s=i(34);t.exports=function(t){return s(t)||null===t}},4055:(t,e,i)=>{"use strict";var s=i(4576),r=i(34),n=s.document,o=r(n)&&r(n.createElement);t.exports=function(t){return o?n.createElement(t):{}}},4080:(t,e,i)=>{"use strict";var s=i(9202);t.exports=function(t){if("function"!=typeof t)return!1;if(!hasOwnProperty.call(t,"length"))return!1;try{if("number"!=typeof t.length)return!1;if("function"!=typeof t.call)return!1;if("function"!=typeof t.apply)return!1}catch(t){return!1}return!s(t)}},4114:(t,e,i)=>{"use strict";var s=i(6518),r=i(8981),n=i(6198),o=i(4527),a=i(6837);s({target:"Array",proto:!0,arity:1,forced:i(9039)(function(){return 4294967297!==[].push.call({length:4294967296},1)})||!function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(t){return t instanceof TypeError}}()},{push:function(t){var e=r(this),i=n(e),s=arguments.length;a(i+s);for(var h=0;h<s;h++)e[i]=arguments[h],i++;return o(e,i),i}})},4117:t=>{"use strict";t.exports=function(t){return null==t}},4128:(t,e,i)=>{var s=i(1800),r=/^\s+/;t.exports=function(t){return t?t.slice(0,s(t)+1).replace(r,""):t}},4190:(t,e,i)=>{"use strict";var s=i(6518),r=i(6080),n=i(6194),o=i(2248),a=i(6223),h=o.Map,c=o.set;s({target:"Map",proto:!0,real:!0,forced:!0},{filter:function(t){var e=n(this),i=r(t,arguments.length>1?arguments[1]:void 0),s=new h;return a(e,function(t,r){i(t,r,e)&&c(s,r,t)}),s}})},4209:(t,e,i)=>{"use strict";var s=i(8227),r=i(6269),n=s("iterator"),o=Array.prototype;t.exports=function(t){return void 0!==t&&(r.Array===t||o[n]===t)}},4215:(t,e,i)=>{"use strict";var s=i(4576),r=i(2839),n=i(2195),o=function(t){return r.slice(0,t.length)===t};t.exports=o("Bun/")?"BUN":o("Cloudflare-Workers")?"CLOUDFLARE":o("Deno/")?"DENO":o("Node.js/")?"NODE":s.Bun&&"string"==typeof Bun.version?"BUN":s.Deno&&"object"==typeof Deno.version?"DENO":"process"===n(s.process)?"NODE":s.window&&s.document?"BROWSER":"REST"},4232:(t,e,i)=>{"use strict";var s=i(9762),r=Object.keys;t.exports=function(t){return r(s(t)?Object(t):t)}},4270:(t,e,i)=>{"use strict";var s=i(9565),r=i(4901),n=i(34),o=TypeError;t.exports=function(t,e){var i,a;if("string"===e&&r(i=t.toString)&&!n(a=s(i,t)))return a;if(r(i=t.valueOf)&&!n(a=s(i,t)))return a;if("string"!==e&&r(i=t.toString)&&!n(a=s(i,t)))return a;throw new o("Can't convert object to primitive value")}},4376:(t,e,i)=>{"use strict";var s=i(2195);t.exports=Array.isArray||function(t){return"Array"===s(t)}},4394:(t,e,i)=>{var s=i(2552),r=i(346);t.exports=function(t){return"symbol"==typeof t||r(t)&&"[object Symbol]"==s(t)}},4483:(t,e,i)=>{"use strict";var s,r,n,o,a=i(4576),h=i(9429),c=i(1548),l=a.structuredClone,u=a.ArrayBuffer,d=a.MessageChannel,p=!1;if(c)p=function(t){l(t,{transfer:[t]})};else if(u)try{d||(s=h("worker_threads"))&&(d=s.MessageChannel),d&&(r=new d,n=new u(2),o=function(t){r.port1.postMessage(null,[t])},2===n.byteLength&&(o(n),0===n.byteLength&&(p=o)))}catch(t){}t.exports=p},4495:(t,e,i)=>{"use strict";var s=i(9519),r=i(9039),n=i(4576).String;t.exports=!!Object.getOwnPropertySymbols&&!r(function(){var t=Symbol("symbol detection");return!n(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&s&&s<41})},4527:(t,e,i)=>{"use strict";var s=i(3724),r=i(4376),n=TypeError,o=Object.getOwnPropertyDescriptor,a=s&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}();t.exports=a?function(t,e){if(r(t)&&!o(t,"length").writable)throw new n("Cannot set read only .length");return t.length=e}:function(t,e){return t.length=e}},4549:(t,e,i)=>{"use strict";var s=i(4576);t.exports=function(t,e){var i=s.Iterator,r=i&&i.prototype,n=r&&r[t],o=!1;if(n)try{n.call({next:function(){return{done:!0}},return:function(){o=!0}},-1)}catch(t){t instanceof e||(o=!1)}if(!o)return n}},4576:function(t,e,i){"use strict";var s=function(t){return t&&t.Math===Math&&t};t.exports=s("object"==typeof globalThis&&globalThis)||s("object"==typeof window&&window)||s("object"==typeof self&&self)||s("object"==typeof i.g&&i.g)||s("object"==typeof this&&this)||function(){return this}()||Function("return this")()},4603:(t,e,i)=>{"use strict";var s=i(6840),r=i(9504),n=i(655),o=i(2812),a=URLSearchParams,h=a.prototype,c=r(h.append),l=r(h.delete),u=r(h.forEach),d=r([].push),p=new a("a=1&a=2&b=3");p.delete("a",1),p.delete("b",void 0),p+""!="a=2"&&s(h,"delete",function(t){var e=arguments.length,i=e<2?void 0:arguments[1];if(e&&void 0===i)return l(this,t);var s=[];u(this,function(t,e){d(s,{key:e,value:t})}),o(e,1);for(var r,a=n(t),h=n(i),p=0,f=0,g=!1,m=s.length;p<m;)r=s[p++],g||r.key===a?(g=!0,l(this,r.key)):f++;for(;f<m;)(r=s[f++]).key===a&&r.value===h||c(this,r.key,r.value)},{enumerable:!0,unsafe:!0})},4659:(t,e,i)=>{"use strict";var s=i(3724),r=i(4913),n=i(6980);t.exports=function(t,e,i){s?r.f(t,e,n(0,i)):t[e]=i}},4840:(t,e,i)=>{var s="object"==typeof i.g&&i.g&&i.g.Object===Object&&i.g;t.exports=s},4901:t=>{"use strict";var e="object"==typeof document&&document.all;t.exports=void 0===e&&void 0!==e?function(t){return"function"==typeof t||t===e}:function(t){return"function"==typeof t}},4913:(t,e,i)=>{"use strict";var s=i(3724),r=i(5917),n=i(8686),o=i(8551),a=i(6969),h=TypeError,c=Object.defineProperty,l=Object.getOwnPropertyDescriptor,u="enumerable",d="configurable",p="writable";e.f=s?n?function(t,e,i){if(o(t),e=a(e),o(i),"function"==typeof t&&"prototype"===e&&"value"in i&&p in i&&!i[p]){var s=l(t,e);s&&s[p]&&(t[e]=i.value,i={configurable:d in i?i[d]:s[d],enumerable:u in i?i[u]:s[u],writable:!1})}return c(t,e,i)}:c:function(t,e,i){if(o(t),e=a(e),o(i),r)try{return c(t,e,i)}catch(t){}if("get"in i||"set"in i)throw new h("Accessors not supported");return"value"in i&&(t[e]=i.value),t}},4979:(t,e,i)=>{"use strict";var s=i(6518),r=i(4576),n=i(7751),o=i(6980),a=i(4913).f,h=i(9297),c=i(679),l=i(3167),u=i(2603),d=i(5002),p=i(8574),f=i(3724),g=i(6395),m="DOMException",v=n("Error"),y=n(m),w=function(){c(this,b);var t=arguments.length,e=u(t<1?void 0:arguments[0]),i=u(t<2?void 0:arguments[1],"Error"),s=new y(e,i),r=new v(e);return r.name=m,a(s,"stack",o(1,p(r.stack,1))),l(s,this,w),s},b=w.prototype=y.prototype,x="stack"in new v(m),E="stack"in new y(1,2),T=y&&f&&Object.getOwnPropertyDescriptor(r,m),k=!(!T||T.writable&&T.configurable),O=x&&!k&&!E;s({global:!0,constructor:!0,forced:g||O},{DOMException:O?w:y});var C=n(m),N=C.prototype;if(N.constructor!==C)for(var S in g||a(N,"constructor",o(1,C)),d)if(h(d,S)){var R=d[S],L=R.s;h(C,L)||a(C,L,o(6,R.c))}},5002:t=>{"use strict";t.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},5031:(t,e,i)=>{"use strict";var s=i(7751),r=i(9504),n=i(8480),o=i(3717),a=i(8551),h=r([].concat);t.exports=s("Reflect","ownKeys")||function(t){var e=n.f(a(t)),i=o.f;return i?h(e,i(t)):e}},5122:(t,e,i)=>{"use strict";var s=i(6518),r=i(6194),n=i(2652),o=i(2248).set;s({target:"Map",proto:!0,real:!0,arity:1,forced:!0},{merge:function(t){for(var e=r(this),i=arguments.length,s=0;s<i;)n(arguments[s++],function(t,i){o(e,t,i)},{AS_ENTRIES:!0});return e}})},5169:(t,e,i)=>{"use strict";var s=i(3238),r=TypeError;t.exports=function(t){if(s(t))throw new r("ArrayBuffer is detached");return t}},5339:t=>{"use strict";t.exports=function(){var t,e=Object.assign;return"function"==typeof e&&(e(t={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),t.foo+t.bar+t.trzy==="razdwatrzy")}},5397:(t,e,i)=>{"use strict";var s=i(7055),r=i(7750);t.exports=function(t){return s(r(t))}},5499:t=>{"use strict";t.exports=function(t){if("function"!=typeof t)throw new TypeError(t+" is not a function");return t}},5610:(t,e,i)=>{"use strict";var s=i(1291),r=Math.max,n=Math.min;t.exports=function(t,e){var i=s(t);return i<0?r(i+e,0):n(i,e)}},5636:(t,e,i)=>{"use strict";var s=i(4576),r=i(9504),n=i(6706),o=i(7696),a=i(5169),h=i(7394),c=i(4483),l=i(1548),u=s.structuredClone,d=s.ArrayBuffer,p=s.DataView,f=Math.min,g=d.prototype,m=p.prototype,v=r(g.slice),y=n(g,"resizable","get"),w=n(g,"maxByteLength","get"),b=r(m.getInt8),x=r(m.setInt8);t.exports=(l||c)&&function(t,e,i){var s,r=h(t),n=void 0===e?r:o(e),g=!y||!y(t);if(a(t),l&&(t=u(t,{transfer:[t]}),r===n&&(i||g)))return t;if(r>=n&&(!i||g))s=v(t,0,n);else{var m=i&&!g&&w?{maxByteLength:w(t)}:void 0;s=new d(n,m);for(var E=new p(t),T=new p(s),k=f(n,r),O=0;O<k;O++)x(T,O,b(E,O))}return l||c(t),s}},5745:(t,e,i)=>{"use strict";var s=i(7629);t.exports=function(t,e){return s[t]||(s[t]=e||{})}},5917:(t,e,i)=>{"use strict";var s=i(3724),r=i(9039),n=i(4055);t.exports=!s&&!r(function(){return 7!==Object.defineProperty(n("div"),"a",{get:function(){return 7}}).a})},5966:(t,e,i)=>{"use strict";var s=i(9306),r=i(4117);t.exports=function(t,e){var i=t[e];return r(i)?void 0:s(i)}},6011:t=>{"use strict";t.exports=function(){}},6080:(t,e,i)=>{"use strict";var s=i(7476),r=i(9306),n=i(616),o=s(s.bind);t.exports=function(t,e){return r(t),void 0===e?t:n?o(t,e):function(){return t.apply(e,arguments)}}},6097:(t,e,i)=>{"use strict";var s=i(6518),r=i(6080),n=i(6194),o=i(6223);s({target:"Map",proto:!0,real:!0,forced:!0},{findKey:function(t){var e=n(this),i=r(t,arguments.length>1?arguments[1]:void 0),s=o(e,function(t,s){if(i(t,s,e))return{key:s}},!0);return s&&s.key}})},6119:(t,e,i)=>{"use strict";var s=i(5745),r=i(3392),n=s("keys");t.exports=function(t){return n[t]||(n[t]=r(t))}},6193:(t,e,i)=>{"use strict";var s=i(4215);t.exports="NODE"===s},6194:(t,e,i)=>{"use strict";var s=i(2248).has;t.exports=function(t){return s(t),t}},6198:(t,e,i)=>{"use strict";var s=i(8014);t.exports=function(t){return s(t.length)}},6223:(t,e,i)=>{"use strict";var s=i(9504),r=i(507),n=i(2248),o=n.Map,a=n.proto,h=s(a.forEach),c=s(a.entries),l=c(new o).next;t.exports=function(t,e,i){return i?r({iterator:c(t),next:l},function(t){return e(t[1],t[0])}):h(t,e)}},6269:t=>{"use strict";t.exports={}},6279:(t,e,i)=>{"use strict";var s=i(6840);t.exports=function(t,e,i){for(var r in e)s(t,r,e[r],i);return t}},6319:(t,e,i)=>{"use strict";var s=i(8551),r=i(9539);t.exports=function(t,e,i,n){try{return n?e(s(i)[0],i[1]):e(i)}catch(e){r(t,"throw",e)}}},6361:t=>{"use strict";t.exports=e},6395:t=>{"use strict";t.exports=!1},6518:(t,e,i)=>{"use strict";var s=i(4576),r=i(7347).f,n=i(6699),o=i(6840),a=i(9433),h=i(7740),c=i(2796);t.exports=function(t,e){var i,l,u,d,p,f=t.target,g=t.global,m=t.stat;if(i=g?s:m?s[f]||a(f,{}):s[f]&&s[f].prototype)for(l in e){if(d=e[l],u=t.dontCallGetSet?(p=r(i,l))&&p.value:i[l],!c(g?l:f+(m?".":"#")+l,t.forced)&&void 0!==u){if(typeof d==typeof u)continue;h(d,u)}(t.sham||u&&u.sham)&&n(d,"sham",!0),o(i,l,d,t)}}},6573:(t,e,i)=>{"use strict";var s=i(3724),r=i(2106),n=i(3238),o=ArrayBuffer.prototype;s&&!("detached"in o)&&r(o,"detached",{configurable:!0,get:function(){return n(this)}})},6596:(t,e,i)=>{"use strict";t.exports=i(5339)()?Object.assign:i(3595)},6699:(t,e,i)=>{"use strict";var s=i(3724),r=i(4913),n=i(6980);t.exports=s?function(t,e,i){return r.f(t,e,n(1,i))}:function(t,e,i){return t[e]=i,t}},6706:(t,e,i)=>{"use strict";var s=i(9504),r=i(9306);t.exports=function(t,e,i){try{return s(r(Object.getOwnPropertyDescriptor(t,e)[i]))}catch(t){}}},6801:(t,e,i)=>{"use strict";var s=i(3724),r=i(8686),n=i(4913),o=i(8551),a=i(5397),h=i(1072);e.f=s&&!r?Object.defineProperties:function(t,e){o(t);for(var i,s=a(e),r=h(e),c=r.length,l=0;c>l;)n.f(t,i=r[l++],s[i]);return t}},6823:t=>{"use strict";var e=String;t.exports=function(t){try{return e(t)}catch(t){return"Object"}}},6837:t=>{"use strict";var e=TypeError;t.exports=function(t){if(t>9007199254740991)throw e("Maximum allowed index exceeded");return t}},6838:e=>{"use strict";e.exports=t},6840:(t,e,i)=>{"use strict";var s=i(4901),r=i(4913),n=i(283),o=i(9433);t.exports=function(t,e,i,a){a||(a={});var h=a.enumerable,c=void 0!==a.name?a.name:e;if(s(i)&&n(i,c,a),a.global)h?t[e]=i:o(e,i);else{try{a.unsafe?t[e]&&(h=!0):delete t[e]}catch(t){}h?t[e]=i:r.f(t,e,{value:i,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return t}},6873:(t,e,i)=>{"use strict";var s=i(4080),r=/^\s*class[\s{/}]/,n=Function.prototype.toString;t.exports=function(t){return!!s(t)&&!r.test(n.call(t))}},6955:(t,e,i)=>{"use strict";var s=i(2140),r=i(4901),n=i(2195),o=i(8227)("toStringTag"),a=Object,h="Arguments"===n(function(){return arguments}());t.exports=s?n:function(t){var e,i,s;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=function(t,e){try{return t[e]}catch(t){}}(e=a(t),o))?i:h?n(e):"Object"===(s=n(e))&&r(e.callee)?"Arguments":s}},6969:(t,e,i)=>{"use strict";var s=i(2777),r=i(757);t.exports=function(t){var e=s(t,"string");return r(e)?e:e+""}},6980:t=>{"use strict";t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},7036:(t,e,i)=>{"use strict";var s=i(6518),r=i(9306),n=i(6194),o=i(2248),a=o.get,h=o.has,c=o.set;s({target:"Map",proto:!0,real:!0,forced:!0},{getOrInsertComputed:function(t,e){if(n(this),r(e),h(this,t))return a(this,t);0===t&&1/t==-1/0&&(t=0);var i=e(t);return c(this,t,i),i}})},7040:(t,e,i)=>{"use strict";var s=i(4495);t.exports=s&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},7055:(t,e,i)=>{"use strict";var s=i(9504),r=i(9039),n=i(2195),o=Object,a=s("".split);t.exports=r(function(){return!o("z").propertyIsEnumerable(0)})?function(t){return"String"===n(t)?a(t,""):o(t)}:o},7134:(t,e,i)=>{"use strict";var s=i(9762);t.exports=function(t){if(!s(t))throw new TypeError("Cannot use null or undefined");return t}},7254:(t,e,i)=>{"use strict";var s=i(6518),r=i(6194),n=i(2248),o=n.get,a=n.has,h=n.set;s({target:"Map",proto:!0,real:!0,forced:!0},{getOrInsert:function(t,e){return a(r(this),t)?o(this,t):(h(this,t,e),e)}})},7268:(t,e,i)=>{"use strict";var s=i(6518),r=i(6080),n=i(6194),o=i(6223);s({target:"Map",proto:!0,real:!0,forced:!0},{some:function(t){var e=n(this),i=r(t,arguments.length>1?arguments[1]:void 0);return!0===o(e,function(t,s){if(i(t,s,e))return!0},!0)}})},7273:(t,e,i)=>{"use strict";var s=i(6518),r=i(3317),n=i(6194),o=i(6223);s({target:"Map",proto:!0,real:!0,forced:!0},{includes:function(t){return!0===o(n(this),function(e){if(r(e,t))return!0},!0)}})},7347:(t,e,i)=>{"use strict";var s=i(3724),r=i(9565),n=i(8773),o=i(6980),a=i(5397),h=i(6969),c=i(9297),l=i(5917),u=Object.getOwnPropertyDescriptor;e.f=s?u:function(t,e){if(t=a(t),e=h(e),l)try{return u(t,e)}catch(t){}if(c(t,e))return o(!r(n.f,t,e),t[e])}},7394:(t,e,i)=>{"use strict";var s=i(4576),r=i(6706),n=i(2195),o=s.ArrayBuffer,a=s.TypeError;t.exports=o&&r(o.prototype,"byteLength","get")||function(t){if("ArrayBuffer"!==n(t))throw new a("ArrayBuffer expected");return t.byteLength}},7415:(t,e,i)=>{"use strict";var s=i(6518),r=i(6194),n=i(6223);s({target:"Map",proto:!0,real:!0,forced:!0},{keyOf:function(t){var e=n(r(this),function(e,i){if(e===t)return{key:i}},!0);return e&&e.key}})},7476:(t,e,i)=>{"use strict";var s=i(2195),r=i(9504);t.exports=function(t){if("Function"===s(t))return r(t)}},7566:(t,e,i)=>{"use strict";var s=i(6840),r=i(9504),n=i(655),o=i(2812),a=URLSearchParams,h=a.prototype,c=r(h.getAll),l=r(h.has),u=new a("a=1");!u.has("a",2)&&u.has("a",void 0)||s(h,"has",function(t){var e=arguments.length,i=e<2?void 0:arguments[1];if(e&&void 0===i)return l(this,t);var s=c(this,t);o(e,1);for(var r=n(i),a=0;a<s.length;)if(s[a++]===r)return!0;return!1},{enumerable:!0,unsafe:!0})},7583:(t,e,i)=>{"use strict";var s=i(6518),r=i(6080),n=i(6194),o=i(2248),a=i(6223),h=o.Map,c=o.set;s({target:"Map",proto:!0,real:!0,forced:!0},{mapValues:function(t){var e=n(this),i=r(t,arguments.length>1?arguments[1]:void 0),s=new h;return a(e,function(t,r){c(s,r,i(t,r,e))}),s}})},7588:(t,e,i)=>{"use strict";var s=i(6518),r=i(9565),n=i(2652),o=i(9306),a=i(8551),h=i(1767),c=i(9539),l=i(4549)("forEach",TypeError);s({target:"Iterator",proto:!0,real:!0,forced:l},{forEach:function(t){a(this);try{o(t)}catch(t){c(this,"throw",t)}if(l)return r(l,this,t);var e=h(this),i=0;n(e,function(e){t(e,i++)},{IS_RECORD:!0})}})},7629:(t,e,i)=>{"use strict";var s=i(6395),r=i(4576),n=i(9433),o="__core-js_shared__",a=t.exports=r[o]||n(o,{});(a.versions||(a.versions=[])).push({version:"3.44.0",mode:s?"pure":"global",copyright:"© 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.44.0/LICENSE",source:"https://github.com/zloirock/core-js"})},7657:(t,e,i)=>{"use strict";var s,r,n,o=i(9039),a=i(4901),h=i(34),c=i(2360),l=i(2787),u=i(6840),d=i(8227),p=i(6395),f=d("iterator"),g=!1;[].keys&&("next"in(n=[].keys())?(r=l(l(n)))!==Object.prototype&&(s=r):g=!0),!h(s)||o(function(){var t={};return s[f].call(t)!==t})?s={}:p&&(s=c(s)),a(s[f])||u(s,f,function(){return this}),t.exports={IteratorPrototype:s,BUGGY_SAFARI_ITERATORS:g}},7696:(t,e,i)=>{"use strict";var s=i(1291),r=i(8014),n=RangeError;t.exports=function(t){if(void 0===t)return 0;var e=s(t),i=r(e);if(e!==i)throw new n("Wrong length or index");return i}},7740:(t,e,i)=>{"use strict";var s=i(9297),r=i(5031),n=i(7347),o=i(4913);t.exports=function(t,e,i){for(var a=r(e),h=o.f,c=n.f,l=0;l<a.length;l++){var u=a[l];s(t,u)||i&&s(i,u)||h(t,u,c(e,u))}}},7750:(t,e,i)=>{"use strict";var s=i(4117),r=TypeError;t.exports=function(t){if(s(t))throw new r("Can't call method on "+t);return t}},7751:(t,e,i)=>{"use strict";var s=i(4576),r=i(4901);t.exports=function(t,e){return arguments.length<2?(i=s[t],r(i)?i:void 0):s[t]&&s[t][e];var i}},7811:t=>{"use strict";t.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},7936:(t,e,i)=>{"use strict";var s=i(6518),r=i(5636);r&&s({target:"ArrayBuffer",proto:!0},{transferToFixedLength:function(){return r(this,arguments.length?arguments[0]:void 0,!1)}})},8014:(t,e,i)=>{"use strict";var s=i(1291),r=Math.min;t.exports=function(t){var e=s(t);return e>0?r(e,9007199254740991):0}},8100:(t,e,i)=>{"use strict";var s=i(6518),r=i(5636);r&&s({target:"ArrayBuffer",proto:!0},{transfer:function(){return r(this,arguments.length?arguments[0]:void 0,!0)}})},8111:(t,e,i)=>{"use strict";var s=i(6518),r=i(4576),n=i(679),o=i(8551),a=i(4901),h=i(2787),c=i(2106),l=i(4659),u=i(9039),d=i(9297),p=i(8227),f=i(7657).IteratorPrototype,g=i(3724),m=i(6395),v="constructor",y="Iterator",w=p("toStringTag"),b=TypeError,x=r[y],E=m||!a(x)||x.prototype!==f||!u(function(){x({})}),T=function(){if(n(this,f),h(this)===f)throw new b("Abstract class Iterator not directly constructable")},k=function(t,e){g?c(f,t,{configurable:!0,get:function(){return e},set:function(e){if(o(this),this===f)throw new b("You can't redefine this property");d(this,t)?this[t]=e:l(this,t,e)}}):f[t]=e};d(f,w)||k(w,y),!E&&d(f,v)&&f[v]!==Object||k(v,T),T.prototype=f,s({global:!0,constructor:!0,forced:E},{Iterator:T})},8175:t=>{"use strict";t.exports=function(t){return null!=t}},8221:(t,e,i)=>{var s=i(3805),r=i(124),n=i(9374),o=Math.max,a=Math.min;t.exports=function(t,e,i){var h,c,l,u,d,p,f=0,g=!1,m=!1,v=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function y(e){var i=h,s=c;return h=c=void 0,f=e,u=t.apply(s,i)}function w(t){var i=t-p;return void 0===p||i>=e||i<0||m&&t-f>=l}function b(){var t=r();if(w(t))return x(t);d=setTimeout(b,function(t){var i=e-(t-p);return m?a(i,l-(t-f)):i}(t))}function x(t){return d=void 0,v&&h?y(t):(h=c=void 0,u)}function E(){var t=r(),i=w(t);if(h=arguments,c=this,p=t,i){if(void 0===d)return function(t){return f=t,d=setTimeout(b,e),g?y(t):u}(p);if(m)return clearTimeout(d),d=setTimeout(b,e),y(p)}return void 0===d&&(d=setTimeout(b,e)),u}return e=n(e)||0,s(i)&&(g=!!i.leading,l=(m="maxWait"in i)?o(n(i.maxWait)||0,e):l,v="trailing"in i?!!i.trailing:v),E.cancel=function(){void 0!==d&&clearTimeout(d),f=0,h=p=c=d=void 0},E.flush=function(){return void 0===d?u:x(r())},E}},8227:(t,e,i)=>{"use strict";var s=i(4576),r=i(5745),n=i(9297),o=i(3392),a=i(4495),h=i(7040),c=s.Symbol,l=r("wks"),u=h?c.for||c:c&&c.withoutSetter||o;t.exports=function(t){return n(l,t)||(l[t]=a&&n(c,t)?c[t]:u("Symbol."+t)),l[t]}},8235:(t,e,i)=>{"use strict";var s=i(9504),r=i(9297),n=SyntaxError,o=parseInt,a=String.fromCharCode,h=s("".charAt),c=s("".slice),l=s(/./.exec),u={'\\"':'"',"\\\\":"\\","\\/":"/","\\b":"\b","\\f":"\f","\\n":"\n","\\r":"\r","\\t":"\t"},d=/^[\da-f]{4}$/i,p=/^[\u0000-\u001F]$/;t.exports=function(t,e){for(var i=!0,s="";e<t.length;){var f=h(t,e);if("\\"===f){var g=c(t,e,e+2);if(r(u,g))s+=u[g],e+=2;else{if("\\u"!==g)throw new n('Unknown escape sequence: "'+g+'"');var m=c(t,e+=2,e+4);if(!l(d,m))throw new n("Bad Unicode escape at: "+e);s+=a(o(m,16)),e+=4}}else{if('"'===f){i=!1,e++;break}if(l(p,f))throw new n("Bad control character in string literal at: "+e);s+=f,e++}}if(i)throw new n("Unterminated string at: "+e);return{value:s,end:e}}},8237:(t,e,i)=>{"use strict";var s=i(6518),r=i(2652),n=i(9306),o=i(8551),a=i(1767),h=i(9539),c=i(4549),l=i(8745),u=i(9039),d=TypeError,p=u(function(){[].keys().reduce(function(){},void 0)}),f=!p&&c("reduce",d);s({target:"Iterator",proto:!0,real:!0,forced:p||f},{reduce:function(t){o(this);try{n(t)}catch(t){h(this,"throw",t)}var e=arguments.length<2,i=e?void 0:arguments[1];if(f)return l(f,this,e?[t]:[t,i]);var s=a(this),c=0;if(r(s,function(s){e?(e=!1,i=s):i=t(i,s,c),c++},{IS_RECORD:!0}),e)throw new d("Reduce of empty iterator with no initial value");return i}})},8263:(t,e,i)=>{"use strict";var s=i(8175),r=i(6873),n=i(6596),o=i(148),a=i(214);(t.exports=function(t,e){var i,r,h,c,l;return arguments.length<2||"string"!=typeof t?(c=e,e=t,t=null):c=arguments[2],s(t)?(i=a.call(t,"c"),r=a.call(t,"e"),h=a.call(t,"w")):(i=h=!0,r=!1),l={value:e,configurable:i,enumerable:r,writable:h},c?n(o(c),l):l}).gs=function(t,e,i){var h,c,l,u;return"string"!=typeof t?(l=i,i=e,e=t,t=null):l=arguments[3],s(e)?r(e)?s(i)?r(i)||(l=i,i=void 0):i=void 0:(l=e,e=i=void 0):e=void 0,s(t)?(h=a.call(t,"c"),c=a.call(t,"e")):(h=!0,c=!1),u={get:e,set:i,configurable:h,enumerable:c},l?n(o(l),u):u}},8335:(t,e,i)=>{"use strict";var s=i(6518),r=i(3724),n=i(4576),o=i(7751),a=i(9504),h=i(9565),c=i(4901),l=i(34),u=i(4376),d=i(9297),p=i(655),f=i(6198),g=i(4659),m=i(9039),v=i(8235),y=i(4495),w=n.JSON,b=n.Number,x=n.SyntaxError,E=w&&w.parse,T=o("Object","keys"),k=Object.getOwnPropertyDescriptor,O=a("".charAt),C=a("".slice),N=a(/./.exec),S=a([].push),R=/^\d$/,L=/^[1-9]$/,j=/^[\d-]$/,A=/^[\t\n\r ]$/,P=function(t,e,i,s){var r,n,o,a,c,p=t[e],g=s&&p===s.value,m=g&&"string"==typeof s.source?{source:s.source}:{};if(l(p)){var v=u(p),y=g?s.nodes:v?[]:{};if(v)for(r=y.length,o=f(p),a=0;a<o;a++)M(p,a,P(p,""+a,i,a<r?y[a]:void 0));else for(n=T(p),o=f(n),a=0;a<o;a++)c=n[a],M(p,c,P(p,c,i,d(y,c)?y[c]:void 0))}return h(i,t,e,p,m)},M=function(t,e,i){if(r){var s=k(t,e);if(s&&!s.configurable)return}void 0===i?delete t[e]:g(t,e,i)},I=function(t,e,i,s){this.value=t,this.end=e,this.source=i,this.nodes=s},_=function(t,e){this.source=t,this.index=e};_.prototype={fork:function(t){return new _(this.source,t)},parse:function(){var t=this.source,e=this.skip(A,this.index),i=this.fork(e),s=O(t,e);if(N(j,s))return i.number();switch(s){case"{":return i.object();case"[":return i.array();case'"':return i.string();case"t":return i.keyword(!0);case"f":return i.keyword(!1);case"n":return i.keyword(null)}throw new x('Unexpected character: "'+s+'" at: '+e)},node:function(t,e,i,s,r){return new I(e,s,t?null:C(this.source,i,s),r)},object:function(){for(var t=this.source,e=this.index+1,i=!1,s={},r={};e<t.length;){if(e=this.until(['"',"}"],e),"}"===O(t,e)&&!i){e++;break}var n=this.fork(e).string(),o=n.value;e=n.end,e=this.until([":"],e)+1,e=this.skip(A,e),n=this.fork(e).parse(),g(r,o,n),g(s,o,n.value),e=this.until([",","}"],n.end);var a=O(t,e);if(","===a)i=!0,e++;else if("}"===a){e++;break}}return this.node(1,s,this.index,e,r)},array:function(){for(var t=this.source,e=this.index+1,i=!1,s=[],r=[];e<t.length;){if(e=this.skip(A,e),"]"===O(t,e)&&!i){e++;break}var n=this.fork(e).parse();if(S(r,n),S(s,n.value),e=this.until([",","]"],n.end),","===O(t,e))i=!0,e++;else if("]"===O(t,e)){e++;break}}return this.node(1,s,this.index,e,r)},string:function(){var t=this.index,e=v(this.source,this.index+1);return this.node(0,e.value,t,e.end)},number:function(){var t=this.source,e=this.index,i=e;if("-"===O(t,i)&&i++,"0"===O(t,i))i++;else{if(!N(L,O(t,i)))throw new x("Failed to parse number at: "+i);i=this.skip(R,i+1)}if(!("."===O(t,i)&&(i=this.skip(R,i+1)),"e"!==O(t,i)&&"E"!==O(t,i)||(i++,"+"!==O(t,i)&&"-"!==O(t,i)||i++,i!==(i=this.skip(R,i)))))throw new x("Failed to parse number's exponent value at: "+i);return this.node(0,b(C(t,e,i)),e,i)},keyword:function(t){var e=""+t,i=this.index,s=i+e.length;if(C(this.source,i,s)!==e)throw new x("Failed to parse value at: "+i);return this.node(0,t,i,s)},skip:function(t,e){for(var i=this.source;e<i.length&&N(t,O(i,e));e++);return e},until:function(t,e){e=this.skip(A,e);for(var i=O(this.source,e),s=0;s<t.length;s++)if(t[s]===i)return e;throw new x('Unexpected character: "'+i+'" at: '+e)}};var D=m(function(){var t,e="9007199254740993";return E(e,function(e,i,s){t=s.source}),t!==e}),z=y&&!m(function(){return 1/E("-0 \t")!=-1/0});s({target:"JSON",stat:!0,forced:D},{parse:function(t,e){return z&&!c(e)?E(t):function(t,e){t=p(t);var i=new _(t,0,""),s=i.parse(),r=s.value,n=i.skip(A,s.end);if(n<t.length)throw new x('Unexpected extra character: "'+O(t,n)+'" after the parsed data at: '+n);return c(e)?P({"":r},"",e,s):r}(t,e)}})},8480:(t,e,i)=>{"use strict";var s=i(1828),r=i(8727).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return s(t,r)}},8551:(t,e,i)=>{"use strict";var s=i(34),r=String,n=TypeError;t.exports=function(t){if(s(t))return t;throw new n(r(t)+" is not an object")}},8574:(t,e,i)=>{"use strict";var s=i(9504),r=Error,n=s("".replace),o=String(new r("zxcasd").stack),a=/\n\s*at [^:]*:[^\n]*/,h=a.test(o);t.exports=function(t,e){if(h&&"string"==typeof t&&!r.prepareStackTrace)for(;e--;)t=n(t,a,"");return t}},8622:(t,e,i)=>{"use strict";var s=i(4576),r=i(4901),n=s.WeakMap;t.exports=r(n)&&/native code/.test(String(n))},8686:(t,e,i)=>{"use strict";var s=i(3724),r=i(9039);t.exports=s&&r(function(){return 42!==Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype})},8721:(t,e,i)=>{"use strict";var s=i(3724),r=i(9504),n=i(2106),o=URLSearchParams.prototype,a=r(o.forEach);s&&!("size"in o)&&n(o,"size",{get:function(){var t=0;return a(this,function(){t++}),t},configurable:!0,enumerable:!0})},8727:t=>{"use strict";t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},8745:(t,e,i)=>{"use strict";var s=i(616),r=Function.prototype,n=r.apply,o=r.call;t.exports="object"==typeof Reflect&&Reflect.apply||(s?o.bind(n):function(){return o.apply(n,arguments)})},8773:(t,e)=>{"use strict";var i={}.propertyIsEnumerable,s=Object.getOwnPropertyDescriptor,r=s&&!i.call({1:2},1);e.f=r?function(t){var e=s(this,t);return!!e&&e.enumerable}:i},8981:(t,e,i)=>{"use strict";var s=i(7750),r=Object;t.exports=function(t){return r(s(t))}},9039:t=>{"use strict";t.exports=function(t){try{return!!t()}catch(t){return!0}}},9202:(t,e,i)=>{"use strict";var s=i(181);t.exports=function(t){if(!s(t))return!1;try{return!!t.constructor&&t.constructor.prototype===t}catch(t){return!1}}},9297:(t,e,i)=>{"use strict";var s=i(9504),r=i(8981),n=s({}.hasOwnProperty);t.exports=Object.hasOwn||function(t,e){return n(r(t),e)}},9306:(t,e,i)=>{"use strict";var s=i(4901),r=i(6823),n=TypeError;t.exports=function(t){if(s(t))return t;throw new n(r(t)+" is not a function")}},9325:(t,e,i)=>{var s=i(4840),r="object"==typeof self&&self&&self.Object===Object&&self,n=s||r||Function("return this")();t.exports=n},9350:t=>{var e=Object.prototype.toString;t.exports=function(t){return e.call(t)}},9374:(t,e,i)=>{var s=i(4128),r=i(3805),n=i(4394),o=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,h=/^0o[0-7]+$/i,c=parseInt;t.exports=function(t){if("number"==typeof t)return t;if(n(t))return NaN;if(r(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=r(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=s(t);var i=a.test(t);return i||h.test(t)?c(t.slice(2),i?2:8):o.test(t)?NaN:+t}},9429:(t,e,i)=>{"use strict";var s=i(4576),r=i(6193);t.exports=function(t){if(r){try{return s.process.getBuiltinModule(t)}catch(t){}try{return Function('return require("'+t+'")')()}catch(t){}}}},9433:(t,e,i)=>{"use strict";var s=i(4576),r=Object.defineProperty;t.exports=function(t,e){try{r(s,t,{value:e,configurable:!0,writable:!0})}catch(i){s[t]=e}return e}},9462:(t,e,i)=>{"use strict";var s=i(9565),r=i(2360),n=i(6699),o=i(6279),a=i(8227),h=i(1181),c=i(5966),l=i(7657).IteratorPrototype,u=i(2529),d=i(9539),p=i(1385),f=a("toStringTag"),g="IteratorHelper",m="WrapForValidIterator",v="normal",y="throw",w=h.set,b=function(t){var e=h.getterFor(t?m:g);return o(r(l),{next:function(){var i=e(this);if(t)return i.nextHandler();if(i.done)return u(void 0,!0);try{var s=i.nextHandler();return i.returnHandlerResult?s:u(s,i.done)}catch(t){throw i.done=!0,t}},return:function(){var i=e(this),r=i.iterator;if(i.done=!0,t){var n=c(r,"return");return n?s(n,r):u(void 0,!0)}if(i.inner)try{d(i.inner.iterator,v)}catch(t){return d(r,y,t)}if(i.openIters)try{p(i.openIters,v)}catch(t){return d(r,y,t)}return r&&d(r,v),u(void 0,!0)}})},x=b(!0),E=b(!1);n(E,f,"Iterator Helper"),t.exports=function(t,e,i){var s=function(s,r){r?(r.iterator=s.iterator,r.next=s.next):r=s,r.type=e?m:g,r.returnHandlerResult=!!i,r.nextHandler=t,r.counter=0,r.done=!1,w(this,r)};return s.prototype=e?x:E,s}},9504:(t,e,i)=>{"use strict";var s=i(616),r=Function.prototype,n=r.call,o=s&&r.bind.bind(n,n);t.exports=s?o:function(t){return function(){return n.apply(t,arguments)}}},9519:(t,e,i)=>{"use strict";var s,r,n=i(4576),o=i(2839),a=n.process,h=n.Deno,c=a&&a.versions||h&&h.version,l=c&&c.v8;l&&(r=(s=l.split("."))[0]>0&&s[0]<4?1:+(s[0]+s[1])),!r&&o&&(!(s=o.match(/Edge\/(\d+)/))||s[1]>=74)&&(s=o.match(/Chrome\/(\d+)/))&&(r=+s[1]),t.exports=r},9539:(t,e,i)=>{"use strict";var s=i(9565),r=i(8551),n=i(5966);t.exports=function(t,e,i){var o,a;r(t);try{if(!(o=n(t,"return"))){if("throw"===e)throw i;return i}o=s(o,t)}catch(t){a=!0,o=t}if("throw"===e)throw i;if(a)throw o;return r(o),i}},9565:(t,e,i)=>{"use strict";var s=i(616),r=Function.prototype.call;t.exports=s?r.bind(r):function(){return r.apply(r,arguments)}},9617:(t,e,i)=>{"use strict";var s=i(5397),r=i(5610),n=i(6198),o=function(t){return function(e,i,o){var a=s(e),h=n(a);if(0===h)return!t&&-1;var c,l=r(o,h);if(t&&i!=i){for(;h>l;)if((c=a[l++])!=c)return!0}else for(;h>l;l++)if((t||l in a)&&a[l]===i)return t||l||0;return!t&&-1}};t.exports={includes:o(!0),indexOf:o(!1)}},9733:(t,e,i)=>{"use strict";var s=i(6518),r=i(9306),n=i(6194),o=i(2248),a=TypeError,h=o.get,c=o.has,l=o.set;s({target:"Map",proto:!0,real:!0,forced:!0},{update:function(t,e){var i=n(this),s=arguments.length;r(e);var o=c(i,t);if(!o&&s<3)throw new a("Updating absent value");var u=o?h(i,t):r(s>2?arguments[2]:void 0)(t,i);return l(i,t,e(u,t,i)),i}})},9762:(t,e,i)=>{"use strict";var s=i(6011)();t.exports=function(t){return t!==s&&null!==t}},9929:(t,e,i)=>{"use strict";var s=i(6518),r=i(6080),n=i(6194),o=i(2248),a=i(6223),h=o.Map,c=o.set;s({target:"Map",proto:!0,real:!0,forced:!0},{mapKeys:function(t){var e=n(this),i=r(t,arguments.length>1?arguments[1]:void 0),s=new h;return a(e,function(t,r){c(s,i(t,r,e),t)}),s}})}},s={};function r(t){var e=s[t];if(void 0!==e)return e.exports;var n=s[t]={exports:{}};return i[t].call(n.exports,n,n.exports,r),n.exports}r.d=(t,e)=>{for(var i in e)r.o(e,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};return(()=>{"use strict";r.d(n,{default:()=>vi});var t={};r.r(t),r.d(t,{blob2base64:()=>I,borders:()=>m,bounds:()=>g,createBase64Url:()=>C,createBlob:()=>T,createBlobUrl:()=>k,defaults:()=>l,documentHeight:()=>s,extend:()=>u,filterChildren:()=>B,findChildren:()=>D,getParentByTagName:()=>F,indexOfElementNode:()=>x,indexOfNode:()=>w,indexOfSorted:()=>f,indexOfTextNode:()=>b,insert:()=>p,isElement:()=>o,isFloat:()=>h,isNumber:()=>a,isXml:()=>E,locationOf:()=>d,nodeBounds:()=>v,parents:()=>z,parse:()=>S,prefixed:()=>c,qs:()=>R,qsa:()=>L,qsp:()=>j,querySelectorByType:()=>_,revokeBlobUrl:()=>O,sprint:()=>A,treeWalker:()=>P,type:()=>N,uuid:()=>i,walk:()=>M,windowBounds:()=>y}),r(6573),r(8100),r(7936);var e=r(3068);r(4114),r(8111),r(2489),r(7588),r(4979),r(4603),r(7566),r(8721);const i=()=>{let t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?i:7&i|8).toString(16)})},s=()=>Math.max(document.documentElement.clientHeight,document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight),o=t=>!(!t||t.nodeType!=Node.ELEMENT_NODE),a=t=>!isNaN(parseFloat(t))&&isFinite(t),h=t=>{const e=parseFloat(t);return!1!==a(t)&&("string"==typeof t&&t.indexOf(".")>-1||Math.floor(e)!==e)},c=t=>{const e=["-webkit-","-webkit-","-moz-","-o-","-ms-"],i=t.toLowerCase();if("undefined"==typeof document||void 0!==document.body.style[i])return t;for(let t=0;t<5;t++)if(void 0!==document.body.style[e[t]+i])return e[t]+i;return t},l=(t,...e)=>{for(let i=1,s=e.length;i<s;i++){const s=e[i];for(const e in s)void 0===t[e]&&(t[e]=s[e])}return t},u=(t,...e)=>(e.forEach(e=>{e&&Object.getOwnPropertyNames(e).forEach(i=>{Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))})}),t),d=(t,e,i,s,r)=>{const n=s||0,o=r||e.length,a=parseInt(n+(o-n)/2);if(i||(i=(t,e)=>t>e?1:t<e?-1:t==e?0:void 0),o-n<=0)return a;const h=i(e[a],t);return o-n===1?h>=0?a:a+1:0===h?a:-1===h?d(t,e,i,a,o):d(t,e,i,n,a)},p=(t,e,i)=>{const s=d(t,e,i);return e.splice(s,0,t),s},f=(t,e,i,s,r)=>{const n=s||0,o=r||e.length,a=parseInt(n+(o-n)/2);if(i||(i=(t,e)=>t>e?1:t<e?-1:t==e?0:void 0),o-n<=0)return-1;const h=i(e[a],t);return o-n===1?0===h?a:-1:0===h?a:-1===h?f(t,e,i,a,o):f(t,e,i,n,a)},g=t=>{const e=window.getComputedStyle(t),i={height:0,width:0};return["width","paddingRight","paddingLeft","marginRight","marginLeft","borderRightWidth","borderLeftWidth"].forEach(t=>{i.width+=parseFloat(e[t])||0}),["height","paddingTop","paddingBottom","marginTop","marginBottom","borderTopWidth","borderBottomWidth"].forEach(t=>{i.height+=parseFloat(e[t])||0}),i},m=t=>{const e=window.getComputedStyle(t),i={height:0,width:0};return["paddingRight","paddingLeft","marginRight","marginLeft","borderRightWidth","borderLeftWidth"].forEach(t=>{i.width+=parseFloat(e[t])||0}),["paddingTop","paddingBottom","marginTop","marginBottom","borderTopWidth","borderBottomWidth"].forEach(t=>{i.height+=parseFloat(e[t])||0}),i},v=t=>{let e;const i=t.ownerDocument;if(t.nodeType==Node.TEXT_NODE){const s=i.createRange();s.selectNodeContents(t),e=s.getBoundingClientRect()}else e=t.getBoundingClientRect();return e},y=()=>{const t=window.innerWidth,e=window.innerHeight;return{top:0,left:0,right:t,bottom:e,width:t,height:e}},w=(t,e)=>{const i=t.parentNode.childNodes;let s=-1;for(let r=0;r<i.length;r++){const n=i[r];if(n.nodeType===e&&s++,n==t)break}return s},b=t=>w(t,Node.TEXT_NODE),x=t=>w(t,Node.ELEMENT_NODE),E=t=>["xml","opf","ncx"].indexOf(t)>-1,T=(t,e)=>new Blob([t],{type:e}),k=(t,e)=>{const i=T(t,e);return URL.createObjectURL(i)},O=t=>URL.revokeObjectURL(t),C=(t,e)=>{if("string"==typeof t)return"data:"+e+";base64,"+btoa(t)},N=t=>Object.prototype.toString.call(t).slice(8,-1),S=(t,e)=>(65279===t.charCodeAt(0)&&(t=t.slice(1)),(new DOMParser).parseFromString(t,e)),R=(t,e)=>{if(!t)throw new Error("No Element Provided");if(void 0!==t.querySelector)return t.querySelector(e);{const i=t.getElementsByTagName(e);if(i.length)return i[0]}},L=(t,e)=>void 0!==t.querySelector?t.querySelectorAll(e):t.getElementsByTagName(e),j=(t,e,i)=>{if(void 0!==t.querySelector){e+="[";for(const t in i)e+=t+"~='"+i[t]+"'";return e+="]",t.querySelector(e)}{const s=t.getElementsByTagName(e),r=Array.prototype.slice.call(s,0).filter(t=>{for(const e in i)if(t.getAttribute(e)===i[e])return!0;return!1});if(r)return r[0]}},A=(t,e)=>{void 0!==(t.ownerDocument||t).createTreeWalker?P(t,e,NodeFilter.SHOW_TEXT):M(t,t=>{t&&t.nodeType===Node.TEXT_NODE&&e(t)},!0)},P=(t,e,i)=>{const s=document.createTreeWalker(t,i,null,!1);let r;for(;r=s.nextNode();)e(r)},M=(t,e)=>{if(e(t))return!0;if(t=t.firstChild)do{if(M(t,e))return!0;t=t.nextSibling}while(t);return!1},I=t=>new Promise((e,i)=>{const s=new FileReader;s.readAsDataURL(t),s.onloadend=()=>{e(s.result)}}),_=(t,e,i)=>{let s;if(void 0!==t.querySelector&&(s=t.querySelector(`${e}[*|type="${i}"]`)),s&&0!==s.length)return s;s=L(t,e);for(let t=0;t<s.length;t++)if(s[t].getAttributeNS("http://www.idpf.org/2007/ops","type")===i||s[t].getAttribute("epub:type")===i)return s[t]},D=t=>{const e=[],i=t.childNodes;for(let t=0;t<i.length;t++){const s=i[t];s.nodeType===Node.ELEMENT_NODE&&e.push(s)}return e},z=t=>{const e=[t];for(;t;t=t.parentNode)e.unshift(t);return e},B=(t,e,i)=>{const s=[],r=t.childNodes;for(let t=0;t<r.length;t++){const n=r[t];if(n.nodeType===Node.ELEMENT_NODE&&n.nodeName.toLowerCase()===e){if(i)return n;s.push(n)}}if(!i)return s},F=(t,e)=>{if(null===t||""===e)return;let i=t.parentNode;for(;i.nodeType===Node.ELEMENT_NODE;){if(i.tagName.toLowerCase()===e)return i;i=i.parentNode}},q=class{constructor(){this.id=i(),this.dump={},this.resolve=null,this.reject=null,this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}destroy(){Object.keys(this).forEach(t=>this[t]=void 0)}},U=class{constructor(t){t.indexOf("://")>-1&&(t=new URL(t).pathname);const e=this.parse(t);this.directory=e.dir+"/",this.filename=e.base,this.extension=e.ext.slice(1),this.path=t}parse(t){const e={root:"",dir:"",base:"",ext:"",name:""};if(0===t.length)return e;const i=this.splitPath(t);if(!i||4!==i.length)throw new Error(`Invalid path: ${t}`);return e.root=i[0],this.isDirectory(t)?e.dir=i[0]+i[1]+i[2]:(e.dir=i[0]+i[1].slice(0,-1),e.base=i[2],e.ext=i[3],e.name=i[2].slice(0,i[2].length-i[3].length)),e}dirname(t){const e=this.splitPath(t),i=e[0],s=e[1];return i||s?i+s:"."}isAbsolute(t){return"/"===t.charAt(0)}isDirectory(t){return"/"===t.charAt(t.length-1)}resolve(){let t="",e=!1;for(let i=arguments.length-1;i>=-1&&!e;i--){let s;s=i>=0?arguments[i]:"/",0!==s.length&&(t=s+"/"+t,e=this.isAbsolute(s))}return t=this.normalizeArray(t.split("/"),!e).join("/"),(e?"/":"")+t||"."}relative(t,e){if(t===e)return"";if((t=this.resolve(t))===(e=this.resolve(e)))return"";const i=this.trimArray(t.split("/")),s=this.trimArray(e.split("/")),r=Math.min(i.length,s.length);let n=r;for(let t=0;t<r;t++)if(i[t]!==s[t]){n=t;break}let o=[];for(let t=n;t<i.length;t++)o.push("..");return o=o.concat(s.slice(n)),o.join("/")}normalize(t){const e=this.isAbsolute(t),i=t&&"/"===t[t.length-1];return(t=this.normalizeArray(t.split("/"),!e).join("/"))||e||(t="."),t&&i&&(t+="/"),(e?"/":"")+t}toString(){return this.path}normalizeArray(t,e){const i=[];for(let s=0;s<t.length;s++){const r=t[s];r&&"."!==r&&(".."===r?i.length&&".."!==i[i.length-1]?i.pop():e&&i.push(".."):i.push(r))}return i}splitPath(t){return/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(t).slice(1)}trimArray(t){const e=t.length-1;let i=0;for(;i<=e&&!t[i];i++);let s=e;for(;s>=0&&!t[s];s--);return 0===i&&s===e?t:i>s?[]:t.slice(i,s+1)}},W=class{constructor(t,e){this.Url=void 0,this.href=t,this.protocol="",this.origin="",this.hash="",this.hash="",this.search="",this.base=e;const i=t.indexOf("://")>-1;!i&&!1!==e&&"string"!=typeof e&&window&&window.location&&(this.base=window.location.href);let s=t;if(i||this.base){try{this.base?this.Url=new URL(t,this.base):this.Url=new URL(t),this.href=this.Url.href,this.protocol=this.Url.protocol,this.origin=this.Url.origin,this.hash=this.Url.hash,this.search=this.Url.search,s=this.Url.pathname+(this.Url.search?this.Url.search:"")}catch(t){this.Url=void 0,this.base&&(s=new U(this.base).resolve(s)),console.error(t)}"null"===this.origin&&"file:"===this.protocol&&(this.origin="file://")}this.path=new U(s),this.directory=this.path.directory,this.filename=this.path.filename,this.extension=this.path.extension}resolve(t){if(t.indexOf("://")>-1)return t;const e=this.path.directory,i=U.prototype.resolve(e,t);return this.origin+i}relative(t){const e=this.path.directory;return U.prototype.relative(t,e)}toString(){return this.href}};r(8335),r(1517),r(1379),r(3777),r(4190),r(2359),r(6097),r(7254),r(7036),r(7273),r(7415),r(9929),r(7583),r(5122),r(230),r(7268),r(9733),r(1701);const H=class{constructor(){this.collapsed=!1,this.commonAncestorContainer=void 0,this.endContainer=void 0,this.endOffset=void 0,this.startContainer=void 0,this.startOffset=void 0}setStart(t,e){this.startContainer=t,this.startOffset=e,this.endContainer?this.commonAncestorContainer=this._commonAncestorContainer():this.collapse(!0),this._checkCollapsed()}setEnd(t,e){this.endContainer=t,this.endOffset=e,this.startContainer?(this.collapsed=!1,this.commonAncestorContainer=this._commonAncestorContainer()):this.collapse(!1),this._checkCollapsed()}collapse(t){this.collapsed=!0,t?(this.endContainer=this.startContainer,this.endOffset=this.startOffset,this.commonAncestorContainer=this.startContainer.parentNode):(this.startContainer=this.endContainer,this.startOffset=this.endOffset,this.commonAncestorContainer=this.endOffset.parentNode)}selectNode(t){const e=t.parentNode,i=Array.prototype.indexOf.call(e.childNodes,t);this.setStart(e,i),this.setEnd(e,i+1)}selectNodeContents(t){const e=t.nodeType===Node.TEXT_NODE?t.textContent.length:parent.childNodes.length;this.setStart(t,0),this.setEnd(t,e)}_commonAncestorContainer(t,e){const i=z(t||this.startContainer),s=z(e||this.endContainer);if(i[0]==s[0])for(let t=0;t<i.length;t++)if(i[t]!=s[t])return i[t-1]}_checkCollapsed(){this.startContainer===this.endContainer&&this.startOffset===this.endOffset?this.collapsed=!0:this.collapsed=!1}toString(){}};class X{constructor(t,e,i){this.base={},this.hash="",this.ignoreClass="",this.path={},this.range=!1,this.spinePos=0,this.start=null,this.end=null,this.type=void 0,this.set({data:t,base:e,ignoreClass:i})}set(t){let e,i,s,r;const n=t=>{i||("string"==typeof t?(this.base=this.parseComponent(t),this.spinePos=this.base.steps[1].index):"object"==typeof t&&t.steps&&(this.base=t),i=this.base)},o=t=>{s||("string"==typeof t&&(this.ignoreClass=t),s=this.ignoreClass)},a=t=>{if(!e){if(r=r||this.checkType(t),"string"===r)e=this.parse(t);else if("range"===r)e=this.fromRange(t,i,s);else if("node"===r)e=this.fromNode(t,i,s);else if("EpubCFI"===r)e=t;else{if(t)throw new TypeError("not a valid argument for EpubCFI");e=this}e.type=r||this.type}};return Object.keys(t).forEach(e=>{const i=t[e];this[e]===i||void 0===i?delete t[e]:"data"===e?(n(t.base),o(t.ignoreClass),a(i)):"base"===e?(n(i),o(t.ignoreClass),a(t.data)):"ignoreClass"===e&&(n(t.base),o(i),a(t.data))}),e?Object.assign(this,e):this}checkType(t){return void 0===t?void 0:this.isCfiString(t)?"string":"object"==typeof t?t instanceof Range||void 0!==t.startContainer?"range":t instanceof Node?"node":t instanceof X?"EpubCFI":void 0:void 0}collapse(t){!1!==this.range&&(t?(this.path.steps=this.path.steps.concat(this.start.steps),this.path.terminal=this.start.terminal):(this.path.steps=this.path.steps.concat(this.end.steps),this.path.terminal=this.end.terminal),this.range=!1)}compare(t,e){if("string"==typeof t&&(t=new X(t)),"string"==typeof e&&(e=new X(e)),t.spinePos>e.spinePos)return 1;if(t.spinePos<e.spinePos)return-1;let i,s,r,n;t.range?(i=t.path.steps.concat(t.start.steps),s=t.start.terminal):(i=t.path.steps,s=t.path.terminal),e.range?(r=e.path.steps.concat(e.start.steps),n=e.start.terminal):(r=e.path.steps,n=e.path.terminal);for(let t=0;t<i.length;t++){if(!i[t])return-1;if(!r[t])return 1;if(i[t].index>r[t].index)return 1;if(i[t].index<r[t].index)return-1}return i.length<r.length?-1:s.offset>n.offset?1:s.offset<n.offset?-1:0}generateChapterComponent(t,e,i){let s="/"+2*(t+1)+"/";return s+=2*(parseInt(e)+1),i&&(s+="["+i+"]"),s}getBaseComponent(t){return t.split("!")[0]}getPathComponent(t){const e=t.split("!");if(e[1])return e[1].split(",")[0]}getRange(t){const e=t.split(",");return 3===e.length?[e[1],e[2]]:null}getCharacterOffsetComponent(t){return t.split(":")[1]||""}isCfiString(t){return"string"==typeof t&&0===t.indexOf("epubcfi(")&&")"===t[t.length-1]}joinSteps(t){return t?t.map(t=>{let e="";return"element"===t.type&&(e+=2*(t.index+1)),"text"===t.type&&(e+=1+2*t.index),t.id&&(e+="["+t.id+"]"),e}).join("/"):""}pathTo(t,e,i){const s={steps:[],terminal:{offset:null,assertion:null}};let r,n=t;for(;n&&n.parentNode&&n.parentNode.nodeType!==Node.DOCUMENT_NODE;)r=i?this.filteredStep(n,i):this.step(n),r&&s.steps.unshift(r),n=n.parentNode;if(null!==e&&e>=0){s.terminal.offset=e;const t=s.steps.length,i=t?t-1:t,r=i?s.steps[i].type:null;r&&"text"!==r&&s.steps.push({index:0,type:"text"})}return s}equalStep(t,e){return!(!t||!e||t.id!==e.id||t.index!==e.index||t.type!==e.type)}filter(t,e){let i,s,r;if(t.nodeType===Node.TEXT_NODE?(s=!0,i=t.parentNode,r=t.parentNode.classList.contains(e)):(s=!1,r=t.classList.contains(e)),r&&s){const e=i.previousSibling,s=i.nextSibling;let r;return e&&e.nodeType===Node.TEXT_NODE?r=e:s&&s.nodeType===Node.TEXT_NODE&&(r=s),r||t}return r&&!s?null:t}filteredPosition(t,e){let i,s;return t.nodeType===Node.ELEMENT_NODE?(i=t.parentNode.children,s=this.normalizedMap(i,Node.ELEMENT_NODE,e)):(i=t.parentNode.childNodes,t.parentNode.classList.contains(e)&&(i=(t=t.parentNode).parentNode.childNodes),s=this.normalizedMap(i,Node.TEXT_NODE,e)),s[Array.prototype.indexOf.call(i,t)]}filteredStep(t,e){const i=this.filter(t,e);if(null!==i)return{id:i.id,index:this.filteredPosition(i,e),tagName:i.tagName,type:i.nodeType===Node.TEXT_NODE?"text":"element"}}findNode(t,e,i){const s=e||document;let r;if(i)r=this.walkToNode(t,s,i);else if(void 0!==s.evaluate){const e=this.stepsToXpath(t),i=XPathResult.FIRST_ORDERED_NODE_TYPE;r=s.evaluate(e,s,null,i,null).singleNodeValue}else r=this.walkToNode(t,s);return r}fixMiss(t,e,i,s){let r=this.findNode(t.slice(0,-1),i,s);const n=r.childNodes,o=t[t.length-1].index,a=this.normalizedMap(n,Node.TEXT_NODE,s);for(const t in a){if(!a.hasOwnProperty(t))return;if(a[t]===o){const i=n[t],s=i.textContent.length;if(!(e>s)){r=i.nodeType===Node.ELEMENT_NODE?i.childNodes[0]:i;break}e-=s}}return{container:r,offset:e}}fromNode(t,e,i){const s=new X;return"string"==typeof e?(s.base=this.parseComponent(e),s.spinePos=s.base.steps[1].index):"object"==typeof e&&(s.base=e),s.path=this.pathTo(t,null,i),s}fromRange(t,e,i){const s=new X,r=t.startContainer,n=t.endContainer;let o=t.startOffset,a=t.endOffset,h=!1;const c=r.ownerDocument;i&&(h=null!==c.querySelector("."+i)),"string"==typeof e?(s.base=this.parseComponent(e),s.spinePos=s.base.steps[1].index):"object"==typeof e&&(s.base=e);const l=()=>{h&&(o=this.patchOffset(r,o,i))};if(t.collapsed)l(),s.path=this.pathTo(r,o,i);else{s.range=!0,l(),s.start=this.pathTo(r,o,i),h&&(a=this.patchOffset(n,a,i)),s.end=this.pathTo(n,a,i),s.path={steps:[],terminal:null};for(let t=0,e=s.start.steps.length;t<e&&this.equalStep(s.start.steps[t],s.end.steps[t]);t++)t===e-1?s.start.terminal===s.end.terminal&&(s.path.steps.push(s.start.steps[t]),s.range=!1):s.path.steps.push(s.start.steps[t]);s.start.steps=s.start.steps.slice(s.path.steps.length),s.end.steps=s.end.steps.slice(s.path.steps.length)}return s}normalizedMap(t,e,i){const s={};let r,n,o=-1;for(let a=0,h=t.length;a<h;a++)r=t[a].nodeType,r===Node.ELEMENT_NODE&&t[a].classList.contains(i)&&(r=Node.TEXT_NODE),a>0&&r===Node.TEXT_NODE&&n===Node.TEXT_NODE?s[a]=o:e===r&&(o+=1,s[a]=o),n=r;return s}parse(t){const e=new X;if("string"!=typeof t)throw new TypeError("invalid argument type");if(!this.isCfiString(t))throw new Error("invalid EpubCFI string format");e.hash=t,e.type="string",t=t.slice(8,t.length-1);const i=this.getBaseComponent(t);if(!i)return e.spinePos=-1,e;e.base=this.parseComponent(i);const s=this.getPathComponent(t);e.path=this.parseComponent(s);const r=this.getRange(t);return r&&(e.range=!0,e.start=this.parseComponent(r[0]),e.end=this.parseComponent(r[1])),e.spinePos=e.base.steps[1].index,e}parseComponent(t){const e={steps:[],terminal:{offset:null,assertion:null}},i=t.split(":"),s=i[0].split("/");return i.length>1&&(e.terminal=this.parseTerminal(i[1])),""===s[0]&&s.shift(),e.steps=s.map(t=>this.parseStep(t)),e}parseStep(t){const e=parseInt(t);if(isNaN(e))return;const i=e%2==0,s=t.match(/\[(.*)\]/);return{id:s&&s[1]?s[1]:null,index:i?e/2-1:(e-1)/2,type:i?"element":"text"}}parseTerminal(t){const e=t.match(/\[(.*)\]/),i=e&&e[1],s=i?t.split("[")[0]:t,r=parseInt(s);return{assertion:i?e[1]:null,offset:a(r)?r:null}}patchOffset(t,e,i){if(t.nodeType!==Node.TEXT_NODE)throw new Error("Anchor must be a text node");let s=t,r=e;for(t.parentNode.classList.contains(i)&&(s=t.parentNode);s.previousSibling;){if(s.previousSibling.nodeType===Node.ELEMENT_NODE){if(!s.previousSibling.classList.contains(i))break;r+=s.previousSibling.textContent.length}else r+=s.previousSibling.textContent.length;s=s.previousSibling}return r}position(t){let e,i;return t.nodeType===Node.ELEMENT_NODE?(e=t.parentNode.children,e||(e=D(t.parentNode)),i=Array.prototype.indexOf.call(e,t)):(e=this.textNodes(t.parentNode),i=e.indexOf(t)),i}segmentString(t){let e="/";return e+=this.joinSteps(t.steps),t.terminal&&null!==t.terminal.offset&&(e+=":"+t.terminal.offset),t.terminal&&null!==t.terminal.assertion&&(e+="["+t.terminal.assertion+"]"),e}step(t){return{id:t.id,index:this.position(t),tagName:t.tagName,type:t.nodeType===Node.TEXT_NODE?"text":"element"}}stepsToXpath(t){const e=[".","*"];return t.forEach(t=>{const i=t.index+1;t.id?e.push("*[position()="+i+" and @id='"+t.id+"']"):"text"===t.type?e.push("text()["+i+"]"):e.push("*["+i+"]")}),e.join("/")}stepsToQuerySelector(t){const e=["html"];return t.forEach(t=>{const i=t.index+1;t.id?e.push("#"+t.id):"text"===t.type||e.push("*:nth-child("+i+")")}),e.join(">")}textNodes(t,e){return Array.prototype.slice.call(t.childNodes).filter(t=>t.nodeType===Node.TEXT_NODE||!!t.classList.contains(e))}toRange(t,e){const i=t||document;let s,r,n,o,a,h,c,l,u;const d=e&&null!==i.querySelector("."+e)?e:void 0;if(l=void 0!==i.createRange?i.createRange():new H,this.range?(s=this.start,a=this.path.steps.concat(s.steps),n=this.findNode(a,i,d),r=this.end,h=this.path.steps.concat(r.steps),o=this.findNode(h,i,d)):(s=this.path,a=this.path.steps,n=this.findNode(a,i,d)),!n)throw new Error("No startContainer found for",this.toString());try{c=null!==s.terminal.offset,l.setStart(n,c?s.terminal.offset:0)}catch(t){u=this.fixMiss(a,s.terminal.offset,i,d),l.setStart(u.container,u.offset),console.warn(t)}if(o)try{c=null!==r.terminal.offset,l.setEnd(o,c?r.terminal.offset:0)}catch(t){u=this.fixMiss(h,this.end.terminal.offset,i,d),l.setEnd(u.container,u.offset),console.warn(t)}return l}toString(){let t="epubcfi(";return t+=this.segmentString(this.base),t+="!",t+=this.segmentString(this.path),this.range&&this.start&&(t+=",",t+=this.segmentString(this.start)),this.range&&this.end&&(t+=",",t+=this.segmentString(this.end)),t+=")",t}walkToNode(t,e,i){const s=e||document;let r=s.documentElement;for(let e=0,n=t.length;e<n;e++){const n=t[e];if("element"===n.type?r=n.id?s.getElementById(n.id):(r.children||D(r))[n.index]:"text"===n.type&&(r=this.textNodes(r,i)[n.index]),!r)break}return r}destroy(){Object.keys(this).forEach(t=>this[t]=void 0)}}const V=X,$=class{constructor(){this.cfi=null,this.index=0,this.percentage=0}set(t){return u(this,t||{}),this}destroy(){Object.keys(this).forEach(t=>this[t]=void 0)}},Y=class extends Array{constructor(t){super(),this.context=t,this.running=!1,this.paused=!1}enqueue(t,...e){let i;if("function"==typeof t){const s=new q;i={task:t,args:e,deferred:s,promise:s.promise}}else i={promise:t};return this.push(i),!1!==this.paused||this.running||this.run(),i.promise}dequeue(){let t;if(!this.length||this.paused)return t=new q,t.deferred.resolve(),t.promise;{t=this.shift();const e=t.task;if(e){const i=e.apply(this.context,t.args);return i&&"function"==typeof i.then?i.then(e=>{t.deferred.resolve(e)},e=>{t.deferred.reject(e)}):(t.deferred.resolve(i),t.promise)}if(t.promise)return t.promise}}dump(){for(;this.length;)this.dequeue()}run(){return!1===this.running&&(this.running=!0,this.deferred=new q),requestAnimationFrame(()=>{this.length?this.dequeue().then(()=>{this.run()}):(this.deferred.resolve(),this.running=!1)}),this.paused&&(this.paused=!1),this.deferred.promise}clear(){this.splice(0)}pause(){this.paused=!0}stop(){this.splice(0),this.running=!1,this.paused=!0}destroy(){this.splice(0),this.running=void 0,this.paused=void 0}},J="0.3.96",G=["keydown","keyup","keypressed","mouseup","mousedown","mousemove","click","touchend","touchstart","touchmove"],K="openFailed",Z="expand",Q="resized",tt="selected",et="selectedRange",it="linkClicked",st="changed",rt="resized",nt="added",ot="scroll",at="scrolled",ht="removed",ct="relocated",lt="writingMode",ut="loaderror",dt="rendered",pt="resized",ft="displayed",gt="shown",mt="hidden",vt="markClicked",yt="started",wt="attached",bt="displayed",xt="displayerror",Et="rendered",Tt="removed",kt="resized",Ot="orientationchange",Ct="relocated",Nt="markClicked",St="selected",Rt="layout",Lt="updated",jt="attach",At="detach",Pt="selected",Mt="injected",It="rejected",_t="resized",Dt="orientationchange";class zt extends Map{constructor(t,e,i){super(),this.sections=t,this.request=e,this.pause=i||100,this.break=150,this.processing=new q,this.current=new $,this.generated=this.processing.promise,this.q=new Y(this)}async generate(t){return Number.isInteger(t)?this.break=t:(this.break=parseInt(t),console.warn("The input value type is not an integer")),this.q.pause(),this.sections.forEach(t=>{t.linear&&this.q.enqueue(this.process.bind(this),t)}),this.q.run().then(()=>{const t=1===this.size?1:this.size-1,e=[...this.values()];return e.forEach((e,i)=>{e.index=i,e.percentage=i/t}),this.size&&this.current.set(e[0]),this.processing.resolve(this),this})}createRange(){return{startContainer:void 0,startOffset:void 0,endContainer:void 0,endOffset:void 0}}async process(t){return t.load(this.request).then(e=>this.parse(e,t.cfiBase))}async parse(t,e,i){let s;i=i||this.break;let r,n=0;const o=t.ownerDocument,a=R(o,"body");return this.treeWalker(a,t=>{const o=new q;if(0===t.textContent.trim().length)return o.resolve(!1),o.promise;0==n&&(s=this.createRange(),s.startContainer=t,s.startOffset=0);const a=t.length;let h=i-n,c=0;for(h>a&&(n+=a,c=a);c<a;)if(h=i-n,0===n&&(c+=1,s=this.createRange(),s.startContainer=t,s.startOffset=c),c+h>=a)n+=a-c,c=a;else{c+=h,s.endContainer=t,s.endOffset=c;const i=new V(s,e).toString(),r=(new $).set({cfi:i});this.set(i,r),n=0}return r=t,o.resolve(!0),o.promise}).then(()=>{if(s&&s.startContainer&&r){s.endContainer=r,s.endOffset=r.length;const t=new V(s,e).toString(),i=(new $).set({cfi:t});this.set(t,i),n=0}return this})}treeWalker(t,e){const i=NodeFilter.SHOW_TEXT,s=document.createTreeWalker(t,i),r=[];for(;s.nextNode();)r.push(e(s.currentNode));return Promise.all(r)}locationFromCfi(t){if(0===this.size)return-1;const e=new V(t),i=[...this.keys()],s=d(e,i,e.compare);return s>this.size-1?-1:s}percentageFromCfi(t){if(0===this.size)return 0;const e=this.locationFromCfi(t);return this.percentageFromLocation(e)}percentageFromLocation(t){return 0===this.size||this.size>=t&&t<0?0:t/(1===this.size?1:this.size-1)}cfiFromLocation(t){return 0===this.size||this.size>=t&&t<0?null:[...this.keys()][t]}cfiFromPercentage(t){let e,i=this.size-1;if(t>=0&&t<=1){const s=Math.round(i*t);e=this.cfiFromLocation(s)}else{const t=new V([...this.keys()][i]);t.collapse(),e=t.toString(),console.warn("Recommended a normalize value to between 0 - 1")}return e}load(t){if("string"==typeof t){this.clear();const e=JSON.parse(t);e.items.forEach(t=>this.set(t.cfi,t)),this.break=e.break,this.pause=e.pause,this.current.set(this.get(e.idref))}else console.error("Invalid argument type");return this}save(){return JSON.stringify({items:[...this.values()],idref:this.current.cfi,break:this.break,pause:this.pause})}set(t){if(2===arguments.length)return super.set(arguments[0],arguments[1]),this;if(0===this.size)return this;if(Object.keys(t||{}).forEach(e=>{const i=t[e];if(this.current[e]===i||void 0===i)delete t[e];else if("string"==typeof i){if("cfi"===e&&V.prototype.isCfiString(i)){const s=this.locationFromCfi(i),r=[...this.values()][s];r?this.current.set(r):delete t[e]}}else{if("number"!=typeof i)throw new Error("Invalid value type to "+e);if("index"===e){const s=this.cfiFromLocation(i),r=this.get(s);r?this.current.set(r):delete t[e]}else if("percentage"===e){const s=this.cfiFromPercentage(i),r=this.get(s);r?this.current.set(r):delete t[e]}}}),Object.keys(t||{}).length){const{...e}=this.current;this.emit(st,e,t)}return this}clear(){super.clear(),this.current.cfi=null,this.current.index=-1,this.current.percentage=0}destroy(){this.clear(),this.pause=void 0,this.break=void 0,this.current&&this.current.destroy(),this.current=void 0,this.q.stop(),this.q=void 0,this.generated=void 0}}e(zt.prototype);const Bt=zt,Ft=class{constructor(){this.directory="",this.fullPath="",this.encoding="",this.mediaType="",this.version=""}clear(){this.directory="",this.fullPath="",this.encoding="",this.mediaType="",this.version=""}parse(t){if(!t)throw new Error("Container File Not Found");const e=R(t,"container");if(!e)throw new Error("container node not found");const i=R(t,"rootfile");if(!i)throw new Error("rootfile node not found");return this.fullPath=i.getAttribute("full-path"),this.directory=U.prototype.dirname(this.fullPath),this.encoding=t.characterSet,this.mediaType=i.getAttribute("media-type"),this.version=e.getAttribute("version"),Promise.resolve(this)}load(t){return Object.keys(t).forEach(e=>{switch(e){case"directory":this.directory=t[e];break;case"encoding":this.encoding=t[e];break;case"full-path":this.fullPath=t[e];break;case"media-type":this.mediaType=t[e];break;case"version":this.version=t[e]}}),Promise.resolve(this)}destroy(){this.directory=void 0,this.encoding=void 0,this.fullPath=void 0,this.mediaType=void 0,this.version=void 0}};class qt extends Map{constructor(){super(),this.cover=null}parse(t){return[...t.children].forEach(t=>{if("meta"===t.nodeName)this.parseMeta(t);else if(/dc:/.test(t.nodeName)){const e=t.nodeName.substring(3);this.set(e,t.textContent)}}),Promise.resolve(this)}parseMeta(t){const e=t.getAttribute("name"),i=t.getAttribute("property");if(void 0===i||"string"!=typeof i)"cover"===e&&(this.cover=t);else if(/rendition:/.test(i)){const e=i.substring(10);this.set(e,t.textContent)}else if(/dcterms:/.test(i)){const e=i.substring(8);this.set(e,t.textContent)}else/media:/.test(i)&&this.set(i,t.textContent)}load(t){return Object.keys(t).forEach(e=>{this.set(e,t[e])}),Promise.resolve(this)}destroy(){this.clear(),this.cover=void 0}}const Ut=qt;class Wt extends Map{constructor(){super(),this.navPath=null,this.coverPath=null}clear(){super.clear(),this.navPath=null,this.coverPath=null}parse(t){return[...t.children].forEach(t=>{const e=t.getAttribute("properties"),i={id:t.getAttribute("id"),href:t.getAttribute("href")||"","media-type":t.getAttribute("media-type")||"","media-overlay":t.getAttribute("media-overlay")||"",properties:e?e.split(" "):[]};this.set(i.id,i),null!==this.navPath||"nav"!==e&&"application/x-dtbncx+xml"!==i["media-type"]||(this.navPath=i.href),null===this.coverPath&&"cover-image"===e&&(this.coverPath=i.href)}),null===this.coverPath&&(this.coverPath=this.findCoverPath(t)),Promise.resolve(this)}findCoverPath(t){const e=t.ownerDocument,i=j(e,"meta",{name:"cover"});if(i){const t=i.getAttribute("content"),s=e.getElementById(t);return s?s.getAttribute("href"):null}return null}load(t){return t.forEach(t=>{for(const e of t.properties)switch(e){case"nav":this.navPath=t.href;break;case"cover-image":this.coverPath=t.href}this.set(t.id,t)}),Promise.resolve(this)}destroy(){this.clear(),this.navPath=void 0,this.coverPath=void 0}}const Ht=Wt;class Xt extends Map{constructor(){super(),this.nodeIndex=0}clear(){super.clear(),this.nodeIndex=0}parse(t){return[...t.children].forEach((t,e)=>{const i=t.getAttribute("idref"),s=t.getAttribute("properties"),r={id:t.getAttribute("id"),idref:i,index:e,linear:t.getAttribute("linear")||"yes",properties:s?s.split(" "):[]};this.set(i,r)}),this.nodeIndex=w(t,Node.ELEMENT_NODE),Promise.resolve(this)}load(t){return t.forEach((t,e)=>{this.set(t.idref,{id:t.id||null,idref:t.idref,index:e,linear:t.linear,properties:t.properties})}),this.nodeIndex=0,Promise.resolve(this)}destroy(){this.clear(),this.nodeIndex=void 0}}const Vt=Xt,$t=class{constructor(){this.metadata=new Ut,this.manifest=new Ht,this.spine=new Vt,this.direction=null,this.version=null,this.uniqueIdentifier=null}clear(){this.metadata.clear(),this.manifest.clear(),this.spine.clear(),this.direction=null,this.version=null,this.uniqueIdentifier=null}async parse(t){if(!t)throw new Error("Package File Not Found");const e=R(t,"metadata");if(!e)throw new Error("No Metadata Found");const i=R(t,"manifest");if(!i)throw new Error("No Manifest Found");const s=R(t,"spine");if(!s)throw new Error("No Spine Found");const r=[];return r.push(this.metadata.parse(e)),r.push(this.manifest.parse(i)),r.push(this.spine.parse(s)),this.direction=this.parseDirection(t,s),this.version=this.parseVersion(t),this.uniqueIdentifier=this.metadata.get("identifier"),void 0===this.uniqueIdentifier&&(this.uniqueIdentifier=this.findUniqueIdentifier(t)),Promise.all(r).then(()=>this)}parseDirection(t,e){let i=t.documentElement.getAttribute("dir");return null===i&&(i=e.getAttribute("page-progression-direction")),i||""}parseVersion(t){return t.documentElement.getAttribute("version")||""}findUniqueIdentifier(t){const e=t.documentElement.getAttribute("unique-identifier");if(!e)return"";const i=t.getElementById(e);return i&&"identifier"===i.localName&&"http://purl.org/dc/elements/1.1/"===i.namespaceURI&&i.childNodes.length>0?i.childNodes[0].nodeValue.trim():""}async load(t){const e=[];return e.push(this.metadata.load(t.metadata)),e.push(this.manifest.load(t.manifest)),e.push(this.spine.load(t.spine)),this.direction=t.direction,this.version=t.version,this.uniqueIdentifier=this.metadata.get("identifier"),Promise.all(e).then(()=>this)}destroy(){this.metadata.destroy(),this.manifest.destroy(),this.spine.destroy(),this.metadata=void 0,this.manifest=void 0,this.spine=void 0,this.direction=void 0,this.version=void 0,this.uniqueIdentifier=void 0}};class Yt extends Map{constructor(){super()}parse(t){return Array.isArray(t)?this.load(t):"nav"===t.nodeName&&this.parseNav(t),new Promise((t,e)=>{t(this)})}parseNav(t){(t?L(t,"li"):[]).forEach(t=>{const e=this.navItem(t);e&&this.set(e.type,e)})}navItem(t){const e=B(t,"a",!0);if(!e)return null;const i=e.getAttribute("epub:type"),s=e.getAttribute("href")||"";return i?{type:i,href:s,label:e.textContent||""}:null}load(t){t.forEach(t=>{this.set(t.type,t)})}destroy(){this.clear()}}const Jt=Yt,Gt=class extends Array{constructor(){super(),this.epubcfi=new V,this.pages=[],this.locations=[],this.firstPage=0,this.lastPage=0,this.totalPages=0}parse(t){return Array.isArray(t)?this.load(t):"nav"===t.nodeName?this.parseNav(t):"pageList"===t.nodeName&&this.parseNcx(t),this.length&&this.process(),new Promise((t,e)=>{t(this)})}parseNav(t){(t?L(t,"li"):[]).forEach(t=>{this.push(this.navItem(t))})}navItem(t){const e=R(t,"a"),i=e.getAttribute("href")||"",s=e.textContent||"",r=parseInt(s);if(-1!==i.indexOf("epubcfi")){const t=i.split("#");return{cfi:t.length>1?t[1]:null,packageUrl:t[0],href:i,page:r}}return{href:i,page:r}}parseNcx(t){(L(t,"pageTarget")||[]).forEach(t=>{this.push(this.ncxItem(t))})}ncxItem(t){const e=R(t,"navLabel"),i=R(e,"text").textContent;return{href:R(t,"content").getAttribute("src"),page:parseInt(i,10)}}process(){this.forEach(t=>{this.pages.push(t.page),t.cfi&&this.locations.push(t.cfi)},this),this.firstPage=parseInt(this.pages[0]),this.lastPage=parseInt(this.pages[this.pages.length-1]),this.totalPages=this.lastPage-this.firstPage}pageFromCfi(t){if(0===this.locations.length)return-1;let e,i=f(t,this.locations,this.epubcfi.compare);return-1!=i?e=this.pages[i]:(i=d(t,this.locations,this.epubcfi.compare),e=i-1>=0?this.pages[i-1]:this.pages[0],void 0!==e||(e=-1)),e}cfiFromPage(t){"number"!=typeof t&&(t=parseInt(t));const e=this.pages.indexOf(t);let i=null;return-1!==e&&(i=this.locations[e]),i}pageFromPercentage(t){return Math.round(this.totalPages*t)}percentageFromPage(t){const e=(t-this.firstPage)/this.totalPages;return Math.round(1e3*e)/1e3}percentageFromCfi(t){const e=this.pageFromCfi(t);return this.percentageFromPage(e)}load(t){t.forEach(t=>{this.push(t)})}clear(){this.length&&(this.splice(0),this.pages.splice(0),this.locations.splice(0),this.firstPage=0,this.lastPage=0,this.totalPages=0)}destroy(){this.clear(),this.pages=void 0,this.locations=void 0,this.firstPage=void 0,this.lastPage=void 0,this.totalPages=void 0,this.epubcfi=void 0}},Kt=class extends Array{constructor(){super(),this.links=new Map}get(t){const e=t.split("/"),i=e.length?e[e.length-1]:t;return this.links.get(t)||this.links.get(i)}parse(t){return Array.isArray(t)?this.load(t):"nav"===t.nodeName?this.parseNav(t):"navMap"===t.nodeName&&this.parseNcx(t),new Promise(t=>{t(this)})}parseNav(t,e=null,i=null){const s=B(t,"ol",!0);if(!s)return;if(!s.children)return;const r=s.children.length,n=e||this;for(let t=0;t<r;t++){const e=s.children[t];if("li"!==e.nodeName)continue;const r=this.navItem(e,s);r&&(r.parentId=i,n.push(r),this.parseNav(e,r.subitems,r.id))}}navItem(t){const e=R(t,"a")||R(t,"span");if(!e)return null;const i=e.getAttribute("href"),s=i.split("#"),r=2===s.length?s[1]:"",n=t.getAttribute("id")||r||i,o=e.textContent||"",a={id:n,href:i,bind:s[0],label:o,parentId:null,subitems:[]};return this.links.set(i,a),a}parseNcx(t,e=null,i=null){if(!t.children)return;const s=t.children.length,r=e||this;for(let e=0;e<s;++e){const s=t.children[e];if("navPoint"!==s.nodeName)continue;const n=this.ncxItem(s);n.parentId=i,r.push(n),this.parseNcx(s,n.subitems,n.id)}}ncxItem(t){const e=R(t,"content"),i=R(t,"navLabel"),s=e.getAttribute("src"),r=s.split("#"),n=2===r.length?r[1]:"",o=t.getAttribute("id")||n||s,a=i.textContent||"",h={id:o,href:s,bind:r[0],label:a,parentId:null,subitems:[]};return this.links.set(s,h),h}load(t,e=0,i=null){e+=1,t.forEach(t=>{const s=t.href,r=s.split("#"),n=2===r.length?r[1]:"";t.id=t.id||n||s,t.bind=r[0],t.parentId=i,1===e&&this.push(t),this.links.set(s,t),this.load(t.subitems,e,t.id)})}clear(){this.length&&(this.links.clear(),this.splice(0))}destroy(){this.clear(),this.links=void 0}},Zt=class{constructor(){this.landmarks=new Jt,this.pageList=new Gt,this.toc=new Kt}clear(){this.landmarks.clear(),this.pageList.clear(),this.toc.clear()}async parse(t){const e=[],i=t.documentElement;return"html"===i.tagName?L(t,"nav").forEach(t=>{switch(t.getAttribute("epub:type")){case"landmarks":e.push(this.landmarks.parse(t));break;case"page-list":e.push(this.pageList.parse(t));break;case"toc":e.push(this.toc.parse(t))}}):"ncx"===i.tagName&&[...i.children].forEach(t=>{switch(t.tagName){case"navMap":e.push(this.toc.parse(t));break;case"pageList":e.push(this.pageList.parse(t))}}),Promise.all(e).then(()=>this)}async load(t){const e=[];return e.push(this.landmarks.parse(t.landmarks||[])),e.push(this.pageList.parse(t["page-list"]||[])),e.push(this.toc.parse(t.toc||[])),Promise.all(e).then(()=>this)}forEach(...t){this.toc.forEach(...t)}destroy(){this.clear(),this.landmarks.destroy(),this.landmarks=void 0,this.pageList.destroy(),this.pageList=void 0,this.toc.destroy(),this.toc=void 0}},Qt=(t,e)=>{if(!t)return;let i=R(t,"head"),s=R(i,"base");s||(s=t.createElement("base"),i.insertBefore(s,i.firstChild));let r=e.url;r.indexOf("://")>-1||(r=new URL(r,t.baseURI).href),s.setAttribute("href",r)},te=(t,e)=>{if(!t)return;let i=e.canonical,s=R(t,"head"),r=R(s,"link[rel='canonical']");r?r.setAttribute("href",i):(r=t.createElement("link"),r.setAttribute("rel","canonical"),r.setAttribute("href",i),s.appendChild(r))},ee=(t,e)=>{if(!t)return;let i=R(t,"head"),s=R(i,"link[property='dc.identifier']");s?s.setAttribute("content",e.idref):(s=t.createElement("meta"),s.setAttribute("name","dc.identifier"),s.setAttribute("content",e.idref),i.appendChild(s))},ie={application:{ecmascript:["es","ecma"],javascript:"js",ogg:"ogx",pdf:"pdf",postscript:["ps","ai","eps","epsi","epsf","eps2","eps3"],"rdf+xml":"rdf",smil:["smi","smil"],"xhtml+xml":["xhtml","xht"],xml:["xml","xsl","xsd","opf","ncx"],zip:"zip","x-httpd-eruby":"rhtml","x-latex":"latex","x-maker":["frm","maker","frame","fm","fb","book","fbdoc"],"x-object":"o","x-shockwave-flash":["swf","swfl"],"x-silverlight":"scr","epub+zip":"epub","font-tdpfr":"pfr","inkml+xml":["ink","inkml"],json:"json","jsonml+json":"jsonml","mathml+xml":"mathml","metalink+xml":"metalink",mp4:"mp4s","omdoc+xml":"omdoc",oxps:"oxps","vnd.amazon.ebook":"azw",widget:"wgt","x-dtbook+xml":"dtb","x-dtbresource+xml":"res","x-font-bdf":"bdf","x-font-ghostscript":"gsf","x-font-linux-psf":"psf","x-font-otf":"otf","x-font-pcf":"pcf","x-font-snf":"snf","x-font-ttf":["ttf","ttc"],"x-font-type1":["pfa","pfb","pfm","afm"],"x-font-woff":"woff","x-mobipocket-ebook":["prc","mobi"],"x-mspublisher":"pub","x-nzb":"nzb","x-tgif":"obj","xaml+xml":"xaml","xml-dtd":"dtd","xproc+xml":"xpl","xslt+xml":"xslt","internet-property-stream":"acx","x-compress":"z","x-compressed":"tgz","x-gzip":"gz"},audio:{flac:"flac",midi:["mid","midi","kar","rmi"],mpeg:["mpga","mpega","mp2","mp3","m4a","mp2a","m2a","m3a"],mpegurl:"m3u",ogg:["oga","ogg","spx"],"x-aiff":["aif","aiff","aifc"],"x-ms-wma":"wma","x-wav":"wav",adpcm:"adp",mp4:"mp4a",webm:"weba","x-aac":"aac","x-caf":"caf","x-matroska":"mka","x-pn-realaudio-plugin":"rmp",xm:"xm",mid:["mid","rmi"]},image:{gif:"gif",ief:"ief",jpeg:["jpeg","jpg","jpe"],pcx:"pcx",png:"png","svg+xml":["svg","svgz"],tiff:["tiff","tif"],"x-icon":"ico",bmp:"bmp",webp:"webp","x-pict":["pic","pct"],"x-tga":"tga","cis-cod":"cod"},text:{"cache-manifest":["manifest","appcache"],css:"css",csv:"csv",html:["html","htm","shtml","stm"],mathml:"mml",plain:["txt","text","brf","conf","def","list","log","in","bas"],richtext:"rtx","tab-separated-values":"tsv","x-bibtex":"bib"},video:{mpeg:["mpeg","mpg","mpe","m1v","m2v","mp2","mpa","mpv2"],mp4:["mp4","mp4v","mpg4"],quicktime:["qt","mov"],ogg:"ogv","vnd.mpegurl":["mxu","m4u"],"x-flv":"flv","x-la-asf":["lsf","lsx"],"x-mng":"mng","x-ms-asf":["asf","asx","asr"],"x-ms-wm":"wm","x-ms-wmv":"wmv","x-ms-wmx":"wmx","x-ms-wvx":"wvx","x-msvideo":"avi","x-sgi-movie":"movie","x-matroska":["mpv","mkv","mk3d","mks"],"3gpp2":"3g2",h261:"h261",h263:"h263",h264:"h264",jpeg:"jpgv",jpm:["jpm","jpgm"],mj2:["mj2","mjp2"],"vnd.ms-playready.media.pyv":"pyv","vnd.uvvu.mp4":["uvu","uvvu"],"vnd.vivo":"viv",webm:"webm","x-f4v":"f4v","x-m4v":"m4v","x-ms-vob":"vob","x-smv":"smv"}},se=(()=>{const t={};for(const e in ie)if(ie.hasOwnProperty(e))for(const i in ie[e])if(ie[e].hasOwnProperty(i)){const s=ie[e][i];if("string"==typeof s)t[s]=e+"/"+i;else for(let r=0;r<s.length;r++)t[s[r]]=e+"/"+i}return t})(),re=t=>{let e;if(t){const i=t.split(".").pop().toLowerCase();e=se[i]}return e||"text/plain"};class ne extends Map{constructor(t,e,i){super(),this.archive=void 0,this.storage=void 0,this.request=t,this.resolve=e,this.replacements=i||null}clear(){"blobUrl"===this.replacements&&this.forEach((t,e)=>{URL.revokeObjectURL(t)}),super.clear()}async createUrl(t,e){const i=this.resolve(t),s=new W(i),r="base64"===this.replacements;if(this.archive){const t=r?"base64":"blob";return this.archive.request(i,t).then(t=>r?t:URL.createObjectURL(t))}return r?this.request(i,"blob").then(t=>I(t)):this.request(i,"blob").then(t=>{const i=e||re(s.filename);return k(t,i)})}revokeUrl(t){if("blobUrl"===this.replacements){const e=this.get(t);e&&URL.revokeObjectURL(e)}}substitute(t,e){e.output=((t,e,i,s)=>(i.forEach((i,r)=>{i&&s[r]&&(i=((t,e)=>{const i=t.split("/");let s="";for(let t=1;t<i.length;++t)s+="../";return s+e})(e.href,i),i=i.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),t=t.replace(new RegExp(i,"g"),s[r]))}),t))(t,e,[...this.keys()],[...this.values()])}async unpack(t,e,i){this.archive=e,this.storage=i,null===this.replacements&&(this.replacements=e||i.name?"blobUrl":null);const s=[];return t.forEach((t,r)=>{if("application/xhtml+xml"===t["media-type"]||"text/html"===t["media-type"])i.name&&!e&&s.push(i.put(this.resolve(t.href)));else if(this.replacements){const e=this.createUrl(t.href,t["media-type"]).then(e=>(this.set(t.href,e),e));s.push(e)}else this.set(t.href,null)}),Promise.all(s).then(()=>this)}destroy(){this.clear(),this.archive=void 0,this.storage=void 0,this.request=void 0,this.resolve=void 0,this.replacements=void 0}}const oe=ne;class ae{constructor(t,e,{data:i,cb:s,className:r,styles:n}){this.type=t,this.cfiRange=e,this.sectionIndex=new V(e).spinePos,this.data=i,this.cb=s,this.className=r,this.styles=n,this.mark=void 0}update(t){this.data=t}attach(t){let e;return t?("highlight"===this.type?e=t.highlight(this.cfiRange,this.data,this.cb,this.className,this.styles):"underline"===this.type&&(e=t.underline(this.cfiRange,this.data,this.cb,this.className,this.styles)),this.mark=e,this.emit(jt,e),e):null}detach(t){let e=!1;return t?("highlight"===this.type?e=t.unhighlight(this.cfiRange):"underline"===this.type&&(e=t.ununderline(this.cfiRange)),this.mark=void 0,this.emit(At,e),e):e}text(){}}e(ae.prototype);const he=ae;class ce extends Map{constructor(t){super(),this.rendition=t,this.rendition.hooks.render.register(this.inject.bind(this)),this.rendition.hooks.unloaded.register(this.reject.bind(this))}append(t,e,i){const s=encodeURI(t+":"+e),r=new he(t,e,i);return this.rendition.views().forEach(t=>{const e=t.section.index;r.sectionIndex===e&&r.attach(t)}),this.set(s,r),r}remove(t,e){const i=encodeURI(t+":"+e),s=this.get(i);s&&(this.rendition.views().forEach(t=>{const e=t.section.index;s.sectionIndex===e&&s.detach(t)}),this.delete(i))}inject(t){const e=t.section.index;this.forEach((i,s)=>{i.sectionIndex===e&&i.attach(t)})}reject(t){const e=t.section.index;this.forEach((i,s)=>{i.sectionIndex===e&&i.detach(t)})}show(){}hide(){}}const le=ce;class ue{constructor(t){this.axis="horizontal",this.name="reflowable",this.flow="paginated",this.style="paginated",this.spread="auto",this.direction="ltr",this.orientation="auto",this.viewport="",this.minSpreadWidth=800,this.width=0,this.height=0,this.pageWidth=0,this.pageHeight=0,this.spreadWidth=0,this.delta=0,this.columnWidth=0,this.gap=0,this.divisor=1,this.set(t||{})}set(t){const e=t=>console.error(`Invalid '${t}' property type`);Object.keys(t).forEach(i=>{const s=t[i];if(this[i]===s||void 0===s)delete t[i];else if("direction"===i||"orientation"===i)"string"==typeof s?this[i]=t[i]:e(i);else if("flow"===i)if("string"==typeof s)switch(s){case"scrolled":case"scrolled-continuous":this.flow="scrolled",this.axis="vertical",this.style="scrolling",this.spread="none";break;case"scrolled-doc":this.flow=s,this.axis="vertical",this.style="scrolling",this.spread="none";break;default:this.flow="paginated",this.axis="horizontal",this.style="paginated"}else e(i);else if("spread"===i)if("string"==typeof s)switch(s){case"auto":case"both":this.spread="auto";break;default:this.spread="none"}else e(i);else"width"!==i&&"height"!==i&&"pageWidth"!==i&&"pageHeight"!==i&&"gap"!==i&&"minSpreadWidth"!==i||("number"==typeof s?s>=0&&(this[i]=t[i]):e(i))}),this.calculate(),Object.keys(t).length&&this.emit(Lt,this,t)}calculate(t,e,i){const s=t||this.width,r=e||this.height;if(i>=0)this.gap=i;else{let t;t="horizontal"===this.axis?Math.floor(s/12):Math.floor(r/17),this.gap=t%2==0?t:t-1}"paginated"===this.flow?(this.divisor="auto"===this.spread&&s>=this.minSpreadWidth?2:1,this.columnWidth=s/this.divisor-this.gap,this.spreadWidth=this.columnWidth*this.divisor+this.gap,this.pageWidth=this.columnWidth+this.gap,this.pageHeight=r):this.divisor=1,this.delta=s,this.width=s,this.height=r}count(t,e){let i,s;return"paginated"===this.flow?(e=e||this.delta,i=Math.ceil(t/e),s=i*this.divisor):(e=e||this.height,i=Math.ceil(t/e),s=i),{spreads:i,pages:s}}destroy(){Object.keys(this).forEach(t=>this[t]=void 0)}}e(ue.prototype);const de=ue;class pe extends Map{constructor(t){super(),this.rendition=t,this.current=null,this.rules={},this.rendition.hooks.content.register(this.inject.bind(this)),this.rendition.hooks.content.register(this.update.bind(this))}register(){if(0!==arguments.length)return 1===arguments.length&&"object"==typeof arguments[0]?this.registerThemes(arguments[0]):2===arguments.length&&"string"==typeof arguments[1]?this.registerUrl(arguments[0],arguments[1]):2===arguments.length&&"object"==typeof arguments[1]?this.registerRules(arguments[0],arguments[1]):void 0}registerThemes(t){for(const e in t)t.hasOwnProperty(e)&&("string"==typeof t[e]?this.registerUrl(e,t[e]):this.registerRules(e,t[e]))}registerUrl(t,e){const i=new W(e);this.set(t,{injected:!1,url:i.toString()})}registerRules(t,e){this.set(t,{injected:!1,rules:e})}select(t){const e=this.current;let i;t?i=this.get(t):e&&null===t&&(i=this.get(e)),this.current!==t&&i&&(this.current=t,this.rendition.getContents().forEach(s=>{s&&(t?(s.removeClass(e),s.appendClass(t),this.append(t,i,s)):e&&(s.removeClass(e),this.remove(e,i,s)))}),this.emit(Pt,t,i))}append(t,e,i){e.url&&(i.appendStylesheet(t,e.url),e.injected=!0),e.rules&&(i.appendStylesheet(t,e.rules),e.injected=!0),e.injected&&this.emit(Mt,t,e,i)}remove(t,e,i){i.removeStylesheet(t)&&(e.injected=!1,this.emit(It,t,e,i))}clear(){this.select(null),super.clear()}inject(t){this.current&&(this.forEach((e,i)=>{this.current===i&&this.append(i,e,t)}),t.appendClass(this.current))}update(t){const e=this.rules;for(const i in e)e.hasOwnProperty(i)&&t.css(i,e[i].value,e[i].priority)}appendRule(t,e,i=!1){const s={value:e,priority:i};this.rendition.getContents().forEach(e=>{e&&e.css(t,s.value,s.priority)}),this.rules[t]=s}removeRule(t){delete this.rules[t],this.rendition.getContents().forEach(e=>{e&&e.css(t)})}removeRules(){Object.keys(this.rules).forEach(t=>{this.removeRule(t)})}fontSize(t){this.appendRule("font-size",t)}font(t){this.appendRule("font-family",t,!0)}destroy(){this.clear(),this.removeRules(),this.current=void 0,this.rules=void 0}}e(pe.prototype);const fe=pe,ge=class{constructor(t){this.context=t||this,this.tasks=[]}register(){for(let t=0;t<arguments.length;++t)if("function"==typeof arguments[t])this.tasks.push(arguments[t]);else{if(!(arguments[t]instanceof Array))throw new TypeError("Invalid argument type");this.register(arguments[t])}}deregister(t){for(let e=0;e<this.tasks.length;e++)if(this.tasks[e]===t){this.tasks.splice(e,1);break}}trigger(){const t=arguments,e=this.context,i=[];let s;return this.tasks.forEach(r=>{try{s=r.apply(e,t)}catch(t){console.error(t)}s&&"function"==typeof s.then&&i.push(s)}),Promise.all(i)}list(){return this.tasks}clear(){this.tasks=[]}};class me{constructor(t){this.layout=t,this.layout.on(Lt,(t,e)=>{e.axis?this.updateAxis(t.axis):e.flow?this.updateFlow(t.flow):e.direction&&this.direction(t.direction)}),this.container=null,this.target=null,this.rect={bottom:0,height:0,left:0,right:0,top:0,width:0,x:0,y:0}}attachTo(t,e){const i=this.getElement(t);return i?(this.views=e.views,this.container=this.create(e),this.container.appendChild(this.views.container),i.appendChild(this.container),this.target=i,this.appendListeners(),i):null}create(t){let e=t.width,i=t.height;e&&a(e)&&(e+="px"),i&&a(i)&&(i+="px");const s=document.createElement("div");return s.classList.add("viewport-container"),s.style.wordSpacing="0",s.style.lineHeight="0",s.style.verticalAlign="top",s.style.position="relative",s.style.display="flex",s.style.flexWrap="nowrap",s.style.width=e||"100%",s.style.height=i||"100%",s.style.overflow="hidden",s}appendListeners(){screen.orientation.addEventListener("change",this.orientation.bind(this)),this.resizeFunc=new ResizeObserver(t=>{requestAnimationFrame(()=>this.resized(t))}),this.resizeFunc.observe(this.container)}removeListeners(){screen.orientation.removeEventListener("change",this.orientation.bind(this)),this.resizeFunc&&this.resizeFunc.disconnect()}getElement(t){let e;if("string"==typeof t)e=document.getElementById(t);else{if(!(t instanceof Element))throw new TypeError("Invalid argument type");e=t}return e}orientation(t){this.emit(Dt,t.target)}resized(t){let e=!1;const i=t=>Object.keys(this.rect).forEach(i=>{t&&this.rect[i]!==t[i]&&void 0!==t[i]&&(this.rect[i]=t[i],e=!0)});t.forEach(t=>i(t.contentRect)),e&&this.emit(_t,this.rect)}size(t,e){return this.rect.width=this.target.clientWidth,this.rect.height=this.target.clientHeight,t?a(t)?(this.container.style.width=t+"px",this.rect.width=t):(this.container.style.width=t,this.rect.width=this.container.clientWidth):(t=this.rect.width,this.container.style.width=t+"px"),e?a(e)?(this.container.style.height=e+"px",this.rect.height=e):(this.container.style.height=e,this.rect.height=this.container.clientHeight):(e=this.rect.height,this.container.style.height=e+"px"),{width:this.rect.width,height:this.rect.height}}direction(t){const e=t||this.layout.direction;this.target.dir=e,this.target.classList.add(e)}updateAxis(t){const e=t||this.layout.axis;this.views.container.style.display="horizontal"===e?"flex":"grid"}updateFlow(t){const e=t||this.layout.flow;"paginated"===e?(this.views.container.style.display="flex",this.views.container.style["overflow-y"]="hidden",this.views.container.style["overflow-x"]="hidden"):"horizontal"===this.layout.axis?(this.views.container.style.display="flex",this.views.container.style["overflow-y"]="hidden",this.views.container.style["overflow-x"]="auto"):"vertical"===this.layout.axis&&(this.views.container.style.display="grid",this.views.container.style["overflow-y"]="auto",this.views.container.style["overflow-x"]="hidden"),this.target.className=e}update(){this.updateAxis(),this.updateFlow(),this.direction()}destroy(){this.target&&(this.removeListeners(),this.target.removeChild(this.container),this.container.removeChild(this.views.container),this.container=void 0,this.target=void 0,this.rect=void 0)}}e(me.prototype);const ve=me;r(116);const ye=class{constructor(t,e=!1){this.layout=t,this.devMode=e}section(t){const e=this.findRanges(t);return this.rangeListToCfiList(t.section.cfiBase,e)}page(t,e,i,s){const r=!(!t||!t.document)&&t.document.body;if(!r)return null;const n=this.rangePairToCfiPair(e,{start:this.findStart(r,i,s),end:this.findEnd(r,i,s)});if(!0===this.devMode){const e=t.document,i=new V(n.start).toRange(e),s=new V(n.end).toRange(e),r=e.defaultView.getSelection(),o=e.createRange();r.removeAllRanges(),o.setStart(i.startContainer,i.startOffset),o.setEnd(s.endContainer,s.endOffset),r.addRange(o)}return n}walk(t,e){if(t&&t.nodeType===Node.TEXT_NODE)return;const i=t=>t.data.trim().length>0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT,s=i;s.acceptNode=i;const r=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,s,!1);let n,o;for(;(n=r.nextNode())&&(o=e(n),!o););return o}findRanges(t){const e=[],i=t.contents.scrollWidth(),s=Math.ceil(i/this.layout.spreadWidth)*this.layout.divisor,r=this.layout.columnWidth,n=this.layout.gap,o=t.document.body;for(let t=0;t<s;t++){const i=(r+n)*t,s=r*(t+1)+n*t;e.push({start:this.findStart(o,i,s),end:this.findEnd(o,i,s)})}return e}findStart(t,e,i){const s=[t],r="horizontal"===this.layout.axis,n="ltr"===this.layout.direction,o="rtl"===this.layout.direction;let a=t;for(;s.length;){const t=s.shift(),h=this.walk(t,t=>{let h,c,l,u;const d=v(t);if(r&&n){if(h=r?d.left:d.top,c=r?d.right:d.bottom,h>=e&&h<=i)return t;if(c>e)return t;a=t,s.push(t)}else if(r&&o){if(h=d.left,c=d.right,c<=i&&c>=e)return t;if(h<i)return t;a=t,s.push(t)}else{if(l=d.top,u=d.bottom,l>=e&&l<=i)return t;if(u>e)return t;a=t,s.push(t)}});if(h)return this.findTextStartRange(h,e,i)}return this.findTextStartRange(a,e,i)}findEnd(t,e,i){const s=[t],r="horizontal"===this.layout.axis,n="ltr"===this.layout.direction,o="rtl"===this.layout.direction;let a=t;for(;s.length;){const t=s.shift(),h=this.walk(t,t=>{let h,c,l,u;const d=v(t);if(r&&n){if(h=Math.round(d.left),c=Math.round(d.right),h>i&&a)return a;if(c>i)return t;a=t,s.push(t)}else if(r&&o){if(h=Math.round(r?d.left:d.top),c=Math.round(r?d.right:d.bottom),c<e&&a)return a;if(h<e)return t;a=t,s.push(t)}else{if(l=Math.round(d.top),u=Math.round(d.bottom),l>i&&a)return a;if(u>i)return t;a=t,s.push(t)}});if(h)return this.findTextEndRange(h,e,i)}return this.findTextEndRange(a,e,i)}findTextStartRange(t,e,i){const s=this.splitTextNodeIntoRanges(t),r="horizontal"===this.layout.axis,n="ltr"===this.layout.direction,o="rtl"===this.layout.direction;for(let t=0;t<s.length;t++){const a=s[t],h=a.getBoundingClientRect();if(r&&n){if(h.left>=e)return a}else if(r&&o){if(h.right<=i)return a}else if(h.top>=e)return a}return s[0]}findTextEndRange(t,e,i){const s=this.splitTextNodeIntoRanges(t),r="horizontal"===this.layout.axis,n="ltr"===this.layout.direction,o="rtl"===this.layout.direction;let a;for(let t=0;t<s.length;t++){const h=s[t],c=h.getBoundingClientRect();if(r&&n){if(c.left>i&&a)return a;if(c.right>i)return h}else if(r&&o){if(c.right<e&&a)return a;if(c.left<e)return h}else{if(c.top>i&&a)return a;if(c.bottom>i)return h}a=h}return s[s.length-1]}splitTextNodeIntoRanges(t,e=" "){const i=[],s=(t.textContent||"").trim(),r=t.ownerDocument;let n,o=s.indexOf(e);if(-1===o||t.nodeType!=Node.TEXT_NODE)return n=r.createRange(),n.selectNodeContents(t),[n];for(n=r.createRange(),n.setStart(t,0),n.setEnd(t,o),i.push(n),n=!1;-1!==o;)o=s.indexOf(e,o+1),o>0&&(n&&(n.setEnd(t,o),i.push(n)),n=r.createRange(),n.setStart(t,o+1));return n&&(n.setEnd(t,s.length),i.push(n)),i}rangePairToCfiPair(t,e){const i=e.start,s=e.end;return i.collapse(!0),s.collapse(!1),{start:new V(i,t).toString(),end:new V(s,t).toString()}}rangeListToCfiList(t,e){const i=[];for(let s=0;s<e.length;s++){const r=this.rangePairToCfiPair(t,e[s]);i.push(r)}return i}destroy(){this.devMode=void 0}},we=class extends Array{constructor(){super(),this.container=null,this.init()}init(){this.container=document.createElement("div"),this.container.classList.add("views-container"),this.container.style.display="flex",this.container.style.width="100%",this.container.style.height="100%"}first(){return this[0]}last(){return this[this.length-1]}get(t){return this[t]}append(t){return this.container.appendChild(t.container),this.push(t),t}prepend(t){return this.container.insertBefore(t.container,this.container.firstChild),this.unshift(t),t}insert(t,e){const i=this.container.children;return e<i.length?this.container.insertBefore(t.container,i[e]):this.container.appendChild(t.container),this.splice(e,0,t),t}remove(t,e){const i=e||this.indexOf(t);i>-1&&(this.container.removeChild(t.container),this.splice(i,1),t.destroy())}clear(){const t=this.length;for(let e=0;e<t;++e){const t=this[e];t&&this.remove(t,e)}}find(t){for(let e=0;e<this.length;e++){const i=this[e];if(i.displayed&&i.section.index==t.index)return i}}displayed(){const t=[];for(let e=0;e<this.length;e++){const i=this[e];i.displayed&&t.push(i)}return t}show(){for(let t=0;t<this.length;t++){const e=this[t];e.displayed&&e.show()}}hide(){for(let t=0;t<this.length;t++){const e=this[t];e.displayed&&e.hide()}}update(){for(let t=0;t<this.length;++t){const e=this[t];e.displayed&&e.update()}}destroy(){this.clear(),this.container=void 0}},be="undefined"!=typeof navigator,xe=be&&/Chrome/.test(navigator.userAgent),Ee=be&&!xe&&/AppleWebKit/.test(navigator.userAgent);class Te{constructor(t,e,i){this.document=t,this.content=e||this.document.body,this.contentRect={bottom:0,height:0,left:0,right:0,top:0,width:0,x:0,y:0},this.section=i,this.scripts=new Map,this.styles=new Map,this.active=!0,this.window=this.document.defaultView,this.mode=this.writingMode(),this.appendListeners()}width(t){const e=this.content;return t&&a(t)&&(t+="px"),t&&(e.style.width=t),parseInt(this.window.getComputedStyle(e).width)}height(t){const e=this.content;return t&&a(t)&&(t+="px"),t&&(e.style.height=t),parseInt(this.window.getComputedStyle(e).height)}textSize(){const t=this.document.createRange();t.selectNodeContents(this.content);const e=t.getBoundingClientRect(),i=m(this.content),s=e.width+i.width,r=this.content.clientHeight;return{width:Math.round(s),height:Math.round(r)}}scrollWidth(){return this.document.documentElement.scrollWidth}scrollHeight(){return this.document.documentElement.scrollHeight}overflow(t){const e=this.document.documentElement;return t&&(e.style.overflow=t),this.window.getComputedStyle(e).overflow}overflowX(t){const e=this.document.documentElement;return t&&(e.style.overflowX=t),this.window.getComputedStyle(e).overflowX}overflowY(t){const e=this.document.documentElement;return t&&(e.style.overflowY=t),this.window.getComputedStyle(e).overflowY}css(t,e,i){const s=this.content;return e?s.style.setProperty(t,e,i?"important":""):s.style.removeProperty(t),this.window.getComputedStyle(s)[t]}viewport(t){const e={width:void 0,height:void 0,scale:void 0,minimum:void 0,maximum:void 0,scalable:void 0};let i=this.document.querySelector("meta[name='viewport']");if(i&&i.hasAttribute("content")){const t=i.getAttribute("content"),s=t.match(/width\s*=\s*([^,]*)/),r=t.match(/height\s*=\s*([^,]*)/),n=t.match(/initial-scale\s*=\s*([^,]*)/),o=t.match(/minimum-scale\s*=\s*([^,]*)/),a=t.match(/maximum-scale\s*=\s*([^,]*)/),h=t.match(/user-scalable\s*=\s*([^,]*)/);s&&s.length&&void 0!==s[1]&&(e.width=s[1]),r&&r.length&&void 0!==r[1]&&(e.height=r[1]),n&&n.length&&void 0!==n[1]&&(e.scale=n[1]),o&&o.length&&void 0!==o[1]&&(e.minimum=o[1]),a&&a.length&&void 0!==a[1]&&(e.maximum=a[1]),h&&h.length&&void 0!==h[1]&&(e.scalable=h[1])}const s=l(t||{},e),r=[];return t&&(s.width&&r.push("width="+s.width),s.height&&r.push("height="+s.height),s.scale&&r.push("initial-scale="+s.scale),"no"===s.scalable?(r.push("minimum-scale="+s.scale),r.push("maximum-scale="+s.scale),r.push("user-scalable="+s.scalable)):(s.scalable&&r.push("user-scalable="+s.scalable),s.minimum&&r.push("minimum-scale="+s.minimum),s.maximum&&r.push("minimum-scale="+s.maximum)),null===i&&(i=this.document.createElement("meta"),i.setAttribute("name","viewport"),this.document.head.appendChild(i)),i.setAttribute("content",r.join(", ")),this.window.scrollTo(0,0)),s}expand(){this.emit(Z)}resize(t){let e=!1;const i=t=>Object.keys(this.contentRect).forEach(i=>{t&&this.contentRect[i]!==t[i]&&void 0!==t[i]&&(this.contentRect[i]=t[i],e=!0)});t.forEach(t=>i(t.contentRect)),e&&this.emit(Q,this.contentRect)}root(){return this.document?this.document.documentElement:null}locationOf(t,e){const i={left:0,top:0};if(!this.document)return i;let s;if(V.prototype.isCfiString(t)){const r=new V(t).toRange(this.document,e);if(r){try{if(!r.endContainer||r.startContainer==r.endContainer&&r.startOffset==r.endOffset){let t=r.startContainer.textContent.indexOf(" ",r.startOffset);-1==t&&(t=r.startContainer.textContent.length),r.setEnd(r.startContainer,t)}}catch(t){console.error("setting end offset to start container length failed",t)}if(r.startContainer.nodeType===Node.ELEMENT_NODE)s=r.startContainer.getBoundingClientRect(),i.left=s.left,i.top=s.top;else if(Ee){const t=r.startContainer,e=new Range;try{t.nodeType===Node.ELEMENT_NODE?s=t.getBoundingClientRect():r.startOffset+2<t.length?(e.setStart(t,r.startOffset),e.setEnd(t,r.startOffset+2),s=e.getBoundingClientRect()):r.startOffset-2>0?(e.setStart(t,r.startOffset-2),e.setEnd(t,r.startOffset),s=e.getBoundingClientRect()):s=t.parentNode.getBoundingClientRect()}catch(t){console.error(t,t.stack)}}else s=r.getBoundingClientRect()}}else if("string"==typeof t&&t.indexOf("#")>-1){const e=t.substring(t.indexOf("#")+1),i=this.document.getElementById(e);if(i)if(Ee){const t=new Range;t.selectNode(i),s=t.getBoundingClientRect()}else s=i.getBoundingClientRect()}return s&&(i.left=s.left,i.top=s.top),i}createLink(t,e){return new Promise((i,s)=>{const r=`epubjs-injected-css-${t}`;let n=this.styles.get(r);n&&this.document.head.removeChild(n),n=this.document.createElement("link"),n.rel="stylesheet",n.type="text/css",n.href=e,n.onload=()=>{i(n)},n.onerror=()=>{s(new Error(`Failed to load source: ${e}`))},this.document.head.appendChild(n),this.styles.set(r,n)})}createStyle(t,e){return new Promise(i=>{const s=`epubjs-injected-css-${t}`;let r=this.styles.get(s);r&&this.document.head.removeChild(r),r=this.document.createElement("style"),r.id=s,this.document.head.appendChild(r),Object.keys(e).forEach(t=>{const i=e[t],s=r.sheet.cssRules.length,n=Object.keys(i).map(t=>`${t}:${i[t]}`).join(";");r.sheet.insertRule(`${t}{${n}}`,s)}),this.styles.set(s,r),i(r)})}appendStylesheet(t,e){const i=new q;return this.document?("string"==typeof e?this.createLink(t,e).then(t=>{i.resolve(t)}):this.createStyle(t,e).then(t=>{i.resolve(t)}),i.promise):(i.reject(new Error("Document cannot be null")),i.promise)}removeStylesheet(t){if(!this.document)return!1;const e=`epubjs-injected-css-${t}`,i=this.styles.get(e);return void 0!==i&&(this.document.head.removeChild(i),this.styles.delete(e))}clearStylesheets(){this.styles.forEach(t=>{this.document.head.removeChild(t)}),this.styles.clear()}appendScript(t,e){return new Promise((i,s)=>{if(!this.document)return void s(new Error("Document cannot be null"));const r=`epubjs-injected-src-${t}`;let n=this.styles.get(r);void 0===n&&(n=this.document.createElement("script"),n.type="text/javascript",n.src=e,n.onload=()=>{i(n)},n.onerror=()=>{s(new Error(`Failed to load source: ${e}`))},this.document.head.appendChild(n)),this.scripts.set(r,n)})}removeScript(t){if(!this.document)return!1;const e=`epubjs-injected-src-${t}`,i=this.scripts.get(e);return void 0!==i&&(this.document.head.removeChild(i),this.scripts.remove(e))}clearScripts(){this.scripts.forEach(t=>{this.document.head.removeChild(t)}),this.scripts.clear()}appendClass(t){if(!this.document)return;const e=this.content;e&&e.classList.add(t)}removeClass(t){if(!this.document)return;const e=this.content;e&&e.classList.remove(t)}range(t,e){return new V(t).toRange(this.document,e)}cfiFromRange(t,e){return new V(t,this.section.cfiBase,e).toString()}cfiFromNode(t,e){return new V(t,this.section.cfiBase,e).toString()}map(t){return new ye(t).section()}format(t){"paginated"===t.flow?this.columns(t):this.size(t)}size(t){const e="scrolled-doc"===t.flow?t.pageWidth:t.width,i=t.direction;this.width(e),this.viewport({width:e,scale:1,scalable:"no"}),this.direction(i),this.css("height","auto"),this.css("padding","20px "+e/12+"px"),this.css("overflow","hidden"),this.css("margin","0"),this.css("box-sizing","border-box")}columns(t){const e=t.pageWidth,i=t.pageHeight,s=t.columnWidth,r=t.direction,n=t.gap;this.width(e),this.height(i),this.viewport({width:e,height:i,scale:1,scalable:"no"}),this.direction(r),this.css("overflow","hidden"),this.css("margin","0",!0),this.css("box-sizing","border-box"),this.css("max-height","inherit"),this.css("display","block"),this.css("padding-top","20px"),this.css("padding-bottom","20px"),this.css("padding-left",n/2+"px",!0),this.css("padding-right",n/2+"px",!0),this.css("column-gap",n+"px"),this.css("column-fill","auto"),this.css("column-width",s+"px"),this.css("-webkit-line-box-contain","block glyphs replaced")}scale(t,e,i){const s="scale("+t+")";let r="";(e>=0||i>=0)&&(r=" translate("+(e||0)+"px, "+(i||0)+"px )"),this.css("transform",s+r),this.css("transform-origin","top left")}direction(t="ltr"){this.document.documentElement.dir=t}mapPage(t,e,i,s,r){return new ye(e,r).page(this,t,i,s)}writingMode(t="horizontal-tb"){if(this.mode===t)return this.mode;const e=c("writing-mode"),i=this.document.documentElement;return i.style[e]=t,this.mode=this.window.getComputedStyle(i)[e]||"",this.mode}appendListeners(){this.document&&(G.forEach(t=>{this.document.addEventListener(t,this.triggerEvent.bind(this),{passive:!0})},this),this.document.addEventListener("selectionchange",this.selectionHandler.bind(this),{passive:!0}),this.resizeObserver=new ResizeObserver(t=>{requestAnimationFrame(()=>this.resize(t))}),this.resizeObserver.observe(this.document.documentElement),((t,e)=>{const i=t.querySelectorAll("a[href]");if(!i.length)return;const s=t=>{const i=t.getAttribute("href");0!==i.indexOf("mailto:")&&(i.indexOf("://")>-1?t.setAttribute("target","_blank"):t.onclick=t=>(e(i),!1))};for(let t=0;t<i.length;t++)s(i[t])})(this.content,t=>{this.emit(it,t)}))}removeListeners(){this.document&&(G.forEach(t=>{this.document.removeEventListener(t,this.triggerEvent.bind(this),{passive:!0})},this),this.document.removeEventListener("selectionchange",this.selectionHandler.bind(this),{passive:!0}),this.resizeObserver&&this.resizeObserver.disconnect(),this.mutationObserver&&this.mutationObserver.disconnect())}triggerEvent(t){this.emit(t.type,t)}selectionHandler(t){this.selectionEndTimeout&&clearTimeout(this.selectionEndTimeout),this.selectionEndTimeout=setTimeout(()=>{const t=this.window.getSelection();if(!(t&&t.rangeCount>0))return;const e=t.getRangeAt(0);if(!e.collapsed){const t=new V(e,this.section.cfiBase).toString();this.emit(tt,t),this.emit(et,e)}},250)}imageLoadListeners(){const t=this.document.querySelectorAll("img");for(let e=0;e<t.length;e++){const i=t[e];void 0!==i.naturalWidth&&0===i.naturalWidth&&(i.onload=this.expand.bind(this))}}mediaQueryListeners(){const t=this.document.styleSheets,e=t=>{t.matches&&setTimeout(this.expand.bind(this),1)};for(let i=0;i<t.length;i+=1){let s;try{s=t[i].cssRules}catch(t){return void console.error(t)}if(!s)return;for(let t=0;t<s.length;t+=1)s[t].media&&(this.window.matchMedia(s[t].media.mediaText).onchange=e)}}fontLoadListeners(){this.document&&this.document.fonts&&this.document.fonts.ready.then(()=>this.resize())}transitionListeners(){const t=this.content;t.style.transitionProperty="font, font-size, font-size-adjust, font-stretch, font-variation-settings, font-weight, width, height",t.style.transitionDuration="0.001ms",t.style.transitionTimingFunction="linear",t.style.transitionDelay="0"}mutationListener(){this.mutationObserver=new MutationObserver((t,e)=>{t.forEach(t=>{})}),this.mutationObserver.observe(this.document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})}destroy(){this.removeListeners(),this.clearStylesheets(),this.styles=void 0,this.clearScripts(),this.scripts=void 0,this.section=void 0}}e(Te.prototype);const ke=Te,Oe=(t,e,i,s)=>{const r=t.top-s.top,n=t.left-s.left,o=r+t.height,a=n+t.width;return r<=i&&n<=e&&o>i&&a>e},Ce=(t,e,i)=>{let s=t.clientX,r=t.clientY;t.touches&&t.touches.length&&(s=t.touches[0].clientX,r=t.touches[0].clientY),i.forEach((i,n)=>{((t,e,i,s)=>{const r=t.getBoundingClientRect(),n=e.getBoundingClientRect();if(!Oe(r,i,s,n))return!1;const o=t.getClientRects();for(let t=0,e=o.length;t<e;t++)if(Oe(o[t],i,s,n))return!0;return!1})(i,e,s,r)&&i.dispatchEvent((t=>{const e=Object.assign({},t,{bubbles:!1});return new MouseEvent(t.type,e)})(t))})},Ne="http://www.w3.org/2000/svg";class Se extends Map{constructor(t,e=document.body){super(),this.target=t,this.element=document.createElementNS(Ne,"svg"),this.element.style.position="absolute",this.element.setAttribute("pointer-events","none"),((t,e)=>{let i;i="iframe"===t.nodeName||"IFRAME"===t.nodeName?t.contentDocument:t;const s=["mouseup","mousedown","click","touchstart"];for(const r of s)i.addEventListener(r,i=>Ce(i,t,e),!1)})(this.target,this),this.container=e,this.container.appendChild(this.element),this.render()}appendMark(t,e){const i=document.createElementNS(Ne,"g");return this.element.appendChild(i),e.bind(i,this.container),e.render(),this.set(t,e),e}removeMark(t){const e=this.get(t);if(e){const i=e.unbind();this.element.removeChild(i),this.delete(t)}}render(){this.updateStyle(this.element),this.forEach((t,e)=>t.render())}updateStyle(t){const e=this.target.getBoundingClientRect(),i=this.container.getBoundingClientRect(),s=e.top-i.top,r=e.left-i.left,n=this.target.scrollWidth,o=this.target.scrollHeight;t.style.setProperty("top",`${s}px`,"important"),t.style.setProperty("left",`${r}px`,"important"),t.style.setProperty("width",`${n}px`,"important"),t.style.setProperty("height",`${o}px`,"important")}}const Re=Se,Le=class{constructor(){this.element=null,this.range=null}bind(t,e){this.element=t,this.container=e}unbind(){const t=this.element;return this.element=null,t}clear(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild)}render(){}dispatchEvent(t){this.element&&this.element.dispatchEvent(t)}getBoundingClientRect(){return this.element.getBoundingClientRect()}getClientRects(){const t=[];let e=this.element.firstChild;for(;e;)t.push(e.getBoundingClientRect()),e=e.nextSibling;return t}},je=class extends Le{constructor(t,{className:e,data:i,attributes:s,listeners:r}){super(),this.range=t,this.className=e,this.data=i||{},this.attributes=s||{},this.listeners=r||[]}bind(t,e){super.bind(t,e);for(const t in this.data)this.data.hasOwnProperty(t)&&(this.element.dataset[t]=this.data[t]);for(const t in this.attributes)this.attributes.hasOwnProperty(t)&&this.element.setAttribute(t,this.attributes[t]);this.className&&this.element.classList.add(this.className)}render(){this.clear();const t=this.range.getClientRects(),e=this.element.getBoundingClientRect(),i=this.container.getBoundingClientRect();for(let s=0,r=t.length;s<r;s++){const r=t[s],n=document.createElementNS("http://www.w3.org/2000/svg","rect");n.setAttribute("x",r.left-e.left+i.left),n.setAttribute("y",r.top-e.top+i.top),n.setAttribute("height",r.height),n.setAttribute("width",r.width),this.element.appendChild(n)}}},Ae="http://www.w3.org/2000/svg",Pe=class extends je{constructor(t,e){super(t,e)}render(){this.clear();const t=this.range.getClientRects(),e=this.element.getBoundingClientRect(),i=this.container.getBoundingClientRect();for(let s=0,r=t.length;s<r;s++){const r=t[s],n=document.createElementNS(Ae,"rect"),o=document.createElementNS(Ae,"line");n.setAttribute("x",r.left-e.left+i.left),n.setAttribute("y",r.top-e.top+i.top),n.setAttribute("height",r.height),n.setAttribute("width",r.width),n.setAttribute("fill","none"),o.setAttribute("x1",r.left-e.left+i.left),o.setAttribute("x2",r.left-e.left+i.left+r.width),o.setAttribute("y1",r.top-e.top+i.top+r.height-1),o.setAttribute("y2",r.top-e.top+i.top+r.height-1),o.setAttribute("stroke-width",1),o.setAttribute("stroke","black"),o.setAttribute("stroke-linecap","square"),this.element.appendChild(n),this.element.appendChild(o)}}};class Me{constructor(t,e){this.id="vi-"+i(),this.contents=null,this.container=null,this.displayed=!1,this.document=null,this.expanding=!1,this.frame=null,this.marks=null,this.width=0,this.height=0,this.layout=t,this.section=e,this.settings=null,this.init()}init(){this.container=document.createElement("div"),this.container.classList.add("view-container"),this.container.style.height="0",this.container.style.width="0",this.container.style.overflow="hidden",this.container.style.position="relative",this.container.setAttribute("ref",this.section.index)}clear(){let t=0;return this.marks&&this.marks.forEach((e,i)=>{t=e instanceof je?this.unhighlight(e.data.epubcfi)?t+=1:t:this.ununderline(e.data.epubcfi)?t+=1:t}),t}create(){}render(t){const e=new q;return this.create(),this.section.render(t).then(t=>this.load(t)).then(t=>{this.update(),e.resolve(t)},t=>{this.emit(ut,t),e.reject(t)}).then(()=>{this.emit(dt,this)}),e.promise}reset(){this.frame&&(this.frame.style.width="0",this.frame.style.height="0",this.width=0,this.height=0)}update(){this.contents.format(this.layout),this.axis(),this.mode(),this.expand()}axis(){"horizontal"===this.layout.axis?this.container.style.flex="none":this.container.style.flex="initial"}mode(t){}expand(){if(!this.frame||this.expanding)return;this.expanding=!0;const t=this.contents.textSize(),e=this.layout.pageWidth;if("paginated"===this.layout.flow&&(t.width%e>0&&(t.width=Math.ceil(t.width/e)*e),this.settings.forceEvenPages)){const i=t.width/e;this.layout.divisor>1&&"reflowable"===this.layout.name&&i%2>0&&(t.width+=e)}this.width===t.width&&this.height===t.height||this.reframe(t.width,t.height),this.expanding=!1}reframe(t,e){this.frame&&(this.container.style.width=t+"px",this.container.style.height=e+"px",this.frame.style.width=t+"px",this.frame.style.height=e+"px",this.width=t,this.height=e,this.marks&&this.marks.render())}load(t){return Promise.resolve()}display(t){const e=new q;return this.displayed?e.resolve(this):this.render(t).then(()=>{this.emit(ft),this.displayed=!0,e.resolve(this)},t=>{e.reject(t)}),e.promise}show(){this.container.style.visibility="visible",this.frame&&(this.frame.style.visibility="visible"),this.emit(gt,this)}hide(){this.container.style.visibility="hidden",this.frame&&(this.frame.style.visibility="hidden"),this.emit(mt,this)}offset(){return{top:this.container.offsetTop,left:this.container.offsetLeft}}position(){return this.container.getBoundingClientRect()}locationOf(t){const e=this.contents.locationOf(t,this.settings.ignoreClass);return{left:e.left,top:e.top}}highlight(t,e={},i=null,s="epubjs-hl",r={}){if(!this.contents)return;e.epubcfi=t,null===this.marks&&(this.marks=new Re(this.frame,this.container));const n=Object.assign({fill:"yellow","fill-opacity":"0.3","mix-blend-mode":"multiply"},r),o=i=>{this.emit(vt,t,e)},a=encodeURI("epubjs-hl:"+t),h=this.contents.range(t),c=new je(h,{className:s,data:e,attributes:n,listeners:[o,i]}),l=this.marks.appendMark(a,c);return l.element.setAttribute("ref",s),l.element.addEventListener("click",o),l.element.addEventListener("touchstart",o),i&&(l.element.addEventListener("click",i),l.element.addEventListener("touchstart",i)),l}unhighlight(t){const e=encodeURI("epubjs-hl:"+t),i=this.marks.get(e);let s=!1;return i&&(i.listeners.forEach(t=>{t&&(i.element.removeEventListener("click",t),i.element.removeEventListener("touchstart",t))}),this.marks.removeMark(e),s=!0),s}underline(t,e={},i=null,s="epubjs-ul",r={}){if(!this.contents)return;e.epubcfi=t,null===this.marks&&(this.marks=new Re(this.frame,this.container));const n=Object.assign({stroke:"black","stroke-opacity":"0.3","mix-blend-mode":"multiply"},r),o=i=>{this.emit(vt,t,e)},a=encodeURI("epubjs-ul:"+t),h=this.contents.range(t),c=new Pe(h,{className:s,data:e,attributes:n,listeners:[o,i]}),l=this.marks.appendMark(a,c);return l.element.setAttribute("ref",s),l.element.addEventListener("click",o),l.element.addEventListener("touchstart",o),i&&(l.element.addEventListener("click",i),l.element.addEventListener("touchstart",i)),l}ununderline(t){const e=encodeURI("epubjs-ul:"+t),i=this.marks.get(e);let s=!1;return i&&(i.listeners.forEach(t=>{t&&(i.element.removeEventListener("click",t),i.element.removeEventListener("touchstart",t))}),this.marks.removeMark(e),s=!0),s}destroy(){this.marks&&this.displayed&&(this.marks.element.remove(),this.marks.clear(),this.marks=void 0),this.displayed&&(this.displayed=void 0,this.container.removeChild(this.frame),this.container=void 0,this.contents.destroy(),this.contents=void 0),this.expanding=void 0,this.document=void 0,this.frame=void 0,this.size=void 0,this.id=void 0,this.width=void 0,this.height=void 0,this.settings=void 0}}e(Me.prototype);const Ie=Me,_e=class extends Ie{constructor(t,e,i){super(t,e),this.settings=u({method:null,sandbox:[],forceEvenPages:!1,ignoreClass:""},i||{}),this.blobUrl=null,this.method=this.settings.method||"write",this.writingMode=""}create(){return this.frame=document.createElement("iframe"),this.frame.id=this.id,this.frame.seamless="seamless",this.frame.style.overflow="hidden",this.frame.style.border="none",this.frame.style.width="0",this.frame.style.height="0",this.settings.sandbox.forEach(t=>t&&this.frame.sandbox.add(t)),this.frame.setAttribute("enable-annotation","true"),this.width=0,this.height=0,this.frame}mode(t){const e=t||this.contents.mode;this.writingMode!==e&&(this.writingMode=e,this.emit(lt,e))}load(t){const e=new q;return this.frame?(this.container.appendChild(this.frame),this.document=this.frame.contentDocument,this.frame.onload=t=>this.onLoad(t,e),this.document?("blobUrl"===this.method?(this.blobUrl=k(t,"application/xhtml+xml"),this.frame.src=this.blobUrl):"srcdoc"===this.method?this.frame.srcdoc=t:(this.document.open(),this.document.write("<!DOCTYPE html>"),this.document.write(t),this.document.close()),e.promise):(e.reject(new Error("No Document Available")),e.promise)):(e.reject(new Error("No Iframe Available")),e.promise)}onLoad(t,e){this.document=t.target.contentDocument,this.contents=new ke(this.document,this.document.body,this.section);let i=this.document.querySelector("link[rel='canonical']");i?i.setAttribute("href",this.section.canonical):(i=this.document.createElement("link"),i.setAttribute("rel","canonical"),i.setAttribute("href",this.section.canonical),this.document.head.appendChild(i)),this.contents.on(Q,t=>{this.emit(pt,t)}),e.resolve(this.contents)}show(){this.frame&&(this.frame.style.transform="translateZ(0)",this.frame.style.transform=null),super.show()}destroy(){this.blobUrl&&(O(this.blobUrl),this.blobUrl=void 0),this.displayed&&(super.destroy(),this.method=void 0,this.writingMode=void 0)}},De=class extends Ie{constructor(t,e,i){super(t,e),this.settings=u({width:0,height:0,ignoreClass:""},i||{})}create(){return this.frame=document.createElement("div"),this.frame.id=this.id,this.frame.style.overflow="hidden",this.frame.style.border="none",this.frame.style.wordSpacing="initial",this.frame.style.lineHeight="initial",this.width=0,this.height=0,this.frame}load(t){const e=new q;if(!this.frame)return e.reject(new Error("No Iframe Available")),e.promise;const i=S(t,"text/html"),s=R(i,"body");return this.container.appendChild(this.frame),this.document=this.frame.ownerDocument,this.document?(this.contents=new ke(this.document,this.frame),this.frame.innerHTML=s.innerHTML,e.resolve(this.contents),e.promise):(e.reject(new Error("No Document Available")),e.promise)}};var ze=r(8221);const Be="horizontal",Fe="vertical";class qe{constructor(t,e){this.name="default",this.load=t.load.bind(t),this.layout=t.rendition.layout,this.layout.on(Lt,(t,e)=>{e.flow&&(this.paginated="paginated"===t.flow),this.views.update(),this.calculate()}),this.settings=u({view:"iframe",method:null,sandbox:[],ignoreClass:"",forceEvenPages:!0},e||{}),this.paginated="paginated"===this.layout.flow,this.location=[],this.mapping=new ye(this.layout),this.rendered=!1,this.scrollType=null,this.views=new we,this.viewport=t.rendition.viewport,this.writingMode=null,this.q=new Y(this)}render(t,e){this.scrollType=(()=>{let t="reverse";const e=(()=>{const t=document.createElement("div");t.dir="rtl",t.style.position="fixed",t.style.width="1px",t.style.height="1px",t.style.top="0px",t.style.left="0px",t.style.overflow="hidden";const e=document.createElement("div");e.style.width="2px";const i=document.createElement("span");i.style.width="1px",i.style.display="inline-block";const s=document.createElement("span");return s.style.width="1px",s.style.display="inline-block",e.appendChild(i),e.appendChild(s),t.appendChild(e),t})();return document.body.appendChild(e),e.scrollLeft>0?t="default":"undefined"!=typeof Element&&Element.prototype.scrollIntoView?(e.children[0].children[1].scrollIntoView(),e.scrollLeft<0&&(t="negative")):(e.scrollLeft=1,0===e.scrollLeft&&(t="negative")),document.body.removeChild(e),t})(),this.viewport.attachTo(t,{views:this.views,width:e.width,height:e.height}),this.rendered=!0,this.appendEventListeners(),window.onpagehide=this.destroy.bind(this)}display(t,e){const i=new q;(e===t.href||a(e))&&(e=void 0);const s=this.views.find(t);if(s){const t=s.offset();let r,n=t.top;return"ltr"===this.layout.direction?(r=t.left,this.scrollTo(r,n,!0)):(r=t.left+s.width,this.scrollTo(r,n,!0)),e&&this.moveTo(s.locationOf(e),s.width),i.resolve(),i.promise}return this.clear(),this.append(t).then(t=>{if(e){const i=t.locationOf(e);this.moveTo(i,t.width)}return t},t=>{i.reject(t)}).then(t=>{this.views.show(),i.resolve(t)}),i.promise}appendEventListeners(){const t=this.views.container;t.addEventListener("scroll",this.onscroll.bind(this)),"onscrollend"in window&&t.addEventListener("scrollend",this.onscrollend.bind(this));const e="default"===this.name?0:30;this.scrollend=ze(this.scrolled.bind(this),e)}removeEventListeners(){const t=this.views.container;t.removeEventListener("scroll",this.onscroll.bind(this)),"onscrollend"in window&&t.removeEventListener("scrollend",this.onscrollend.bind(this)),this.scrollend=void 0}requireView(t){let e;return e="string"==typeof t&&"iframe"===t?_e:"inline"===t?De:t,e}createView(t){return new(this.requireView(this.settings.view))(this.layout,t,{snap:this.settings.snap,method:this.settings.method,sandbox:this.settings.sandbox,ignoreClass:this.settings.ignoreClass,forceEvenPages:this.settings.forceEvenPages})}displayed(t){this.emit(nt,t)}resized(t){this.relocated(),this.emit(rt,t)}moveTo(t,e){let i,s=0;const r=this.views.container;this.paginated?(s=Math.floor(t.left/this.layout.delta)*this.layout.delta,s+this.layout.delta>r.scrollWidth&&(s=r.scrollWidth-this.layout.delta),i=Math.floor(t.top/this.layout.delta)*this.layout.delta,i+this.layout.delta>r.scrollHeight&&(i=r.scrollHeight-this.layout.delta)):i=t.top,"rtl"===this.layout.direction&&(s+=this.layout.delta,s-=e),this.scrollTo(s,i,!0)}append(t){const e=this.createView(t);return e.on(ft,()=>{this.displayed(e)}),e.on(pt,t=>{this.resized(e)}),e.on(lt,t=>{this.updateWritingMode(t)}),this.views.append(e),e.display(this.load)}prepend(t){const e=this.createView(t);return e.on(ft,()=>{this.displayed(e)}),e.on(pt,t=>{this.counter(e),this.resized(e)}),e.on(lt,t=>{this.updateWritingMode(t)}),this.views.prepend(e),e.display(this.load)}counter(t){const e=t.contents.content;if(this.layout.axis===Fe){const t=e.scrollHeight;this.scrollBy(0,t,!0)}else{const t=e.scrollWidth;this.scrollBy(t,0,!0)}}next(){let t,e;const i=new q,s=this.layout.direction,r=this.layout.axis===Be&&this.paginated,n=this.layout.axis===Fe&&this.paginated,o=this.views.container;return 0===this.views.length?(i.resolve(null),i.promise):(r&&"ltr"===s?(this.scrollLeft=o.scrollLeft,t=o.scrollLeft+o.offsetWidth+this.layout.delta,t<=o.scrollWidth?this.scrollBy(this.layout.delta,0,!0):e=this.views.last().section.next()):r&&"rtl"===s?(this.scrollLeft=o.scrollLeft,"default"===this.scrollType?(t=o.scrollLeft,t>0?this.scrollBy(this.layout.delta,0,!0):e=this.views.last().section.next()):(t=o.scrollLeft+-1*this.layout.delta,t>-1*o.scrollWidth?this.scrollBy(this.layout.delta,0,!0):e=this.views.last().section.next())):n&&o.scrollTop+o.offsetHeight<o.scrollHeight?this.scrollBy(0,this.layout.height,!0):e=this.views.last().section.next(),e?(this.clear(),this.calculate(),this.append(e).then(t=>{r||"rtl"!==s||"default"!==this.scrollType||this.scrollTo(o.scrollWidth,0,!0),this.views.show(),i.resolve(t)},t=>{i.reject(t)})):(this.relocated(),i.resolve(null)),i.promise)}prev(){let t,e;const i=new q,s=this.layout.direction,r=this.layout.axis===Be&&this.paginated,n=this.layout.axis===Fe&&this.paginated,o=this.views.container;return 0===this.views.length?(i.resolve(null),i.promise):(r&&"ltr"===s?(this.scrollLeft=o.scrollLeft,t=o.scrollLeft,t>0?this.scrollBy(-this.layout.delta,0,!0):e=this.views.first().section.prev()):r&&"rtl"===s?(this.scrollLeft=o.scrollLeft,"default"===this.scrollType?(t=o.scrollLeft+o.offsetWidth,t<o.scrollWidth?this.scrollBy(-this.layout.delta,0,!0):e=this.views.first().section.prev()):(t=o.scrollLeft,t<0?this.scrollBy(-this.layout.delta,0,!0):e=this.views.first().section.prev())):n&&o.scrollTop>0?this.scrollBy(0,-this.layout.height,!0):e=this.views.first().section.prev(),e?(this.clear(),this.calculate(),this.prepend(e).then(t=>{r&&("rtl"===s?"default"===this.scrollType?this.scrollTo(0,0,!0):this.scrollTo(-1*o.scrollWidth+this.layout.delta,0,!0):this.scrollTo(o.scrollWidth-this.layout.delta,0,!0)),this.views.show(),i.resolve(t)},t=>{i.reject(t)})):(this.relocated(),i.resolve(null)),i.promise)}current(){const t=this.visible();return t.length?t[t.length-1]:null}clear(){this.views.hide(),this.scrollTo(0,0,!0),this.views.clear()}relocated(){this.currentLocation(),this.emit(ct,this.location)}currentLocation(){return this.layout.axis===Be&&this.paginated?this.location=this.paginatedLocation():this.location=this.scrolledLocation(),this.location}scrolledLocation(){const t=this.views.container,e=this.visible().map(e=>{const{href:i,index:s}=e.section;let r,n,o,a,h;if(this.layout.axis===Fe){const i=t.scrollTop;r=Math.abs(i),n=Math.abs(i)+t.clientHeight,o=Math.ceil(r/t.clientHeight),a=Math.ceil(n/t.clientHeight),h=this.layout.count(e.height,t.clientHeight).pages}else{const i=t.scrollLeft;r=Math.abs(i),n=Math.abs(i)+t.clientWidth,o=Math.ceil(r/t.clientWidth),a=Math.ceil(n/t.clientWidth),h=this.layout.count(e.height,t.clientWidth).pages}const c=[];for(let t=o;t<a;t++)c.push({index:t});const l=this.mapping.page(e.contents,e.section.cfiBase,r,n);return{axis:this.layout.axis,href:i,index:s,pages:c,total:h,mapping:l}});return e}paginatedLocation(){const t=this.views.container,e=this.viewport.rect,i=t.scrollLeft,s=this.visible().map(t=>{const{href:s,index:r}=t.section,n=this.layout.count(t.width).pages,o=Math.abs(i),a=Math.abs(i)+e.width,h=Math.floor(o/this.layout.pageWidth),c=Math.floor(a/this.layout.pageWidth),l=[];for(let t=h;t<c;t++)l.push({index:t});const u=this.mapping.page(t.contents,t.section.cfiBase,o,a);return{axis:this.layout.axis,href:s,index:r,pages:l,total:n,mapping:u}});return s}isVisible(t,e,i){const s=t.position(),r=this.viewport.rect;return this.layout.axis===Be&&s.right>r.left-e&&s.left<r.right+i||this.layout.axis===Fe&&s.bottom>r.top-e&&s.top<r.bottom+i}visible(){const t=this.views.displayed(),e=[];for(let i=0,s=t.length;i<s;i++){const s=t[i];this.isVisible(s,0,0)&&e.push(s)}return e}scrollBy(t,e,i){const s="rtl"===this.layout.direction?-1:1,r=this.views.container;i&&(this.ignore=!0),t&&(r.scrollLeft+=t*s),e&&(r.scrollTop+=e)}scrollTo(t,e,i){i&&(this.ignore=!0),this.views.container.scrollLeft=t,this.views.container.scrollTop=e}scrolled(t){this.paginated&&"default"===this.name||(this.relocated(),this.emit(at,{top:t.target.scrollTop,left:t.target.scrollLeft}))}onscroll(t){this.paginated&&"default"===this.name||(this.ignore?this.ignore=!1:(this.emit(ot,{top:t.target.scrollTop,left:t.target.scrollLeft}),"onscrollend"in window||this.scrollend(t)))}onscrollend(t){this.scrollend(t)}calculate(){this.paginated?(this.layout.calculate(this.viewport.rect.width,this.viewport.rect.height,this.settings.gap),this.settings.offset=this.layout.delta/this.layout.divisor):this.layout.calculate(this.viewport.rect.width,this.viewport.rect.height)}updateWritingMode(t){this.writingMode=t}getContents(){const t=[];return this.views?(this.views.forEach(e=>{e&&t.push(e.contents)}),t):t}isRendered(){return this.rendered}destroy(){this.views&&(this.removeEventListeners(),this.views.destroy(),this.views=void 0,this.ignore=void 0,this.mapping.destroy(),this.mapping=void 0,this.location=void 0,this.rendered=void 0,this.paginated=void 0,this.scrollType=void 0,this.writingMode=void 0)}}e(qe.prototype);const Ue=qe,We=Math.PI/2,He={easeOutSine:t=>Math.sin(t*We),easeInOutSine:t=>-.5*(Math.cos(Math.PI*t)-1),easeInOutQuint:t=>(t/=.5)<1?.5*Math.pow(t,5):.5*(Math.pow(t-2,5)+2),easeInCubic:t=>Math.pow(t,3)};class Xe{constructor(t,e){this.settings=u({duration:300,minVelocity:.2,minDistance:10,easing:He.easeInCubic},e||{}),this.supportsTouch()&&this.setup(t)}setup(t){this.manager=t,this.layout=this.manager.layout,this.element=this.manager.views.container,this.scroller=this.element,this.manager.settings.offset=this.layout.width,this.manager.settings.afterScrolledTimeout=2*this.settings.duration,this.isVertical="vertical"===this.manager.layout.axis,this.manager.paginated&&!this.isVertical&&(this.touchCanceler=!1,this.resizeCanceler=!1,this.snapping=!1,this.scrollLeft,this.scrollTop,this.startTouchX=void 0,this.startTouchY=void 0,this.startTime=void 0,this.endTouchX=void 0,this.endTouchY=void 0,this.endTime=void 0,this.addListeners())}supportsTouch(){return"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch}disableScroll(){}enableScroll(){}addListeners(){window.addEventListener("resize",this.onResize.bind(this)),this.scroller.addEventListener("scroll",this.onScroll.bind(this)),this.scroller.addEventListener("touchstart",this.onTouchStart.bind(this),{passive:!0}),this.scroller.addEventListener("touchmove",this.onTouchMove.bind(this),{passive:!0}),this.scroller.addEventListener("touchend",this.onTouchEnd.bind(this),{passive:!0}),this.on("touchstart",this.onTouchStart.bind(this)),this.on("touchmove",this.onTouchMove.bind(this)),this.on("touchend",this.onTouchEnd.bind(this)),this.manager.on(nt,this.afterDisplayed.bind(this))}removeListeners(){window.removeEventListener("resize",this.onResize.bind(this)),this.scroller.removeEventListener("scroll",this.onScroll.bind(this)),this.scroller.removeEventListener("touchstart",this.onTouchStart.bind(this),{passive:!0}),this.scroller.removeEventListener("touchmove",this.onTouchMove.bind(this),{passive:!0}),this.scroller.removeEventListener("touchend",this.onTouchEnd.bind(this),{passive:!0}),this.off("touchstart",this.onTouchStart.bind(this)),this.off("touchmove",this.onTouchMove.bind(this)),this.off("touchend",this.onTouchEnd.bind(this)),this.manager.off(nt,this.afterDisplayed.bind(this))}afterDisplayed(t){const e=t.contents;["touchstart","touchmove","touchend"].forEach(t=>{e.on(t,t=>this.triggerViewEvent(t,e))})}triggerViewEvent(t,e){this.emit(t.type,t,e)}onScroll(t){this.scrollLeft=this.scroller.scrollLeft,this.scrollTop=this.scroller.scrollTop}onResize(t){this.resizeCanceler=!0}onTouchStart(t){const{screenX:e,screenY:i}=t.touches[0];this.touchCanceler=!0,this.startTouchX||(this.startTouchX=e,this.startTouchY=i,this.startTime=(new Date).getTime()),this.endTouchX=e,this.endTouchY=i,this.endTime=(new Date).getTime()}onTouchMove(t){const{screenX:e,screenY:i}=t.touches[0],s=Math.abs(i-this.endTouchY);this.touchCanceler=!0,s<10&&(this.element.scrollLeft-=e-this.endTouchX),this.endTouchX=e,this.endTouchY=i,this.endTime=(new Date).getTime()}onTouchEnd(t){this.touchCanceler=!1;let e=this.wasSwiped();0!==e?this.snap(e):this.snap(),this.startTouchX=void 0,this.startTouchY=void 0,this.startTime=void 0,this.endTouchX=void 0,this.endTouchY=void 0,this.endTime=void 0}wasSwiped(){const t=this.layout.pageWidth*this.layout.divisor,e=this.endTouchX-this.startTouchX,i=Math.abs(e),s=e/(this.endTime-this.startTime),r=this.settings.minVelocity;return i<=this.settings.minDistance||i>=t?0:s>r?-1:s<-r?1:void 0}needsSnap(){return this.scrollLeft%(this.layout.pageWidth*this.layout.divisor)!==0}snap(t=0){const e=this.scrollLeft,i=this.layout.pageWidth*this.layout.divisor;let s=Math.round(e/i)*i;return t&&(s+=t*i),this.smoothScrollTo(s)}smoothScrollTo(t){const e=new q,i=this.scrollLeft,s=(new Date).getTime(),r=this.settings.duration;this.snapping=!0;const n=()=>{const o=(new Date).getTime(),a=Math.min(1,(o-s)/r);if(this.touchCanceler||this.resizeCanceler)return this.resizeCanceler=!1,this.snapping=!1,void e.resolve();a<1?(requestAnimationFrame(n),this.scrollTo(i+(t-i)*a,0)):(this.scrollTo(t,0),this.snapping=!1,e.resolve())};return n.call(this),e.promise}scrollTo(t=0,e=0){this.scroller.scrollLeft=t,this.scroller.scrollTop=e}destroy(){void 0!==this.scroller&&(this.removeListeners(),this.scroller=void 0)}}e(Xe.prototype);const Ve=Xe,$e="horizontal",Ye=class extends Ue{constructor(t,e){super(t,e),this.name="continuous",this.settings=u({axis:null,snap:null,view:"iframe",method:null,offset:500,offsetDelta:250,ignoreClass:"",forceEvenPages:!1},e||{})}render(t,e){super.render(t,e),this.paginated&&this.settings.snap&&(this.snapper=new Ve(this,this.settings.snap))}async display(t,e){return super.display(t,e).then(()=>this.fill())}fill(t){const e=t||new q;return this.q.enqueue(()=>this.check()).then(t=>{t?this.fill(e):e.resolve()}),e.promise}moveTo(t){let e=0,i=0;this.paginated?e=Math.floor(t.left/this.layout.delta)*this.layout.delta:i=t.top,(e>0||i>0)&&this.scrollBy(e,i,!0)}removeShownListeners(t){t.off(ft)}async update(t){const e=this.views,i=t||this.settings.offset||0,s=[];for(let t=0;t<e.length;t++){const r=e[t];if(this.isVisible(r,i,i))if(r.displayed)r.show();else{const t=r.display(this.load).then(t=>{t.show()});s.push(t)}}return s.length?Promise.all(s):Promise.resolve(null)}async check(t,e){const i=[],s=this.layout.axis===$e,r=this.views.container,n="rtl"===this.layout.direction;let o=this.settings.offset||0;t&&s&&(o=t),e&&!s&&(o=e);const a=this.viewport.rect,h=s?Math.floor(a.width):a.height,c=s?r.scrollWidth:r.scrollHeight;let l=s?r.scrollLeft:r.scrollTop;0===this.writingMode.indexOf($e)&&(n&&"default"===this.scrollType&&(l=c-h-l),n&&"negative"===this.scrollType&&(l*=-1));const u=l-o;return l+h+o>=c&&(()=>{const t=this.views.last(),e=t&&t.section.next();e&&i.push(this.append(e))})(),u<0&&(()=>{const t=this.views.first(),e=t&&t.section.prev();e&&i.push(this.prepend(e))})(),i.length?Promise.all(i).then(()=>this.update(o)):Promise.resolve(null)}scrolled(t){this.q.enqueue(()=>this.check()).then(()=>{this.relocated(),this.emit(at,{top:t.target.scrollTop,left:t.target.scrollLeft})})}next(){return 0===this.views.length?Promise.resolve(null):(this.paginated&&this.layout.axis===$e?this.scrollBy(this.layout.delta,0,!0):this.scrollBy(0,this.layout.height,!0),this.q.enqueue(()=>this.check()))}prev(){return 0===this.views.length?Promise.resolve(null):(this.paginated&&this.layout.axis===$e?this.scrollBy(-this.layout.delta,0,!0):this.scrollBy(0,-this.layout.height,!0),this.q.enqueue(()=>this.check()))}destroy(){super.destroy(),this.snapper&&this.snapper.destroy()}};class Je{constructor(t,e){this.settings=u({width:null,height:null,manager:"default",view:"iframe",flow:null,method:"write",layout:null,spread:null,minSpreadWidth:800,script:null,snap:null,direction:null,ignoreClass:"",sandbox:[],stylesheet:null},e||{}),this.book=t,this.hooks={content:new ge(this),display:new ge(this),layout:new ge(this),render:new ge(this),show:new ge(this),unloaded:new ge(this)},this.hooks.content.register(this.handleLinks.bind(this)),this.hooks.content.register(this.passEvents.bind(this)),this.hooks.content.register(this.adjustImages.bind(this)),this.book.sections.hooks.content.register(this.injectIdentifier.bind(this)),this.settings.stylesheet&&this.book.sections.hooks.content.register(this.injectStylesheet.bind(this)),this.settings.script&&this.book.sections.hooks.content.register(this.injectScript.bind(this)),this.annotations=new le(this),this.themes=new fe(this),this.epubcfi=new V,this.location=null,this.starting=new q,this.started=this.starting.promise,this.q=new Y(this),this.q.enqueue(this.book.opened),this.q.enqueue(this.start.bind(this))}requireManager(t){let e;return"string"==typeof t?e="continuous"===t?Ye:Ue:"function"==typeof t&&(e=t),e}start(){const t=this.determineLayoutProperties();if(this.layout=new de(t),this.layout.on(Lt,(t,e)=>{this.emit(Rt,t,e)}),this.viewport=new ve(this.layout),this.viewport.on(_t,t=>{"paginated"===this.layout.flow?this.layout.set({width:t.width,height:t.height}):"horizontal"===this.layout.axis?this.layout.set({height:t.height}):"vertical"===this.layout.axis&&this.layout.set({width:t.width}),this.location&&this.emit(kt,t)}),this.viewport.on(Dt,t=>{this.emit(Ot,t)}),!this.manager){const t=this.requireManager(this.settings.manager),e={snap:this.settings.snap,view:this.settings.view,method:this.settings.method,sandbox:this.settings.sandbox,ignoreClass:this.settings.ignoreClass};this.manager=new t(this.book,e)}this.manager.on(nt,this.afterDisplayed.bind(this)),this.manager.on(ht,this.afterRemoved.bind(this)),this.manager.on(rt,this.onResized.bind(this)),this.manager.on(ct,this.relocated.bind(this)),this.emit(yt),navigator.epubReadingSystem={name:"epub-js",version:J,layoutStyle:this.layout.style,hasFeature:t=>{switch(t){case"dom-manipulation":case"layout-changes":case"touch-events":case"mouse-events":case"keyboard-events":return!0;default:return!1}}},this.starting.resolve()}attachTo(t){return this.q.enqueue(()=>{this.manager.render(t,{width:this.settings.width,height:this.settings.height}),this.emit(wt)})}display(t){return this.q.enqueue(this._display.bind(this),t)}_display(t){const e=new q;this.book.locations.size&&h(t)&&(t=this.book.locations.cfiFromPercentage(parseFloat(t)));const i=this.book.sections.get(t);return i?(this.manager.display(i,t).then(()=>{e.resolve(i),this.emit(bt,i)},t=>{this.emit(xt,t)}).then(()=>{this.viewport.update()}),e.promise):(e.reject(new Error("No Section Found")),e.promise)}afterDisplayed(t){t.on(vt,(e,i)=>{this.triggerMarkEvent(e,i,t.contents)}),this.hooks.render.trigger(t,this).then(()=>{t.contents?this.hooks.content.trigger(t.contents,this).then(()=>{this.emit(Et,t)}):this.emit(Et,t)})}afterRemoved(t){this.hooks.unloaded.trigger(t,this).then(()=>{this.emit(Tt,t)})}onResized(t){return this.adjustImages(t.contents)}moveTo(t){this.manager.moveTo(t)}resize(t,e){return this.viewport.size(t,e)}clear(){this.manager.clear()}next(){return this.q.enqueue(this.manager.next.bind(this.manager))}prev(){return this.q.enqueue(this.manager.prev.bind(this.manager))}determineLayoutProperties(){const{metadata:t,direction:e}=this.book.packaging;return{name:this.settings.layout||t.get("layout"),flow:this.settings.flow||t.get("flow"),spread:this.settings.spread||t.get("spread"),viewport:t.get("viewport"),direction:this.settings.direction||e||"ltr",orientation:this.settings.orientation||t.get("orientation"),minSpreadWidth:this.settings.minSpreadWidth,pageWidth:this.settings.pageWidth,pageHeight:this.settings.pageHeight}}updateLayout(t){this.layout.set(t)}currentLocation(){const t=this.manager.currentLocation();if(t&&t.then&&"function"==typeof t.then)t.then(t=>this.located(t));else if(t)return this.located(t)}located(t){if(0===t.length)return{};const e=t[0],i=t[t.length-1],s={atStart:!1,atEnd:!1,start:{cfi:e.mapping.start,href:e.href,index:e.index,displayed:{page:e.pages[0],total:e.total}},end:{cfi:i.mapping.end,href:i.href,index:i.index,displayed:{page:i.pages[i.pages.length-1],total:i.total}}},r=this.book.locations;if(r.size){const t=r.locationFromCfi(e.mapping.start),n=r.locationFromCfi(i.mapping.end);-1!==t&&(s.start.location=t,s.start.percentage=r.percentageFromLocation(t)),-1!==n&&(s.end.location=n,s.end.percentage=r.percentageFromLocation(n))}const n=this.book.navigation.pageList;if(n.length){const t=n.pageFromCfi(e.mapping.start),r=n.pageFromCfi(i.mapping.end);-1!==t&&(s.start.page=t),-1!==r&&(s.end.page=r)}const o=s.start.displayed.page;this.book.sections.first().index===e.index&&0===o.index&&(s.atStart=!0);const a=s.end.displayed.page;return this.book.sections.last().index===i.index&&a.index===s.end.displayed.total-1&&(s.atEnd=!0),s}relocated(t){const e=this.located(t);(e||e.start&&e.end)&&(this.location=e,this.emit(Ct,this.location))}passEvents(t){G.forEach(e=>{t.on(e,e=>this.triggerViewEvent(e,t))}),t.on(tt,e=>this.triggerSelectedEvent(e,t))}triggerViewEvent(t,e){this.emit(t.type,t,e)}triggerSelectedEvent(t,e){this.emit(St,t,e)}triggerMarkEvent(t,e,i){this.emit(Nt,t,e,i)}getRange(t,e){const i=new V(t),s=this.manager.visible().filter(t=>{if(i.spinePos===t.section.index)return!0});if(s.length)return s[0].contents.range(i,e)}adjustImages(t){const e=t?t.content:null;if(!e)return Promise.resolve(null);const i=parseFloat(e.style["padding-top"]),s=parseFloat(e.style["padding-bottom"]),r=parseFloat(e.style["padding-left"])+parseFloat(e.style["padding-right"]),n=i+s,o=(this.layout.columnWidth?this.layout.columnWidth-r+"px":"100%")+" !important",a=e.offsetHeight-n+"px !important";return t.appendStylesheet("images",{img:{"max-width":o,"max-height":a,"object-fit":"contain","page-break-inside":"avoid","break-inside":"avoid","box-sizing":"border-box"},svg:{"max-width":o,"max-height":a,"page-break-inside":"avoid","break-inside":"avoid"}})}getContents(){return this.manager?this.manager.getContents():[]}views(){return(this.manager?this.manager.views:void 0)||[]}handleLinks(t){t&&t.on(it,t=>{this.display(t)})}injectStylesheet(t,e){const i=t.createElement("link");i.setAttribute("type","text/css"),i.setAttribute("rel","stylesheet"),i.setAttribute("href",this.settings.stylesheet),t.getElementsByTagName("head")[0].appendChild(i)}injectScript(t,e){const i=t.createElement("script");i.setAttribute("type","text/javascript"),i.setAttribute("src",this.settings.script),i.textContent=" ",t.getElementsByTagName("head")[0].appendChild(i)}injectIdentifier(t,e){const i=this.book.packaging.metadata.get("identifier"),s=t.createElement("meta");s.setAttribute("name","dc.relation.ispartof"),i&&s.setAttribute("content",i),t.getElementsByTagName("head")[0].appendChild(s)}destroy(){this.q.destroy(),this.layout.destroy(),this.themes.destroy(),this.viewport.destroy(),this.manager.destroy(),this.hooks.display.clear(),this.hooks.content.clear(),this.hooks.layout.clear(),this.hooks.render.clear(),this.hooks.show.clear(),this.hooks.unloaded.clear(),this.hooks=void 0,this.layout=void 0,this.themes=void 0,this.manager=void 0,this.epubcfi=void 0,this.started=void 0,this.starting=void 0,this.viewport=void 0,this.q=void 0}}e(Je.prototype);const Ge=Je,Ke=!(!window||!window.URL),Ze=Ke?"blob":"arraybuffer",Qe=(t,e,i="Error")=>{const s=t.target;e.dump.error=s.status,e.reject({message:i,target:s,stack:(new Error).stack,trace:{dump:e.dump,uuid:e.id}})},ti=(t,e,i=!1,s=[])=>{const r=new q,n=new XMLHttpRequest;e=e||new U(t).extension,n.withCredentials=i,E(e)?(n.responseType="document",n.overrideMimeType("text/xml")):"xhtml"===e||"html"===e||"htm"===e?n.responseType="document":"binary"===e?n.responseType="arraybuffer":"blob"===e?n.responseType=Ze:"json"===e&&(n.responseType="json"),n.onreadystatechange=t=>((t,e)=>{const i=t.target;403===i.status?Qe(t,e,"Forbidden"):e.dump.read?e.dump.read.push(i.status):e.dump.read=[i.status]})(t,r),n.onload=t=>((t,e,i)=>{const s=t.target;let r;"document"===s.responseType?null===s.response&&null===s.responseXML?i.reject({message:"Empty Response",target:s,stack:(new Error).stack,trace:{dump:i.dump,uuid:i.id}}):s.responseXML?r=s.responseXML:E(e)?r=S(s.response,"text/xml"):"xhtml"===e?r=S(s.response,"application/xhtml+xml"):"html"!==e&&"htm"!==e||(r=S(s.response,"text/html")):r="json"===s.responseType?s.response:"blob"===s.responseType?Ke?s.response:new Blob([s.response]):s.response,i.dump.load=[s.status,s.responseType],i.resolve(r)})(t,e,r),n.onprogress=t=>((t,e)=>{const i=t.target;e.dump.progress=i.status})(t,r),n.onloadstart=t=>((t,e)=>{const i=t.target;e.dump.start=i.status})(t,r),n.onloadend=t=>((t,e)=>{const i=t.target;e.dump.end=i.status})(t,r),n.onerror=t=>Qe(t,r),n.open("GET",t,!0);for(const t in s)n.setRequestHeader(t,s[t]);return n.send(),r.promise},ei=class{constructor(){this.instance=null}async request(t,e){let i;return i="blob"===(e=e||new U(t).extension)||"binary"===e?this.getBlob(t):"base64"===e?this.getBase64(t):this.getText(t),i.then(i=>{const s=new q;if(i){const t=this.handleResponse(i,e);s.resolve(t)}else s.reject({message:"File not found in: "+t,stack:(new Error).stack});return s.promise})}handleResponse(t,e){let i;return i=E(e)?S(t,"text/xml"):"xhtml"===e?S(t,"application/xhtml+xml"):"html"==e||"htm"==e?S(t,"text/html"):"json"===e?JSON.parse(t):t,i}async getBlob(t,e){}async getText(t,e){}async getBase64(t,e){}destroy(){this.instance=void 0}};var ii=r(6838);const si=class extends ei{constructor(){super(),this.createInstance()}createInstance(){if(!ii)throw new Error("JSZip lib not loaded");this.instance=new ii}open(t,e){if("base64"===e){const e=t.split(",");t=2===e.length?e[1]:t}return this.instance.loadAsync(t,{base64:"base64"===e})}async openUrl(t,e){return ti(t,"binary").then(t=>this.instance.loadAsync(t,{base64:e}))}get(t){const e=window.decodeURIComponent(t.substring(1));return this.instance.file(e)}async getBlob(t,e){const i=this.get(t);if(i){const t=e||re(i.name);return i.async("uint8array").then(e=>new Blob([e],{type:t}))}return new Promise(t=>{t(null)})}async getText(t){const e=this.get(t);return e?e.async("string").then(t=>t):new Promise(t=>{t(null)})}async getBase64(t,e){const i=this.get(t);if(i){const t=e||re(i.name);return i.async("base64").then(e=>"data:"+t+";base64,"+e)}return new Promise(t=>{t(null)})}};var ri=r(6361);class ni extends ei{constructor(t){super(),this.name=t,this.online=window.navigator.onLine}createInstance(){if(!ri)throw new TypeError("LocalForage lib not loaded");this.instance=ri.createInstance({name:this.name}),this.appendListeners()}appendListeners(){window.addEventListener("online",this.status.bind(this)),window.addEventListener("offline",this.status.bind(this))}removeListeners(){window.removeEventListener("online",this.status.bind(this)),window.removeEventListener("offline",this.status.bind(this))}status(t){this.online="online"===t.type,this.online?this.emit("online"):this.emit("offline")}async get(t){const e=this.getKey(t);return this.instance.getItem(e)}async set(t,e){const i=this.getKey(t);return this.instance.setItem(i,e)}async put(t){return this.get(t).then(e=>e||ti(t,"binary").then(e=>this.set(t,e)))}async dispatch(t,e,i,s){if(this.online){const r=[];return r.push(ti(t,e,i,s)),r.push(this.put(t)),Promise.all(r).then(t=>t[0]||null)}return this.request(t,e)}getKey(t){let e;return e="string"==typeof t?t:`book-${t}`,e}async getBlob(t,e){return this.get(t).then(i=>{if(!i)return null;const s=e||re(t);return new Blob([i],{type:s})})}async getText(t,e){return this.get(t).then(i=>{if(!i)return null;const s=new q,r=new FileReader,n=e||re(t),o=new Blob([i],{type:n});return r.onloadend=()=>{s.resolve(r.result)},r.readAsText(o,n),s.promise})}async getBase64(t,e){return this.get(t).then(i=>{if(!i)return null;const s=new q,r=new FileReader,n=e||re(t),o=new Blob([i],{type:n});return r.onloadend=()=>{s.resolve(r.result)},r.readAsDataURL(o,n),s.promise})}destroy(){super.destroy(),this.removeListeners()}}e(ni.prototype);const oi=ni;r(8237);const ai=class{constructor(t,e){this.idref=t.idref,this.linear="yes"===t.linear,this.index=t.index,this.href=t.href,this.url=t.url,this.canonical=t.canonical,this.cfiBase=t.cfiBase,this.next=t.next,this.prev=t.prev,this.properties=t.properties,this.hooks=e,this.document=void 0,this.contents=void 0,this.output=void 0}load(t){const e=new q;return this.contents?e.resolve(this.contents):t(this.url).then(t=>(this.document=t,this.contents=t.documentElement,this.hooks.content.trigger(this.document,this))).then(()=>{e.resolve(this.contents)}).catch(t=>{e.reject(t)}),e.promise}render(t){const e=new q;return this.load(t).then(t=>{const e=new XMLSerializer;return this.output=e.serializeToString(t),this.output}).then(()=>this.hooks.serialize.trigger(this.output,this)).then(()=>{e.resolve(this.output)}).catch(t=>{e.reject(t)}),e.promise}find(t){const e=this,i=[],s=t.toLowerCase();return A(e.document,t=>(t=>{const r=t.textContent.toLowerCase();let n,o=-1;for(;-1!==n;){if(n=r.indexOf(s,o+1),-1!==n){const r=e.document.createRange();r.setStart(t,n),r.setEnd(t,n+s.length);const o=e.cfiFromRange(r);let a;t.textContent.length<150?a=t.textContent:(a=t.textContent.substring(n-75,n+75),a="..."+a+"..."),i.push({cfi:o,excerpt:a})}o=n}})(t)),i}search(t,e=5){if(void 0===document.createTreeWalker)return this.find(t);const i=[],s=this,r=t.toLowerCase(),n=t=>{const e=t.reduce((t,e)=>t+e.textContent,"").toLowerCase().indexOf(r);if(-1!==e){const n=0,o=e+r.length;let a=0,h=0;if(e<t[n].length){for(;a<t.length-1&&(h+=t[a].length,!(o<=h));)a+=1;const r=t[n],c=t[a],l=s.document.createRange();l.setStart(r,e);const u=t.slice(0,a).reduce((t,e)=>t+e.textContent.length,0);l.setEnd(c,u>o?o:o-u);const d=s.cfiFromRange(l);let p=t.slice(0,a+1).reduce((t,e)=>t+e.textContent,"");p.length>150&&(p=p.substring(e-75,e+75),p="..."+p+"..."),i.push({cfi:d,excerpt:p})}}},o=document.createTreeWalker(s.document,NodeFilter.SHOW_TEXT,null,!1);let a,h=[];for(;a=o.nextNode();)h.push(a),h.length==e&&(n(h.slice(0,e)),h=h.slice(1,e));return h.length>0&&n(h),i}cfiFromRange(t){return new V(t,this.cfiBase).toString()}cfiFromElement(t){return new V(t,this.cfiBase).toString()}unload(){this.document=void 0,this.contents=void 0,this.output=void 0}destroy(){this.unload(),this.hooks.serialize.clear(),this.hooks.content.clear(),this.hooks=void 0,this.idref=void 0,this.linear=void 0,this.properties=void 0,this.index=void 0,this.href=void 0,this.url=void 0,this.next=void 0,this.prev=void 0,this.cfiBase=void 0}};class hi extends Map{constructor(){super(),this.hooks={content:new ge(this),serialize:new ge(this)},this.hooks.content.register(Qt),this.hooks.content.register(ee),this.hooks.content.register(te),this.points={},this.nav=void 0,this.pkg=void 0}clear(){this.forEach(t=>t.destroy()),this.hooks.serialize.clear(),this.hooks.content.clear(),this.hooks.content.register(Qt),this.hooks.content.register(ee),this.hooks.content.register(te),this.points={},super.clear()}get(t){let e;if(void 0===t)e=this.first();else if("number"==typeof t&&!1===isNaN(t))e=[...this.values()][t];else if("string"==typeof t)if(V.prototype.isCfiString(t)){const i=new V(t).spinePos;e=[...this.values()][i]}else 0===t.indexOf("#")?(e=this.pkg.spine.get(t.substring(1)))&&(e=[...this.values()][e.index]):(e=this.nav.toc.get(t))?e=super.get(e.bind):(t=t.split("#")[0],e=super.get(t));return e||null}first(){return this.points.first||null}last(){return this.points.last||null}unpack(t,e,i,s){this.pkg=t,this.nav=e;const r=t.manifest,n=t.spine,o=e.toc;if(n.forEach((t,e)=>{const a=r.get(e),h={};if(h.cfiBase=V.prototype.generateChapterComponent(n.nodeIndex,t.index,t.id),a){const t=o.get(a.href);h.bind=t?t.bind:a.href,h.href=a.href,h.url=i(a.href,!0),h.canonical=s(a.href),h.properties=[],a.properties.length&&h.properties.push.apply(h.properties,a.properties)}h.idref=t.idref,h.index=t.index,h.linear=t.linear,"yes"===h.linear?(h.next=()=>{let t=h.index;for(;t<this.size-1;){let e=this.get(t+1);if(e&&e.linear)return e;t+=1}return null},h.prev=()=>{let t=h.index;for(;t>0;){let e=this.get(t-1);if(e&&e.linear)return e;t-=1}return null}):(h.prev=()=>null,h.next=()=>null);const c=new ai(h,this.hooks);this.set(h.bind,c)}),this.size){let t=0;for(;t<this.size;){let e=this.get(t);if(e&&e.linear){this.points.first=e;break}t+=1}}if(this.size){let t=this.size;for(;t>0;){let e=this.get(t-1);if(e&&e.linear){this.points.last=e;break}t-=1}}return Promise.resolve(this)}destroy(){this.clear(),this.hooks=void 0,this.points=void 0,this.nav=void 0,this.pkg=void 0}}const ci=hi,li="META-INF/container.xml",ui="binary",di="base64",pi="epub";class fi{constructor(t,e){void 0===e&&"string"!=typeof t&&t instanceof Blob==0&&t instanceof ArrayBuffer==0&&(e=t,t=void 0),this.settings=u({canonical:void 0,encoding:void 0,replacements:null,request:{method:void 0,withCredentials:!1,headers:[]},store:null},e||{}),this.request=this.settings.request.method||ti,this.archive=void 0,this.storage=new oi(this.settings.store),this.rendition=void 0,this.container=new Ft,this.packaging=new $t,this.resources=new oe(this.request.bind(this),this.resolve.bind(this),this.settings.replacements),this.sections=new ci,this.locations=new Bt(this.sections,this.load.bind(this)),this.navigation=new Zt,this.url=void 0,this.settings.store&&this.storage.createInstance(),t&&this.open(t).catch(t=>{this.emit(K,t)})}init(){this.archived=!1,this.cover=null,this.path=void 0,this.isOpen=!1,this.opening=new q,this.opened=this.opening.promise,this.loading={packaging:new q,resources:new q,navigation:new q,sections:new q,cover:new q},this.loaded={packaging:this.loading.packaging.promise,resources:this.loading.resources.promise,navigation:this.loading.navigation.promise,sections:this.loading.sections.promise,cover:this.loading.cover.promise}}clear(){this.container.clear(),this.packaging.clear(),this.resources.clear(),this.navigation.clear(),this.sections.clear(),this.locations.clear()}async open(t,e){this.init();const i=e||this.determineType(t);let s;if(this.settings.store&&this.store(t),i===ui)this.archived=!0,this.url=new W("/",""),s=this.openEpub(t);else if(i===di)this.archived=!0,this.url=new W("/",""),s=this.openEpub(t,i);else if(i===pi)this.archived=!0,this.url=new W("/",""),s=this.request(t,"binary",this.settings.request.withCredentials,this.settings.request.headers).then(this.openEpub.bind(this));else{let e;this.url=new W(t),e="json"===this.settings.format?"META-INF/container.json":li,s=this.openContainer(e,i)}return s}async openEpub(t,e){const i=e||this.settings.encoding;return this.unarchive(t,i).then(()=>this.openContainer(li))}async openContainer(t){return this.load(t).then(t=>"json"===this.settings.format?this.container.load(t):this.container.parse(t)).then(t=>{const e=this.resolve(t.fullPath);return this.openPackaging(e)})}async openPackaging(t){return this.path=new U(t),this.load(t).then(t=>"json"===this.settings.format?this.packaging.load(t):this.packaging.parse(t)).then(()=>this.loadNavigation()).then(()=>this.unpack())}load(t,e=null){const i=this.resolve(t);return this.archived?this.archive.request(i):this.request(i,e,this.settings.request.withCredentials,this.settings.request.headers)}resolve(t,e=!1){if(!t)return;if(t.indexOf("://")>-1)return t;let i=t;return this.path&&(i=this.path.resolve(this.path.directory,t)),!1===e&&this.url&&(i=this.url.resolve(i)),i}canonical(t){if(!t)return"";let e;return e=this.settings.canonical?this.settings.canonical(t):this.resolve(t,!0),e}determineType(t){if("base64"===this.settings.encoding)return di;if("string"!=typeof t)return ui;let e=new W(t).path.extension;return e&&(e=e.replace(/\?.*$/,"")),"epub"===e?pi:"directory"}async unpack(){this.loading.packaging.resolve(this.packaging),this.loading.navigation.resolve(this.navigation),this.resources.unpack(this.packaging.manifest,this.archive,this.storage).then(t=>{this.loading.resources.resolve(t)}),this.sections.unpack(this.packaging,this.navigation,this.resolve.bind(this),this.canonical.bind(this)).then(t=>{this.loading.sections.resolve(t)}),this.resources.replacements&&this.sections.hooks.serialize.register(this.resources.substitute.bind(this.resources)),this.packaging.manifest.coverPath&&(this.cover=this.resolve(this.packaging.manifest.coverPath)),this.loading.cover.resolve(this.cover);const t=[...Object.values(this.loaded)];return Promise.all(t).then(()=>(this.isOpen=!0,this.opening.resolve(this),this.opened))}async loadNavigation(){const t=this.packaging.manifest.navPath;return t?this.load(t).then(t=>"json"===this.settings.format?this.navigation.load(t):this.navigation.parse(t)):Promise.resolve(this.navigation)}section(t){return this.sections.get(t)}renderTo(t,e){const i="blobUrl";return this.settings.replacements===i&&(e=u({method:i},e||{})),this.rendition=new Ge(this,e),this.rendition.attachTo(t),this.rendition}setRequestCredentials(t){this.settings.request.withCredentials=t}setRequestHeaders(t){this.settings.request.headers=t}unarchive(t,e){return this.archive=new si,this.archive.open(t,e)}store(t){"string"==typeof t&&(this.request=this.storage.dispatch.bind(this.storage))}async coverUrl(){return this.loaded.cover.then(()=>this.archived&&this.cover?this.resources.createUrl(this.cover):this.cover)}async getRange(t){const e=new V(t),i=this.sections.get(e.spinePos),s=this.load.bind(this);return i?i.load(s).then(t=>e.toRange(i.document)):new Promise((t,e)=>{e(new Error("CFI could not be found"))})}key(t){const e=t||this.packaging.metadata.get("identifier")||this.url.filename;return`epubjs:${J}:${e}`}destroy(){this.isOpen=void 0,this.opened=void 0,this.loaded=void 0,this.opening=void 0,this.loading=void 0,this.archive&&this.archive.destroy(),this.storage&&this.storage.destroy(),this.sections&&this.sections.destroy(),this.locations&&this.locations.destroy(),this.resources&&this.resources.destroy(),this.container&&this.container.destroy(),this.packaging&&this.packaging.destroy(),this.rendition&&this.rendition.destroy(),this.navigation&&this.navigation.destroy(),this.archive=void 0,this.storage=void 0,this.archived=void 0,this.sections=void 0,this.locations=void 0,this.resources=void 0,this.container=void 0,this.packaging=void 0,this.rendition=void 0,this.navigation=void 0,this.url=void 0,this.path=void 0,this.cover=void 0,this.request=void 0,this.settings=void 0}}e(fi.prototype);const gi=fi;function mi(t,e){return new gi(t,e)}mi.VERSION=J,"undefined"!=typeof global&&(global.EPUBJS_VERSION=J),mi.Book=gi,mi.Rendition=Ge,mi.Contents=ke,mi.EpubCFI=V,mi.manager=t=>{let e;return e="continuous"===t?Ye:Ue,e},mi.view=t=>{let e;return e="inline"===t?De:_e,e},mi.utils=t;const vi=mi})(),n.default})());
//# sourceMappingURL=epub.min.js.map